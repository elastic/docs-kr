<!DOCTYPE html><html lang="en"><head><meta name="eui-styles"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-24"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'UA-12395217-24', {
                page_path: window.location.pathname,
              });
          </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try{var d=document.documentElement;var e=localStorage.getItem("elastic-docs-theme");if(e){d.setAttribute('data-theme', e)}else{d.setAttribute('data-theme', 'light');}}catch(t){}}();</script><title>Getting Started With Buildkite | Elastic Documentation</title><meta property="og:title" content="Getting Started With Buildkite | Elastic Documentation"/><meta class="elastic" name="title" content="Getting Started With Buildkite"/><meta class="elastic" name="date" content="2022-05-09T00:00:00.000Z"/><meta name="description" content="Need help? Here you&#x27;ll find complete coverage of Elasticsearch, Kibana and more."/><meta property="og:description" content="Need help? Here you&#x27;ll find complete coverage of Elasticsearch, Kibana and more."/><meta name="twitter:site" content="@elastic"/><meta property="og:url" content="http://localhost:3000/ci/getting-started-with-buildkite-at-elastic"/><link rel="stylesheet" type="text/css" href="/themes/eui_theme_undefined.min.css"/><link rel="stylesheet" type="text/css" href="/themes/theme_undefined.css"/><link rel="shortcut icon" href="/assets/images/favicon.ico"/><meta name="next-head-count" content="14"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-5b19eee634f155d9037d.js" defer=""></script><script src="/_next/static/chunks/framework-bf9b12c23e794b196495.js" defer=""></script><script src="/_next/static/chunks/main-710a14204f294c81ed08.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d9a28ac2b5165b299106.js" defer=""></script><script src="/_next/static/chunks/c78d26b1-ff6470003369f2a26fc7.js" defer=""></script><script src="/_next/static/chunks/103-fd3e1552f32e8c4a6b92.js" defer=""></script><script src="/_next/static/chunks/3674-41861bc71d856d154d9e.js" defer=""></script><script src="/_next/static/chunks/7815-952dc762df3d4a43befe.js" defer=""></script><script src="/_next/static/chunks/9237-e960f47bcd4625ef5949.js" defer=""></script><script src="/_next/static/chunks/4620-e195c3f5ae7ecefc57c7.js" defer=""></script><script src="/_next/static/chunks/8482-a7f4dd7850e2aa9b7794.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...slug%5D-ac753ff46f79468d535c.js" defer=""></script><script src="/_next/static/AzE3g5BBfFWf9aUdpqGZ7/_buildManifest.js" defer=""></script><script src="/_next/static/AzE3g5BBfFWf9aUdpqGZ7/_ssgManifest.js" defer=""></script></head><body class="guideBody"><div id="__next"><div class="docWrapper"><header data-elastic-exclude="true"><div class="euiHeader euiHeader--dark euiHeader--fixed"><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><a rel="noreferrer" class="euiHeaderLogo"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--large euiIcon-isLoading euiHeaderLogo__icon" focusable="false" role="img" aria-label="Elastic" aria-hidden="true"></svg><span class="euiHeaderLogo__text"><svg class="elasticMark" width="64" height="19" fill="white" xmlns="http://www.w3.org/2000/svg" aria-labelledby="elasticMark"><title id="elasticMark">Elastic</title><path d="M9.74 16.882l.711-.076.046 1.455c-1.879.257-3.485.393-4.818.393-1.773 0-3.03-.515-3.773-1.545C1.164 16.08.8 14.473.8 12.306c0-4.333 1.727-6.5 5.167-6.5 1.666 0 2.909.47 3.727 1.394.818.924 1.227 2.394 1.227 4.379l-.106 1.409H2.664c0 1.364.242 2.379.742 3.03.5.652 1.349.985 2.576.985 1.242.03 2.485-.015 3.757-.121zm-.667-5.349c0-1.515-.243-2.59-.728-3.212-.484-.621-1.272-.94-2.363-.94s-1.924.334-2.47.986c-.545.651-.833 1.712-.848 3.166h6.409zM13.497 18.427V.7h1.848v17.727h-1.848zM27.027 9.806v6.076c0 .621 1.53.742 1.53.742l-.09 1.637c-1.303 0-2.38.106-3.03-.515a10.861 10.861 0 01-4.44.924c-1.136 0-2-.319-2.59-.97-.592-.636-.895-1.56-.895-2.773 0-1.197.303-2.09.91-2.651.605-.56 1.56-.925 2.863-1.046l3.879-.363v-1.06c0-.834-.182-1.44-.546-1.804-.363-.364-.863-.545-1.485-.545H18.27V5.82h4.742c1.394 0 2.41.318 3.046.97.651.636.97 1.651.97 3.015zm-7.606 5.03c0 1.516.621 2.273 1.879 2.273a9.89 9.89 0 003.303-.56l.56-.197v-4.076l-3.65.348c-.743.06-1.274.273-1.607.637-.333.363-.485.894-.485 1.575zM34.255 7.473c-1.788 0-2.697.62-2.697 1.879 0 .575.212.984.62 1.227.41.242 1.35.485 2.819.742 1.47.258 2.5.606 3.106 1.076.606.454.91 1.318.91 2.59 0 1.274-.41 2.198-1.228 2.789-.818.59-2 .894-3.576.894-1.015 0-4.424-.38-4.424-.38l.106-1.605c1.954.182 3.379.333 4.333.333.955 0 1.682-.151 2.182-.454.5-.303.758-.819.758-1.53 0-.713-.212-1.198-.637-1.455-.424-.258-1.363-.5-2.818-.728-1.455-.227-2.485-.56-3.09-1.015-.607-.439-.91-1.272-.91-2.47 0-1.196.424-2.09 1.273-2.666.848-.576 1.909-.864 3.166-.864 1 0 4.485.258 4.485.258v1.621c-1.833-.106-3.333-.242-4.379-.242zM47.952 7.685h-3.925v5.909c0 1.409.106 2.348.303 2.788.212.44.697.666 1.47.666l2.197-.151.121 1.53c-1.106.182-1.94.273-2.515.273-1.288 0-2.167-.318-2.667-.94-.5-.62-.742-1.818-.742-3.575v-6.5h-1.758V6.079h1.758V2.29h1.833v3.773h3.925v1.62zM50.527 3.276V1.139h1.849v2.152l-1.849-.015zm0 15.151V6.08h1.849v12.348h-1.849zM60.406 5.821c.546 0 1.47.106 2.773.303l.59.076-.075 1.5c-1.318-.152-2.288-.227-2.91-.227-1.393 0-2.348.333-2.848 1-.5.666-.757 1.909-.757 3.712 0 1.803.227 3.06.697 3.773.47.712 1.44 1.06 2.924 1.06l2.91-.227.075 1.53c-1.53.227-2.682.349-3.44.349-1.924 0-3.257-.5-3.984-1.485-.728-.985-1.106-2.652-1.106-5 0-2.349.393-4 1.181-4.94.803-.939 2.122-1.424 3.97-1.424z"></path></svg></span></a></div></div><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><nav class="euiHeaderLinks" aria-label="App menu"><div class="euiHeaderLinks__list euiHeaderLinks__list--gutterS"><a class="euiButton euiButton--primary euiButton--small euiButton--fill" href="https://cloud.elastic.co/registration?source=docsHeader" rel=""><span class="euiButtonContent euiButton__content"><span class="euiButton__text">Try Free</span></span></a></div></nav></div></div></div></header><div class="euiPage euiPage--grow docArticle__template"><div class="euiPageSideBar euiPageSideBar--paddingLarge euiPageSideBar--sticky docChrome__sidebar"><div class="euiFlexItem" data-elastic-exclude="true"><div class="euiContextMenu docChrome__contextMenu"><div class="euiContextMenuPanel euiContextMenu__panel" tabindex="-1"><button class="euiContextMenuPanelTitle" type="button" data-test-subj="contextMenuPanelTitleButton"><span class="euiContextMenu__itemLayout"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading euiContextMenu__icon" focusable="false" role="img" aria-hidden="true"></svg><span class="euiContextMenu__text">Elastic 영상 모음</span></span></button><div><style data-emotion="css i2qclb-euiSpacer-s">.css-i2qclb-euiSpacer-s{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:8px;}</style><div class="euiSpacer euiSpacer--s css-i2qclb-euiSpacer-s"></div><nav class="euiSideNav" aria-label="Elastic 영상 모음"><div id="euiSideNav_b96003a0-eaaa-11ec-8e1f-05b94d47c10b_content" class="euiSideNav__content euiSideNav__contentMobile-xs euiSideNav__contentMobile-s"><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">Elastic 영상 모음</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/overview" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">페이지 소개</span></span></a></div></div></div><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">데이터 수집 및 시각화 데모</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-seoulMetro2019" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">(2019) 서울시 지하철 대시보드 만들기</span></span></a></div></div></div><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">(2021) 처음부터 시작하는 Elastic</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-0" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">0. 과정 소개 및 시스템 준비</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-1" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">1. Stack 설치 및 환경 설정</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-2" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">2. 데이터 활용 및 QueryDSL</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-3" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">3. 데이터 파이프라인 구성</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-4" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">4. Kibana 대시보드 만들기</span></span></a></div></div></div></div></nav></div></div></div></div></div><div class="euiPanel euiPanel--paddingLarge euiPanel--borderRadiusNone euiPanel--plain euiPanel--hasShadow euiPageBody euiPageBody--borderRadiusNone euiPageBody--paddingLarge"><div class="euiFlexGroup euiFlexGroup--gutterExtraLarge euiFlexGroup--directionRow euiFlexGroup--responsive docArticle__wrap"><div class="euiFlexItem docArticle__article"><header class="euiPageHeader euiPageHeader--bottomBorder euiPageHeader--responsive euiPageHeader--center"><div class="euiPageHeaderContent"><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--alignItemsFlexStart euiFlexGroup--directionRow euiFlexGroup--responsive euiPageHeaderContent__top"><div class="euiFlexItem"><h1 class="euiTitle euiTitle--large">Getting Started With Buildkite</h1><style data-emotion="css jz428s-euiSpacer-l">.css-jz428s-euiSpacer-l{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:24px;}</style><div class="euiSpacer euiSpacer--l css-jz428s-euiSpacer-l"></div><div class="euiText euiText--medium euiText--constrainedWidth"><p><span class="euiTextColor euiTextColor--subdued"></span></p></div></div></div></div></header><style data-emotion="css kiiy9t-euiSpacer-xl">.css-kiiy9t-euiSpacer-xl{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:32px;}</style><div class="euiSpacer euiSpacer--xl css-kiiy9t-euiSpacer-xl"></div><div class="euiPanel euiPanel--borderRadiusMedium euiPanel--plain euiPanel--noShadow euiPageContent" role="main"><div class="euiPageContentBody"><div class="euiText euiText--medium"><p>A guide to running your first build in <a class="euiLink euiLink--primary" href="https://buildkite.com/elastic" rel="noreferrer">Elastic&#x27;s Buildkite CI/CD environment<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</p>
<h2 id="overview" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#overview" rel="noreferrer" aria-label="Overview permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Overview</h2>
<p>This document is a &quot;getting started&quot; tutorial, and has an accompanying <a class="euiLink euiLink--primary" href="https://github.com/elastic/buildkite-example" rel="noreferrer">example
repository<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</p>
<p>Forking a repository currently is not supported, so feel free to clone the
example repo and follow along. If you do, please create a branch for yourself,
including your username in the branch name.</p>
<p>This documentation is meant to supplement the excellent documentation available
at <a class="euiLink euiLink--primary" href="https://buildkite.com/docs/" rel="noreferrer">buildkite.com/docs<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>, and highlight some <strong>Elastic-specific</strong> features.</p>
<h2 id="create-a-pipeline" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#create-a-pipeline" rel="noreferrer" aria-label="Create a Pipeline permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Create a Pipeline</h2>
<p>To create a new Buildkite pipeline, declare it in <a class="euiLink euiLink--primary" href="https://github.com/elastic/ci/blob/main/terraform/cdktf/env/buildkite-pipelines/buildkite-pipelines-prod.yml" rel="noreferrer">this configuration
file<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</p>
<p>Add an entry to the <code class="euiCode" data-code-language="text">pipelines</code> section specifying the GitHub repository and
default branch:</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token key atrule">pipelines</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token key atrule">Buildkite Example</span><span class="token punctuation">:</span> <span class="token comment"># The name of our pipeline as seen in the Buildkite UI.</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">repository</span><span class="token punctuation">:</span> elastic/buildkite<span class="token punctuation">-</span>example <span class="token comment"># Repo organization/name.</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">default_branch</span><span class="token punctuation">:</span> main <span class="token comment"># The default branch for the repo.</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h2 id="assign-the-pipeline-to-teams-optional" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#assign-the-pipeline-to-teams-optional" rel="noreferrer" aria-label="Assign the Pipeline to teams [optional] permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Assign the Pipeline to teams [optional]</h2>
<p>If access to the pipeline should be restricted to specific Buildkite teams,
then a <code class="euiCode" data-code-language="text">teams</code> section can be added to the pipeline&#x27;s yaml declaration:</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token key atrule">pipelines</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token key atrule">Buildkite Example With Team Restriction</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">repository</span><span class="token punctuation">:</span> elastic/elasticsearch<span class="token punctuation">-</span>team<span class="token punctuation">-</span>secret<span class="token punctuation">-</span>pipeline
</span><span class="euiCodeBlock__line">    <span class="token key atrule">default_branch</span><span class="token punctuation">:</span> main
</span><span class="euiCodeBlock__line">    <span class="token key atrule">teams</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<blockquote>
<p>:warning: Buildkite teams correlate one-to-one with GitHub teams. Therefore,
any team declared in this way must already exist in GitHub with exactly the
same name (case sensitive). Also, it must be different from the pipeline&#x27;s name.</p>
</blockquote>
<p>By default, declaring a team for a pipeline grants that team full control and
locks everybody else out. Restricted permissions can be granted to other teams
(or everyone in the company) like this:</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token punctuation">[</span><span class="token punctuation">...</span><span class="token punctuation">]</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">teams</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">kibana</span><span class="token punctuation">:</span> 
</span><span class="euiCodeBlock__line">        <span class="token key atrule">access_level</span><span class="token punctuation">:</span> BUILD_AND_READ
</span><span class="euiCodeBlock__line">      <span class="token key atrule">everyone</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;access_level&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;READ_ONLY&quot;</span><span class="token punctuation">}</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h2 id="add-the-repository-to-reference-repositories" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#add-the-repository-to-reference-repositories" rel="noreferrer" aria-label="Add The Repository to Reference Repositories permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Add The Repository to Reference Repositories</h2>
<p>To avoid downloading repositories in each build, add the repository to the list
of <a class="euiLink euiLink--primary" href="https://github.com/elastic/ci/blob/" rel="noreferrer">git reference repos<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</p>
<h2 id="raise-a-pull-request" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#raise-a-pull-request" rel="noreferrer" aria-label="Raise a Pull Request permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Raise a Pull Request</h2>
<p>When the changes from the above steps are merged, your pipeline will be created.</p>
<h2 id="add-pipeline-steps" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#add-pipeline-steps" rel="noreferrer" aria-label="Add Pipeline &quot;Steps&quot; permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Add Pipeline &quot;Steps&quot;</h2>
<p>At this stage, the pipeline exists, but does not have any work to do. In
Buildkite-speak, it is now time to define the pipeline <a class="euiLink euiLink--primary" href="https://buildkite.com/docs/pipelines/defining-steps#adding-steps" rel="noreferrer"><em>steps</em><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</p>
<p>For doing that, create a <a class="euiLink euiLink--primary" href="https://buildkite.com/docs/pipelines/defining-steps#step-defaults-pipeline-dot-yml-file" rel="noreferrer">pipeline.yml<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> file representing the actual work to be
done, and save it inside a <code class="euiCode" data-code-language="text">$REPOSITORY/.builkite</code> directory which is the expected
default configuration.</p>
<p>Beware, from here on, all changes happen in your own source repository.</p>
<p>The following section shows an example of how to configure it.</p>
<h3 id="create-buildkite-directory" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#create-buildkite-directory" rel="noreferrer" aria-label="Create ,[object Object], Directory permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Create <code class="euiCode" data-code-language="text">.buildkite</code> Directory</h3>
<p>Before getting started with a pipeline.yml file, you will need to tell Buildkite
where it will be able to find your steps.</p>
<p>To try it, create the <code class="euiCode" data-code-language="text">$REPOSITORY/.buildkite</code> directory and <code class="euiCode" data-code-language="text">$REPOSITORY/.buildkite/pipeline.yml</code>
file with the following contents:</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token punctuation">-</span> <span class="token key atrule">label</span><span class="token punctuation">:</span> <span class="token string">&quot;:wave: Greetings&quot;</span> <span class="token comment"># Label and optional emoji https://github.com/buildkite/emojis.</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token string">&quot;echo &#x27;My first pipeline!&#x27;&quot;</span> <span class="token comment"># Command step that can run either a shell command, or an executable file or script.</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<p>Then, commit and push your changes to your branch and then head over to
<a class="euiLink euiLink--primary" href="https://buildkite.com/elastic/buildkite-example" rel="noreferrer">buildkite.com/elastic/buildkite-example<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> to see the pipeline run in CI.</p>
<h3 id="select-an-agent-image" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#select-an-agent-image" rel="noreferrer" aria-label="Select an Agent Image permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Select an Agent Image</h3>
<p>By default, jobs run as containers on Kubernetes. You can specify any container
image to run your builds, but some requirements must be met. To work as a
Buildkite agent, your container image must contain runnable copies of:</p>
<ul>
<li><code class="euiCode" data-code-language="text">git</code></li>
<li><code class="euiCode" data-code-language="text">ssh</code></li>
<li><code class="euiCode" data-code-language="text">ssh-keyscan</code> (usually provided with <code class="euiCode" data-code-language="text">ssh</code>).</li>
</ul>
<blockquote>
<p>:warning: Many popular off-the-shelf images, like <code class="euiCode" data-code-language="text">ubuntu:20.04</code> do not
contain these binaries. Check <a class="euiLink euiLink--primary" href="https://github.com/elastic/buildkite-example/blob/main/.buildkite/agents/Dockerfile" rel="noreferrer">this link<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> to see an example.</p>
</blockquote>
<h3 id="create-a-custom-image-optional" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#create-a-custom-image-optional" rel="noreferrer" aria-label="Create a Custom Image [optional] permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Create a Custom Image [optional]</h3>
<p>Often, you will want to create a custom agent image. You may need to add the
requirements shown above, or do more extensive preparation to create an image
that is &quot;just right&quot; for your job.</p>
<blockquote>
<p>:bulb: While you can use any method you like to build and push custom images,
we recommend taking advantage of the <a class="euiLink euiLink--primary" href="https://github.com/elastic/ci-agent-images" rel="noreferrer">ci-agent-images<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> automated build system.
This is a highly automated pipeline for producing custom images. In short, you
can commit a <code class="euiCode" data-code-language="text">Dockerfile</code> and an accompanying configuration file for your image,
and then expect to have your image automatically built and pushed to
<code class="euiCode" data-code-language="text">docker.elastic.co</code>.</p>
</blockquote>
<p>The following example shows how to tell the pipeline to use your custom image:</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token punctuation">---</span>
</span><span class="euiCodeBlock__line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token punctuation">-</span> <span class="token key atrule">label</span><span class="token punctuation">:</span> <span class="token string">&quot;:wave: Greetings&quot;</span> <span class="token comment"># Label and optional emoji https://github.com/buildkite/emojis.</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token string">&quot;hello.sh&quot;</span> <span class="token comment"># The script to run.</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">agents</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;docker.elastic.co/employees/itsmed/buildkite-agent-example&quot;</span> <span class="token comment"># The custom image&#x27;s location.</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h2 id="use-docker" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#use-docker" rel="noreferrer" aria-label="Use Docker permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Use Docker</h2>
<p>Since container management is not supported in the Kubernetes offering, in order
to use <code class="euiCode" data-code-language="text">docker-like</code> commands, you need to use a GCE based agent.</p>
<p>To achieve that, update the <code class="euiCode" data-code-language="text">agents.provider</code> step proviging the <code class="euiCode" data-code-language="text">gcp</code> value
instead of <code class="euiCode" data-code-language="text">agents.image</code> entry in your <code class="euiCode" data-code-language="text">pipeline.yml</code> or check the
<a class="euiLink euiLink--primary" href="https://github.com/elastic/buildkite-example/blob/gcp-agent-with-vault/.buildkite/pipeline.yml" rel="noreferrer">gcp-agent-with-vault branch<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> for example:</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token punctuation">---</span>
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token punctuation">-</span> <span class="token key atrule">label</span><span class="token punctuation">:</span> <span class="token string">&quot;:wave: Greetings&quot;</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token string">&quot;hello.sh&quot;</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">agents</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">provider</span><span class="token punctuation">:</span> <span class="token string">&quot;gcp&quot;</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h2 id="use-vault" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#use-vault" rel="noreferrer" aria-label="Use Vault permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Use Vault</h2>
<p>When you raise a Pull Request to add your pipeline in Buildkite described before,
the Vault policy required by the repository is requested.</p>
<p>Once these resources gets created, you will have <code class="euiCode" data-code-language="text">read</code>/<code class="euiCode" data-code-language="text">write</code> access to your
secrets created under the <code class="euiCode" data-code-language="text">secret/ci/$GITHUB_ORGANIZATION-$REPOSITORY_NAME</code> path
structure.</p>
<p>For instance, the <code class="euiCode" data-code-language="text">secret/ci/elastic-buildkite-example</code> path stores secrets
for the <code class="euiCode" data-code-language="text">buildkite-example</code> repository.</p>
<p>You can follow the next intructions to read a secret using the <code class="euiCode" data-code-language="text">buildkite-example</code>
repository.</p>
<ul>
<li>Create <code class="euiCode" data-code-language="text">$REPOSITORY/hello-vault.sh</code> with the following contents:</li>
</ul>
<div><div class="language-bash euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="bash"><span class="euiCodeBlock__line"><span class="token comment">#/bin/bash</span>
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line"><span class="token assign-left variable">message</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>vault <span class="token builtin class-name">read</span> -field<span class="token operator">=</span>message secret/ci/elastic-buildkite-example/vault-secret<span class="token variable">)</span></span>
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$message</span>&quot;</span>
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<ul>
<li>Update the <code class="euiCode" data-code-language="text">pipeline.yml</code> command step value specifying your Vault script:</li>
</ul>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token punctuation">-</span> <span class="token key atrule">label</span><span class="token punctuation">:</span> <span class="token string">&quot;:wave: Greetings&quot;</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token string">&quot;hello-vault.sh&quot;</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<ul>
<li>Commit and push your changes to your branch and then head over to
<a class="euiLink euiLink--primary" href="https://buildkite.com/elastic/buildkite-example" rel="noreferrer">buildkite.com/elastic/buildkite-example<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> to see the pipeline run in CI.</li>
</ul>
<h3 id="migrating-your-secrets-to-the-new-vault-location" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#migrating-your-secrets-to-the-new-vault-location" rel="noreferrer" aria-label="Migrating Your Secrets to the New Vault Location permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Migrating Your Secrets to the New Vault Location</h3>
<p>You will likely want to copy some secrets from an existing Vault location to
<code class="euiCode" data-code-language="text">secret/ci/$GITHUB_ORGANIZATION-$REPO_NAME</code>.</p>
<p>To help you with the above, you can use the <code class="euiCode" data-code-language="text">vault-cp</code> utility script that is
part of the larger <code class="euiCode" data-code-language="text">infra-vault-tools</code> package. Installation instructions are
<a class="euiLink euiLink--primary" href="https://github.com/elastic/infra/tree/a4448e94d8e58a340a225d42c510cf396e3c7d8d/flavortown/infra-vault-tools#installing" rel="noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</p>
<p>It is just a shell script, so if you&#x27;d rather not install the whole
<code class="euiCode" data-code-language="text">infra-vault-tools</code> package, you can pretty easily <a class="euiLink euiLink--primary" href="https://github.com/elastic/infra/blob/a4448e94d8e58a340a225d42c510cf396e3c7d8d/flavortown/infra-vault-tools/infra_vault_tools/shell_commands/vault-cp.sh" rel="noreferrer">copy the script<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> into an
executable shell file somewhere on your <code class="euiCode" data-code-language="text">PATH</code> and use it direclty.</p>
<p>You will also find, in the <code class="euiCode" data-code-language="text">infra-vault-tools</code>, a <a class="euiLink euiLink--primary" href="https://github.com/elastic/infra/blob/a4448e94d8e58a340a225d42c510cf396e3c7d8d/flavortown/infra-vault-tools/infra_vault_tools/shell_commands/vault-append.sh" rel="noreferrer"><code class="euiCode" data-code-language="text">vault-append</code><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> script
that you can use to add new key/values to existing secrets.</p>
<p><span role="img" aria-label="light bulb">💡</span> Example to come</p>
<h2 id="dynamic-pipelines" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#dynamic-pipelines" rel="noreferrer" aria-label="Dynamic Pipelines permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Dynamic Pipelines</h2>
<p>Buildkite has the capacity to have <a class="euiLink euiLink--primary" href="https://buildkite.com/docs/pipelines/defining-steps#dynamic-pipelines" rel="noreferrer">pipelines dynamically generated<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> by a
program written in any language that can output YAML to <code class="euiCode" data-code-language="text">stdout</code>.</p>
<blockquote>
<p><span role="img" aria-label="light bulb">💡</span> example to come</p>
</blockquote>
<h2 id="multiple-steps-and-parallelization" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#multiple-steps-and-parallelization" rel="noreferrer" aria-label="Multiple Steps and Parallelization permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Multiple Steps and Parallelization</h2>
<p>Head over to the <a class="euiLink euiLink--primary" href="https://buildkite.com/docs/pipelines" rel="noreferrer">Buildkite Pipeline documentation<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> to learn about using
Pipelines and Buildkite!</p></div><div class="euiSpacer euiSpacer--l css-jz428s-euiSpacer-l"></div><div class="euiText euiText--small"><div class="euiTextColor euiTextColor--subdued">Last updated: May 9th, 2022</div></div></div></div></div></div></div></div><footer class="docChromeFooter" data-elastic-exclude="true"><div class="euiFlexGroup euiFlexGroup--justifyContentSpaceAround euiFlexGroup--directionRow euiFlexGroup--responsive"><div class="euiFlexItem euiFlexItem--flexGrowZero docChromeFooter__container"><div class="euiFlexGroup euiFlexGroup--gutterExtraLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--directionRow euiFlexGroup--responsive"><div class="euiFlexItem"><div class="euiText euiText--small"><div class="euiTextColor euiTextColor--ghost"><p>Elasticsearch is a trademark of Elasticsearch B.V., registered in the U.S. and in other countries.</p><p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the Apache Software Foundation in the United States and/or other countries.</p><p> <a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/trademarks" rel="">Trademarks</a><span class="docChromeFooter__divide">|</span><a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/terms-of-use" rel="">Terms of Use</a><span class="docChromeFooter__divide">|</span><a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/privacy-statement" rel="">Privacy</a><span class="docChromeFooter__divide">|</span>© <!-- -->2022<!-- --> Elasticsearch B.V. All Rights Reserved</p></div></div></div><div class="euiFlexItem euiFlexItem--flexGrowZero"></div><div class="euiFlexItem euiFlexItem--flexGrowZero"><figure class="euiImage docChromeFooter__logo"><img style="max-width:xs;max-height:xs;width:auto" src="/assets/images/logo-elastic-vertical-reverse.svg" class="euiImage__img" alt="Elastic logo"/></figure></div></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"bundle":"!function(e,t){\"object\"==typeof exports\u0026\u0026\"object\"==typeof module?module.exports=t(require(\"mdxJsReact\"),require(\"React\")):\"function\"==typeof define\u0026\u0026define.amd?define([\"mdxJsReact\",\"React\"],t):\"object\"==typeof exports?exports.MDXContent=t(require(\"mdxJsReact\"),require(\"React\")):e.MDXContent=t(e.mdxJsReact,e.React)}(this,((e,t)=\u003e(()=\u003e{\"use strict\";var n={24:e=\u003e{e.exports=t},825:t=\u003e{t.exports=e}},l={};function a(e){var t=l[e];if(void 0!==t)return t.exports;var i=l[e]={exports:{}};return n[e](i,i.exports,a),i.exports}a.n=e=\u003e{var t=e\u0026\u0026e.__esModule?()=\u003ee.default:()=\u003ee;return a.d(t,{a:t}),t},a.d=(e,t)=\u003e{for(var n in t)a.o(t,n)\u0026\u0026!a.o(e,n)\u0026\u0026Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=\u003eObject.prototype.hasOwnProperty.call(e,t),a.r=e=\u003e{\"undefined\"!=typeof Symbol\u0026\u0026Symbol.toStringTag\u0026\u0026Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})};var i={};return(()=\u003e{a.r(i),a.d(i,{default:()=\u003el});var e=a(825),t=a(24),n=a.n(t);const l=function(){var t=arguments.length\u003e0\u0026\u0026void 0!==arguments[0]?arguments[0]:{},l=Object.assign({},(0,e.useMDXComponents)(),t.components),a=l.wrapper;return a?n().createElement(a,t,n().createElement(i)):i();function i(){var l=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",strong:\"strong\",code:\"code\",pre:\"pre\",blockquote:\"blockquote\",em:\"em\",h3:\"h3\",ul:\"ul\",li:\"li\",span:\"span\"},(0,e.useMDXComponents)(),t.components);return n().createElement(n().Fragment,null,n().createElement(l.p,null,\"A guide to running your first build in \",n().createElement(l.a,{href:\"https://buildkite.com/elastic\"},\"Elastic's Buildkite CI/CD environment\"),\".\"),\"\\n\",n().createElement(l.h2,{id:\"overview\"},\"Overview\"),\"\\n\",n().createElement(l.p,null,'This document is a \"getting started\" tutorial, and has an accompanying ',n().createElement(l.a,{href:\"https://github.com/elastic/buildkite-example\"},\"example\\nrepository\"),\".\"),\"\\n\",n().createElement(l.p,null,\"Forking a repository currently is not supported, so feel free to clone the\\nexample repo and follow along. If you do, please create a branch for yourself,\\nincluding your username in the branch name.\"),\"\\n\",n().createElement(l.p,null,\"This documentation is meant to supplement the excellent documentation available\\nat \",n().createElement(l.a,{href:\"https://buildkite.com/docs/\"},\"buildkite.com/docs\"),\", and highlight some \",n().createElement(l.strong,null,\"Elastic-specific\"),\" features.\"),\"\\n\",n().createElement(l.h2,{id:\"create-a-pipeline\"},\"Create a Pipeline\"),\"\\n\",n().createElement(l.p,null,\"To create a new Buildkite pipeline, declare it in \",n().createElement(l.a,{href:\"https://github.com/elastic/ci/blob/main/terraform/cdktf/env/buildkite-pipelines/buildkite-pipelines-prod.yml\"},\"this configuration\\nfile\"),\".\"),\"\\n\",n().createElement(l.p,null,\"Add an entry to the \",n().createElement(l.code,{display:\"inline\"},\"pipelines\"),\" section specifying the GitHub repository and\\ndefault branch:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},\"pipelines:\\n  Buildkite Example: # The name of our pipeline as seen in the Buildkite UI.\\n    repository: elastic/buildkite-example # Repo organization/name.\\n    default_branch: main # The default branch for the repo.\\n\")),\"\\n\",n().createElement(l.h2,{id:\"assign-the-pipeline-to-teams-optional\"},\"Assign the Pipeline to teams [optional]\"),\"\\n\",n().createElement(l.p,null,\"If access to the pipeline should be restricted to specific Buildkite teams,\\nthen a \",n().createElement(l.code,{display:\"inline\"},\"teams\"),\" section can be added to the pipeline's yaml declaration:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},\"pipelines:\\n  Buildkite Example With Team Restriction:\\n    repository: elastic/elasticsearch-team-secret-pipeline\\n    default_branch: main\\n    teams:\\n      elasticsearch: {}\\n\")),\"\\n\",n().createElement(l.blockquote,null,\"\\n\",n().createElement(l.p,null,\":warning: Buildkite teams correlate one-to-one with GitHub teams. Therefore,\\nany team declared in this way must already exist in GitHub with exactly the\\nsame name (case sensitive). Also, it must be different from the pipeline's name.\"),\"\\n\"),\"\\n\",n().createElement(l.p,null,\"By default, declaring a team for a pipeline grants that team full control and\\nlocks everybody else out. Restricted permissions can be granted to other teams\\n(or everyone in the company) like this:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},'[...]\\n    teams:\\n      elasticsearch: {}\\n      kibana: \\n        access_level: BUILD_AND_READ\\n      everyone: {\"access_level\": \"READ_ONLY\"}\\n')),\"\\n\",n().createElement(l.h2,{id:\"add-the-repository-to-reference-repositories\"},\"Add The Repository to Reference Repositories\"),\"\\n\",n().createElement(l.p,null,\"To avoid downloading repositories in each build, add the repository to the list\\nof \",n().createElement(l.a,{href:\"https://github.com/elastic/ci/blob/\"},\"git reference repos\"),\".\"),\"\\n\",n().createElement(l.h2,{id:\"raise-a-pull-request\"},\"Raise a Pull Request\"),\"\\n\",n().createElement(l.p,null,\"When the changes from the above steps are merged, your pipeline will be created.\"),\"\\n\",n().createElement(l.h2,{id:\"add-pipeline-steps\"},'Add Pipeline \"Steps\"'),\"\\n\",n().createElement(l.p,null,\"At this stage, the pipeline exists, but does not have any work to do. In\\nBuildkite-speak, it is now time to define the pipeline \",n().createElement(l.a,{href:\"https://buildkite.com/docs/pipelines/defining-steps#adding-steps\"},n().createElement(l.em,null,\"steps\")),\".\"),\"\\n\",n().createElement(l.p,null,\"For doing that, create a \",n().createElement(l.a,{href:\"https://buildkite.com/docs/pipelines/defining-steps#step-defaults-pipeline-dot-yml-file\"},\"pipeline.yml\"),\" file representing the actual work to be\\ndone, and save it inside a \",n().createElement(l.code,{display:\"inline\"},\"$REPOSITORY/.builkite\"),\" directory which is the expected\\ndefault configuration.\"),\"\\n\",n().createElement(l.p,null,\"Beware, from here on, all changes happen in your own source repository.\"),\"\\n\",n().createElement(l.p,null,\"The following section shows an example of how to configure it.\"),\"\\n\",n().createElement(l.h3,{id:\"create-buildkite-directory\"},\"Create \",n().createElement(l.code,{display:\"inline\"},\".buildkite\"),\" Directory\"),\"\\n\",n().createElement(l.p,null,\"Before getting started with a pipeline.yml file, you will need to tell Buildkite\\nwhere it will be able to find your steps.\"),\"\\n\",n().createElement(l.p,null,\"To try it, create the \",n().createElement(l.code,{display:\"inline\"},\"$REPOSITORY/.buildkite\"),\" directory and \",n().createElement(l.code,{display:\"inline\"},\"$REPOSITORY/.buildkite/pipeline.yml\"),\"\\nfile with the following contents:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},'steps:\\n  - label: \":wave: Greetings\" # Label and optional emoji https://github.com/buildkite/emojis.\\n    command: \"echo \\'My first pipeline!\\'\" # Command step that can run either a shell command, or an executable file or script.\\n')),\"\\n\",n().createElement(l.p,null,\"Then, commit and push your changes to your branch and then head over to\\n\",n().createElement(l.a,{href:\"https://buildkite.com/elastic/buildkite-example\"},\"buildkite.com/elastic/buildkite-example\"),\" to see the pipeline run in CI.\"),\"\\n\",n().createElement(l.h3,{id:\"select-an-agent-image\"},\"Select an Agent Image\"),\"\\n\",n().createElement(l.p,null,\"By default, jobs run as containers on Kubernetes. You can specify any container\\nimage to run your builds, but some requirements must be met. To work as a\\nBuildkite agent, your container image must contain runnable copies of:\"),\"\\n\",n().createElement(l.ul,null,\"\\n\",n().createElement(l.li,null,n().createElement(l.code,{display:\"inline\"},\"git\")),\"\\n\",n().createElement(l.li,null,n().createElement(l.code,{display:\"inline\"},\"ssh\")),\"\\n\",n().createElement(l.li,null,n().createElement(l.code,{display:\"inline\"},\"ssh-keyscan\"),\" (usually provided with \",n().createElement(l.code,{display:\"inline\"},\"ssh\"),\").\"),\"\\n\"),\"\\n\",n().createElement(l.blockquote,null,\"\\n\",n().createElement(l.p,null,\":warning: Many popular off-the-shelf images, like \",n().createElement(l.code,{display:\"inline\"},\"ubuntu:20.04\"),\" do not\\ncontain these binaries. Check \",n().createElement(l.a,{href:\"https://github.com/elastic/buildkite-example/blob/main/.buildkite/agents/Dockerfile\"},\"this link\"),\" to see an example.\"),\"\\n\"),\"\\n\",n().createElement(l.h3,{id:\"create-a-custom-image-optional\"},\"Create a Custom Image [optional]\"),\"\\n\",n().createElement(l.p,null,'Often, you will want to create a custom agent image. You may need to add the\\nrequirements shown above, or do more extensive preparation to create an image\\nthat is \"just right\" for your job.'),\"\\n\",n().createElement(l.blockquote,null,\"\\n\",n().createElement(l.p,null,\":bulb: While you can use any method you like to build and push custom images,\\nwe recommend taking advantage of the \",n().createElement(l.a,{href:\"https://github.com/elastic/ci-agent-images\"},\"ci-agent-images\"),\" automated build system.\\nThis is a highly automated pipeline for producing custom images. In short, you\\ncan commit a \",n().createElement(l.code,{display:\"inline\"},\"Dockerfile\"),\" and an accompanying configuration file for your image,\\nand then expect to have your image automatically built and pushed to\\n\",n().createElement(l.code,{display:\"inline\"},\"docker.elastic.co\"),\".\"),\"\\n\"),\"\\n\",n().createElement(l.p,null,\"The following example shows how to tell the pipeline to use your custom image:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},'---\\nsteps:\\n  - label: \":wave: Greetings\" # Label and optional emoji https://github.com/buildkite/emojis.\\n    command: \"hello.sh\" # The script to run.\\n    agents:\\n      image: \"docker.elastic.co/employees/itsmed/buildkite-agent-example\" # The custom image\\'s location.\\n')),\"\\n\",n().createElement(l.h2,{id:\"use-docker\"},\"Use Docker\"),\"\\n\",n().createElement(l.p,null,\"Since container management is not supported in the Kubernetes offering, in order\\nto use \",n().createElement(l.code,{display:\"inline\"},\"docker-like\"),\" commands, you need to use a GCE based agent.\"),\"\\n\",n().createElement(l.p,null,\"To achieve that, update the \",n().createElement(l.code,{display:\"inline\"},\"agents.provider\"),\" step proviging the \",n().createElement(l.code,{display:\"inline\"},\"gcp\"),\" value\\ninstead of \",n().createElement(l.code,{display:\"inline\"},\"agents.image\"),\" entry in your \",n().createElement(l.code,{display:\"inline\"},\"pipeline.yml\"),\" or check the\\n\",n().createElement(l.a,{href:\"https://github.com/elastic/buildkite-example/blob/gcp-agent-with-vault/.buildkite/pipeline.yml\"},\"gcp-agent-with-vault branch\"),\" for example:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},'---\\n\\nsteps:\\n  - label: \":wave: Greetings\"\\n    command: \"hello.sh\"\\n    agents:\\n      provider: \"gcp\"\\n')),\"\\n\",n().createElement(l.h2,{id:\"use-vault\"},\"Use Vault\"),\"\\n\",n().createElement(l.p,null,\"When you raise a Pull Request to add your pipeline in Buildkite described before,\\nthe Vault policy required by the repository is requested.\"),\"\\n\",n().createElement(l.p,null,\"Once these resources gets created, you will have \",n().createElement(l.code,{display:\"inline\"},\"read\"),\"/\",n().createElement(l.code,{display:\"inline\"},\"write\"),\" access to your\\nsecrets created under the \",n().createElement(l.code,{display:\"inline\"},\"secret/ci/$GITHUB_ORGANIZATION-$REPOSITORY_NAME\"),\" path\\nstructure.\"),\"\\n\",n().createElement(l.p,null,\"For instance, the \",n().createElement(l.code,{display:\"inline\"},\"secret/ci/elastic-buildkite-example\"),\" path stores secrets\\nfor the \",n().createElement(l.code,{display:\"inline\"},\"buildkite-example\"),\" repository.\"),\"\\n\",n().createElement(l.p,null,\"You can follow the next intructions to read a secret using the \",n().createElement(l.code,{display:\"inline\"},\"buildkite-example\"),\"\\nrepository.\"),\"\\n\",n().createElement(l.ul,null,\"\\n\",n().createElement(l.li,null,\"Create \",n().createElement(l.code,{display:\"inline\"},\"$REPOSITORY/hello-vault.sh\"),\" with the following contents:\"),\"\\n\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-bash\",display:\"block\"},'#/bin/bash\\n\\nmessage=$(vault read -field=message secret/ci/elastic-buildkite-example/vault-secret)\\n\\necho \"$message\"\\n\\n')),\"\\n\",n().createElement(l.ul,null,\"\\n\",n().createElement(l.li,null,\"Update the \",n().createElement(l.code,{display:\"inline\"},\"pipeline.yml\"),\" command step value specifying your Vault script:\"),\"\\n\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},'steps:\\n  - label: \":wave: Greetings\"\\n    command: \"hello-vault.sh\"\\n')),\"\\n\",n().createElement(l.ul,null,\"\\n\",n().createElement(l.li,null,\"Commit and push your changes to your branch and then head over to\\n\",n().createElement(l.a,{href:\"https://buildkite.com/elastic/buildkite-example\"},\"buildkite.com/elastic/buildkite-example\"),\" to see the pipeline run in CI.\"),\"\\n\"),\"\\n\",n().createElement(l.h3,{id:\"migrating-your-secrets-to-the-new-vault-location\"},\"Migrating Your Secrets to the New Vault Location\"),\"\\n\",n().createElement(l.p,null,\"You will likely want to copy some secrets from an existing Vault location to\\n\",n().createElement(l.code,{display:\"inline\"},\"secret/ci/$GITHUB_ORGANIZATION-$REPO_NAME\"),\".\"),\"\\n\",n().createElement(l.p,null,\"To help you with the above, you can use the \",n().createElement(l.code,{display:\"inline\"},\"vault-cp\"),\" utility script that is\\npart of the larger \",n().createElement(l.code,{display:\"inline\"},\"infra-vault-tools\"),\" package. Installation instructions are\\n\",n().createElement(l.a,{href:\"https://github.com/elastic/infra/tree/a4448e94d8e58a340a225d42c510cf396e3c7d8d/flavortown/infra-vault-tools#installing\"},\"here\"),\".\"),\"\\n\",n().createElement(l.p,null,\"It is just a shell script, so if you'd rather not install the whole\\n\",n().createElement(l.code,{display:\"inline\"},\"infra-vault-tools\"),\" package, you can pretty easily \",n().createElement(l.a,{href:\"https://github.com/elastic/infra/blob/a4448e94d8e58a340a225d42c510cf396e3c7d8d/flavortown/infra-vault-tools/infra_vault_tools/shell_commands/vault-cp.sh\"},\"copy the script\"),\" into an\\nexecutable shell file somewhere on your \",n().createElement(l.code,{display:\"inline\"},\"PATH\"),\" and use it direclty.\"),\"\\n\",n().createElement(l.p,null,\"You will also find, in the \",n().createElement(l.code,{display:\"inline\"},\"infra-vault-tools\"),\", a \",n().createElement(l.a,{href:\"https://github.com/elastic/infra/blob/a4448e94d8e58a340a225d42c510cf396e3c7d8d/flavortown/infra-vault-tools/infra_vault_tools/shell_commands/vault-append.sh\"},n().createElement(l.code,{display:\"inline\"},\"vault-append\")),\" script\\nthat you can use to add new key/values to existing secrets.\"),\"\\n\",n().createElement(l.p,null,n().createElement(l.span,{role:\"img\",\"aria-label\":\"light bulb\"},\"💡\"),\" Example to come\"),\"\\n\",n().createElement(l.h2,{id:\"dynamic-pipelines\"},\"Dynamic Pipelines\"),\"\\n\",n().createElement(l.p,null,\"Buildkite has the capacity to have \",n().createElement(l.a,{href:\"https://buildkite.com/docs/pipelines/defining-steps#dynamic-pipelines\"},\"pipelines dynamically generated\"),\" by a\\nprogram written in any language that can output YAML to \",n().createElement(l.code,{display:\"inline\"},\"stdout\"),\".\"),\"\\n\",n().createElement(l.blockquote,null,\"\\n\",n().createElement(l.p,null,n().createElement(l.span,{role:\"img\",\"aria-label\":\"light bulb\"},\"💡\"),\" example to come\"),\"\\n\"),\"\\n\",n().createElement(l.h2,{id:\"multiple-steps-and-parallelization\"},\"Multiple Steps and Parallelization\"),\"\\n\",n().createElement(l.p,null,\"Head over to the \",n().createElement(l.a,{href:\"https://buildkite.com/docs/pipelines\"},\"Buildkite Pipeline documentation\"),\" to learn about using\\nPipelines and Buildkite!\"))}}})(),i})()));","frontmatter":{"id":"gettingStartedWithBuildkiteAtElastic","slug":"/ci/getting-started-with-buildkite-at-elastic","title":"Getting Started With Buildkite","summary":"Elastic CI documentation for getting started with Buildkite","date":"2022-05-09T00:00:00.000Z","tags":["ci","ci/cd","developer tools","buildkite","engineering","platform"],"link":"https://github.com/elastic/ci/blob/main","linkPath":"docs/buildkite/getting_started.mdx"},"missionId":"krVideos"},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["ci","getting-started-with-buildkite-at-elastic"]},"buildId":"AzE3g5BBfFWf9aUdpqGZ7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>