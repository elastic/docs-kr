<!DOCTYPE html><html lang="en"><head><meta name="eui-styles"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-24"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'UA-12395217-24', {
                page_path: window.location.pathname,
              });
          </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try{var d=document.documentElement;var e=localStorage.getItem("elastic-docs-theme");if(e){d.setAttribute('data-theme', e)}else{d.setAttribute('data-theme', 'light');}}catch(t){}}();</script><title>Providers | Elastic Documentation</title><meta property="og:title" content="Providers | Elastic Documentation"/><meta class="elastic" name="title" content="Providers"/><meta class="elastic" name="date" content="2022-03-28T00:00:00.000Z"/><meta name="description" content="Need help? Here you&#x27;ll find complete coverage of Elasticsearch, Kibana and more."/><meta property="og:description" content="Need help? Here you&#x27;ll find complete coverage of Elasticsearch, Kibana and more."/><meta name="twitter:site" content="@elastic"/><meta property="og:url" content="http://localhost:3000/ci/gobld/providers/readme"/><link rel="stylesheet" type="text/css" href="/themes/eui_theme_undefined.min.css"/><link rel="stylesheet" type="text/css" href="/themes/theme_undefined.css"/><link rel="shortcut icon" href="/assets/images/favicon.ico"/><meta name="next-head-count" content="14"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-5b19eee634f155d9037d.js" defer=""></script><script src="/_next/static/chunks/framework-bf9b12c23e794b196495.js" defer=""></script><script src="/_next/static/chunks/main-710a14204f294c81ed08.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d9a28ac2b5165b299106.js" defer=""></script><script src="/_next/static/chunks/c78d26b1-ff6470003369f2a26fc7.js" defer=""></script><script src="/_next/static/chunks/103-fd3e1552f32e8c4a6b92.js" defer=""></script><script src="/_next/static/chunks/3674-41861bc71d856d154d9e.js" defer=""></script><script src="/_next/static/chunks/7815-952dc762df3d4a43befe.js" defer=""></script><script src="/_next/static/chunks/9237-e960f47bcd4625ef5949.js" defer=""></script><script src="/_next/static/chunks/4620-e195c3f5ae7ecefc57c7.js" defer=""></script><script src="/_next/static/chunks/8482-a7f4dd7850e2aa9b7794.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...slug%5D-ac753ff46f79468d535c.js" defer=""></script><script src="/_next/static/AzE3g5BBfFWf9aUdpqGZ7/_buildManifest.js" defer=""></script><script src="/_next/static/AzE3g5BBfFWf9aUdpqGZ7/_ssgManifest.js" defer=""></script></head><body class="guideBody"><div id="__next"><div class="docWrapper"><header data-elastic-exclude="true"><div class="euiHeader euiHeader--dark euiHeader--fixed"><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><a rel="noreferrer" class="euiHeaderLogo"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--large euiIcon-isLoading euiHeaderLogo__icon" focusable="false" role="img" aria-label="Elastic" aria-hidden="true"></svg><span class="euiHeaderLogo__text"><svg class="elasticMark" width="64" height="19" fill="white" xmlns="http://www.w3.org/2000/svg" aria-labelledby="elasticMark"><title id="elasticMark">Elastic</title><path d="M9.74 16.882l.711-.076.046 1.455c-1.879.257-3.485.393-4.818.393-1.773 0-3.03-.515-3.773-1.545C1.164 16.08.8 14.473.8 12.306c0-4.333 1.727-6.5 5.167-6.5 1.666 0 2.909.47 3.727 1.394.818.924 1.227 2.394 1.227 4.379l-.106 1.409H2.664c0 1.364.242 2.379.742 3.03.5.652 1.349.985 2.576.985 1.242.03 2.485-.015 3.757-.121zm-.667-5.349c0-1.515-.243-2.59-.728-3.212-.484-.621-1.272-.94-2.363-.94s-1.924.334-2.47.986c-.545.651-.833 1.712-.848 3.166h6.409zM13.497 18.427V.7h1.848v17.727h-1.848zM27.027 9.806v6.076c0 .621 1.53.742 1.53.742l-.09 1.637c-1.303 0-2.38.106-3.03-.515a10.861 10.861 0 01-4.44.924c-1.136 0-2-.319-2.59-.97-.592-.636-.895-1.56-.895-2.773 0-1.197.303-2.09.91-2.651.605-.56 1.56-.925 2.863-1.046l3.879-.363v-1.06c0-.834-.182-1.44-.546-1.804-.363-.364-.863-.545-1.485-.545H18.27V5.82h4.742c1.394 0 2.41.318 3.046.97.651.636.97 1.651.97 3.015zm-7.606 5.03c0 1.516.621 2.273 1.879 2.273a9.89 9.89 0 003.303-.56l.56-.197v-4.076l-3.65.348c-.743.06-1.274.273-1.607.637-.333.363-.485.894-.485 1.575zM34.255 7.473c-1.788 0-2.697.62-2.697 1.879 0 .575.212.984.62 1.227.41.242 1.35.485 2.819.742 1.47.258 2.5.606 3.106 1.076.606.454.91 1.318.91 2.59 0 1.274-.41 2.198-1.228 2.789-.818.59-2 .894-3.576.894-1.015 0-4.424-.38-4.424-.38l.106-1.605c1.954.182 3.379.333 4.333.333.955 0 1.682-.151 2.182-.454.5-.303.758-.819.758-1.53 0-.713-.212-1.198-.637-1.455-.424-.258-1.363-.5-2.818-.728-1.455-.227-2.485-.56-3.09-1.015-.607-.439-.91-1.272-.91-2.47 0-1.196.424-2.09 1.273-2.666.848-.576 1.909-.864 3.166-.864 1 0 4.485.258 4.485.258v1.621c-1.833-.106-3.333-.242-4.379-.242zM47.952 7.685h-3.925v5.909c0 1.409.106 2.348.303 2.788.212.44.697.666 1.47.666l2.197-.151.121 1.53c-1.106.182-1.94.273-2.515.273-1.288 0-2.167-.318-2.667-.94-.5-.62-.742-1.818-.742-3.575v-6.5h-1.758V6.079h1.758V2.29h1.833v3.773h3.925v1.62zM50.527 3.276V1.139h1.849v2.152l-1.849-.015zm0 15.151V6.08h1.849v12.348h-1.849zM60.406 5.821c.546 0 1.47.106 2.773.303l.59.076-.075 1.5c-1.318-.152-2.288-.227-2.91-.227-1.393 0-2.348.333-2.848 1-.5.666-.757 1.909-.757 3.712 0 1.803.227 3.06.697 3.773.47.712 1.44 1.06 2.924 1.06l2.91-.227.075 1.53c-1.53.227-2.682.349-3.44.349-1.924 0-3.257-.5-3.984-1.485-.728-.985-1.106-2.652-1.106-5 0-2.349.393-4 1.181-4.94.803-.939 2.122-1.424 3.97-1.424z"></path></svg></span></a></div></div><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><nav class="euiHeaderLinks" aria-label="App menu"><div class="euiHeaderLinks__list euiHeaderLinks__list--gutterS"><a class="euiButton euiButton--primary euiButton--small euiButton--fill" href="https://cloud.elastic.co/registration?source=docsHeader" rel=""><span class="euiButtonContent euiButton__content"><span class="euiButton__text">Try Free</span></span></a></div></nav></div></div></div></header><div class="euiPage euiPage--grow docArticle__template"><div class="euiPageSideBar euiPageSideBar--paddingLarge euiPageSideBar--sticky docChrome__sidebar"><div class="euiFlexItem" data-elastic-exclude="true"><div class="euiContextMenu docChrome__contextMenu"><div class="euiContextMenuPanel euiContextMenu__panel" tabindex="-1"><button class="euiContextMenuPanelTitle" type="button" data-test-subj="contextMenuPanelTitleButton"><span class="euiContextMenu__itemLayout"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading euiContextMenu__icon" focusable="false" role="img" aria-hidden="true"></svg><span class="euiContextMenu__text">Elastic 영상 모음</span></span></button><div><style data-emotion="css i2qclb-euiSpacer-s">.css-i2qclb-euiSpacer-s{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:8px;}</style><div class="euiSpacer euiSpacer--s css-i2qclb-euiSpacer-s"></div><nav class="euiSideNav" aria-label="Elastic 영상 모음"><div id="euiSideNav_b962c2c0-eaaa-11ec-a211-dbb6688063ae_content" class="euiSideNav__content euiSideNav__contentMobile-xs euiSideNav__contentMobile-s"><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">Elastic 영상 모음</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/overview" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">페이지 소개</span></span></a></div></div></div><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">데이터 수집 및 시각화 데모</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-seoulMetro2019" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">(2019) 서울시 지하철 대시보드 만들기</span></span></a></div></div></div><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">(2021) 처음부터 시작하는 Elastic</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-0" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">0. 과정 소개 및 시스템 준비</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-1" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">1. Stack 설치 및 환경 설정</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-2" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">2. 데이터 활용 및 QueryDSL</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-3" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">3. 데이터 파이프라인 구성</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-4" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">4. Kibana 대시보드 만들기</span></span></a></div></div></div></div></nav></div></div></div></div></div><div class="euiPanel euiPanel--paddingLarge euiPanel--borderRadiusNone euiPanel--plain euiPanel--hasShadow euiPageBody euiPageBody--borderRadiusNone euiPageBody--paddingLarge"><div class="euiFlexGroup euiFlexGroup--gutterExtraLarge euiFlexGroup--directionRow euiFlexGroup--responsive docArticle__wrap"><div class="euiFlexItem docArticle__article"><header class="euiPageHeader euiPageHeader--bottomBorder euiPageHeader--responsive euiPageHeader--center"><div class="euiPageHeaderContent"><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--alignItemsFlexStart euiFlexGroup--directionRow euiFlexGroup--responsive euiPageHeaderContent__top"><div class="euiFlexItem"><h1 class="euiTitle euiTitle--large">Providers</h1><style data-emotion="css jz428s-euiSpacer-l">.css-jz428s-euiSpacer-l{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:24px;}</style><div class="euiSpacer euiSpacer--l css-jz428s-euiSpacer-l"></div><div class="euiText euiText--medium euiText--constrainedWidth"><p><span class="euiTextColor euiTextColor--subdued"></span></p></div></div></div></div></header><style data-emotion="css kiiy9t-euiSpacer-xl">.css-kiiy9t-euiSpacer-xl{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:32px;}</style><div class="euiSpacer euiSpacer--xl css-kiiy9t-euiSpacer-xl"></div><div class="euiPanel euiPanel--borderRadiusMedium euiPanel--plain euiPanel--noShadow euiPageContent" role="main"><div class="euiPageContentBody"><div class="euiText euiText--medium"><p>A provider enables Gobld to actually create CI workers somewhere. A provider is a generic way of abstracting the different provider specific configuration and actions needed to manage the machines.</p>
<h2 id="aws-provider" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#aws-provider" rel="noreferrer" aria-label="AWS Provider permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>AWS Provider</h2>
<h3 id="provider-configuration" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#provider-configuration" rel="noreferrer" aria-label="Provider Configuration permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Provider Configuration</h3>
<p>The default provider configuration defines fields that can&#x27;t be changed on a per instance basis.</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token key atrule">providers</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token key atrule">aws</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">config</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">instanceStartTimeout</span><span class="token punctuation">:</span> <span class="token number">300</span>        <span class="token comment"># Duration to wait for instance to enter a running state, in seconds</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">keyPair</span><span class="token punctuation">:</span> <span class="token string">&#x27;elastic-user&#x27;</span>          <span class="token comment"># Default keyPair to use for launched instances</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">project</span><span class="token punctuation">:</span> <span class="token string">&#x27;elastic-prod&#x27;</span>          <span class="token comment"># Project that instances will be launched in</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">region</span><span class="token punctuation">:</span> <span class="token string">&#x27;us-west-2&#x27;</span>              <span class="token comment"># Default region</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">securityGroups</span><span class="token punctuation">:</span>                  <span class="token comment"># Default security groups that will be added to launched instances</span>
</span><span class="euiCodeBlock__line">        <span class="token punctuation">-</span> <span class="token string">&#x27;allow-ssh-from-bastion&#x27;</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">subnetPrefix</span><span class="token punctuation">:</span> <span class="token string">&#x27;buildkite-agents&#x27;</span> <span class="token comment"># Subnet prefix to use for launched instances</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">vpc</span><span class="token punctuation">:</span> <span class="token string">&#x27;buildkite-agents-vpc&#x27;</span>      <span class="token comment"># VPC to use for launched instances</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h3 id="agent-default-configuration" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#agent-default-configuration" rel="noreferrer" aria-label="Agent Default Configuration permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Agent Default Configuration</h3>
<p>The following configuration is used to specify the &quot;default&quot; AWS instance configuration.
All of these fields can be overridden using Agent tags from the Buildkite pipeline.</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token key atrule">providers</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token key atrule">aws</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">defaults</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">diskName</span><span class="token punctuation">:</span> <span class="token string">&#x27;/dev/sda1&#x27;</span>    <span class="token comment"># Default disk name for boot disk. Amazon Linux 2 expects &#x27;/dev/xvda&#x27;</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">diskSizeGb</span><span class="token punctuation">:</span> <span class="token number">30</span>           <span class="token comment"># Default size in gigabytes of the disk</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">diskType</span><span class="token punctuation">:</span> <span class="token string">&#x27;gp3&#x27;</span>          <span class="token comment"># Default disk type to launch instances with</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">instanceType</span><span class="token punctuation">:</span> <span class="token string">&#x27;t2.micro&#x27;</span> <span class="token comment"># Default instanceType for launched instances</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">zones</span><span class="token punctuation">:</span>                   <span class="token comment"># Default list of zones to deploy instances in. Can be overridden at the worker config level</span>
</span><span class="euiCodeBlock__line">        <span class="token punctuation">-</span> <span class="token string">&#x27;us-west-2a&#x27;</span>
</span><span class="euiCodeBlock__line">        <span class="token punctuation">-</span> <span class="token string">&#x27;us-west-2b&#x27;</span>
</span><span class="euiCodeBlock__line">        <span class="token punctuation">-</span> <span class="token string">&#x27;us-west-2c&#x27;</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h3 id="supported-agent-configuration-tags" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#supported-agent-configuration-tags" rel="noreferrer" aria-label="Supported agent configuration tags permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Supported agent configuration tags</h3>
<p>The following agent configuration tags are supported by the AWS provider:</p>
<table tabindex="-1" class="euiTable euiTable--responsive"><thead><tr class="euiTableRow"><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Tag</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Description</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Type</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Default</span></span></th></tr></thead><tbody><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">diskName</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">The name of the boot disk for launched instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">diskSizeGb</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">The size of the Persistent Disk to allocate to this VM instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Integer</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">diskType</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">The type of Persistent Disk to allocate to this VM instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">image</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">AWS image to use for this instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">imagePrefix</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">AWS image prefix to search</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">instanceMaxAge</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">How long can this agent live for in minutes</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Integer</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">instanceType</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">AWS instance type to use for VM instance.</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">zones</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">List of AWS zones to consider when launching VM instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">List</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr></tbody></table>
<h3 id="latest-amis---aka-image-families" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#latest-amis---aka-image-families" rel="noreferrer" aria-label="Latest AMI&#x27;s - aka Image Families permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Latest AMI&#x27;s - aka Image Families</h3>
<p>AWS doesn&#x27;t currently have the concept of Image Families in the same way that GCP does.
That means in order to support the same workflow whereby instances automatically use the &quot;latest&quot; available AMI, we added the <code class="euiCode" data-code-language="text">imagePrefix</code> field to the AWS worker config.</p>
<p>If an <code class="euiCode" data-code-language="text">imagePrefix</code> is supplied for a given worker configuration, <code class="euiCode" data-code-language="text">gobld</code> will pull a list of AMI&#x27;s that match the <code class="euiCode" data-code-language="text">imagePrefix</code> value at the time of launching the instance, sort that list and use the most recently created AMI.</p>
<p>If a specific AMI is required, use the <code class="euiCode" data-code-language="text">image</code> config value.</p>
<h2 id="gcp-provider" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#gcp-provider" rel="noreferrer" aria-label="GCP Provider permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>GCP Provider</h2>
<h3 id="provider-configuration-1" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#provider-configuration-1" rel="noreferrer" aria-label="Provider Configuration permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Provider Configuration</h3>
<p>The default provider configuration defines fields that can&#x27;t be changed on a per instance basis.</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token key atrule">providers</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token key atrule">gcp</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">config</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">instanceStartTimeout</span><span class="token punctuation">:</span> <span class="token number">300</span>      <span class="token comment"># Duration to wait for instance to enter a running state, in seconds</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">network</span><span class="token punctuation">:</span> <span class="token string">&#x27;buildkite-agents&#x27;</span>    <span class="token comment"># Network for launched instances</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">project</span><span class="token punctuation">:</span> <span class="token string">&#x27;elastic-ci-prod&#x27;</span>     <span class="token comment"># Project that instances will be launched in</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">rateLimit</span><span class="token punctuation">:</span> <span class="token number">50</span>                  <span class="token comment"># Amount of requests per second to send to GCP</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">region</span><span class="token punctuation">:</span> <span class="token string">&#x27;us-central1&#x27;</span>          <span class="token comment"># Default region</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">subNetwork</span><span class="token punctuation">:</span> <span class="token string">&#x27;buildkite-agents&#x27;</span> <span class="token comment"># Sub-network for launched instances</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h3 id="agent-default-configuration-1" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#agent-default-configuration-1" rel="noreferrer" aria-label="Agent Default Configuration permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Agent Default Configuration</h3>
<p>The following configuration is used to specify the &quot;default&quot; GCP instance configuration.
All of these fields can be overridden using Agent tags from the Buildkite pipeline.</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token key atrule">providers</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token key atrule">gcp</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">defaults</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">assignExternalIP</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>                    <span class="token comment"># Setting this to false will result in no external IP address being assigned to the launched instance, thereby using NAT instead</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">diskSizeGb</span><span class="token punctuation">:</span> <span class="token number">30</span>                            <span class="token comment"># Default size in gigabytes of the disk</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">diskType</span><span class="token punctuation">:</span> <span class="token string">&#x27;pd-ssd&#x27;</span>                        <span class="token comment"># Default disk type to launch instances with</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">enableSecureBoot</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>                   <span class="token comment"># Setting this to true will enable secure boot on the instance https://cloud.google.com/security/shielded-cloud/shielded-vm#secure-boot</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&#x27;family/elastic-buildkite-agent-ubuntu-2004-lts&#x27;</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">localSsds</span><span class="token punctuation">:</span> <span class="token number">0</span>                              <span class="token comment"># Default number of local SSDs / scratch disks https://cloud.google.com/compute/docs/disks/local-ssd</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">localSsdInterface</span><span class="token punctuation">:</span> <span class="token string">&#x27;NVME&#x27;</span>                 <span class="token comment"># Default interface used for local SSDs, if any are specified. See below gotchas and more info</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">machineType</span><span class="token punctuation">:</span> <span class="token string">&#x27;n1-standard-4&#x27;</span>              <span class="token comment"># Default machineType for launched instances</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">minCpuPlatform</span><span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span>                        <span class="token comment"># Default minimum CPU platform for launched instances</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">imageProject</span><span class="token punctuation">:</span> <span class="token string">&#x27;elastic-images-prod&#x27;</span>       <span class="token comment"># The default project where the instances images are located</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">networkTags</span><span class="token punctuation">:</span>                              <span class="token comment"># Default network tags that will be added to launched instances</span>
</span><span class="euiCodeBlock__line">        <span class="token punctuation">-</span> <span class="token string">&#x27;buildkite-agent&#x27;</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">preemptible</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>                        <span class="token comment"># Setting this to true will launch a preemtible instance https://cloud.google.com/compute/docs/instances/preemptible</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">schedulingNodeAffinity</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                <span class="token comment"># Affinity labels for scheduling bring your own license workers on sole-tenant nodes</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">serviceAccount</span><span class="token punctuation">:</span> <span class="token string">&#x27;&lt;service account email&gt;&#x27;</span> <span class="token comment"># Default service account to assign to launched instance.</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">zones</span><span class="token punctuation">:</span>                                    <span class="token comment"># Default list of zones to deploy instances in. Can be overridden at the worker config level</span>
</span><span class="euiCodeBlock__line">        <span class="token punctuation">-</span> <span class="token string">&#x27;us-central1-a&#x27;</span>
</span><span class="euiCodeBlock__line">        <span class="token punctuation">-</span> <span class="token string">&#x27;us-central1-b&#x27;</span>
</span><span class="euiCodeBlock__line">        <span class="token punctuation">-</span> <span class="token string">&#x27;us-central1-c&#x27;</span>
</span><span class="euiCodeBlock__line">        <span class="token punctuation">-</span> <span class="token string">&#x27;us-central1-f&#x27;</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h3 id="supported-agent-configuration-tags-1" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#supported-agent-configuration-tags-1" rel="noreferrer" aria-label="Supported agent configuration tags permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Supported agent configuration tags</h3>
<p>The following agent configuration tags are supported by the GCP provider:</p>
<table tabindex="-1" class="euiTable euiTable--responsive"><thead><tr class="euiTableRow"><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Tag</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Description</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Type</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Default</span></span></th></tr></thead><tbody><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">diskSizeGb</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">The size of the Persistent Disk to allocate to this VM instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Integer</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">diskType</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">The type of Persistent Disk to allocate to this VM instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">enableSecureBoot</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Should Secure boot be enabled on this instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Bool</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">image</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">GCP image or image family to use for this instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">imageProject</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">GCP project to read <code class="euiCode" data-code-language="text">image</code> from</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">instanceMaxAge</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">How long can this agent live for in minutes</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Integer</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">localSsds</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Number of local SSDs to allocate to this VM instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Integrer</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">localSsdInterface</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">SSD Interface to use for local SSD resources</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">machineType</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">GCP machine type to use for VM instance. Can either be pre-defined or custom. See below.</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">minCpuPlatform</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Minimum CPU platform to requst for VM instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">preemptible</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Should the launched VM instance be preemptible?</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Bool</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">useVault</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Should a Vault token be generated and injected for this agent?</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Bool</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">zones</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">List of GCP zones to consider when launching VM instance</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">List</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr></tbody></table>
<h3 id="custom-machine-types" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#custom-machine-types" rel="noreferrer" aria-label="Custom machine types permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Custom machine types</h3>
<p>In addition to the <a class="euiLink euiLink--primary" href="https://cloud.google.com/compute/docs/machine-types#predefined_machine_types" rel="noreferrer">pre-defined machine types<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> offered by GCP,
it is also possible to specify a <a class="euiLink euiLink--primary" href="https://cloud.google.com/compute/docs/machine-types#custom_machine_types" rel="noreferrer">custom machine type<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</p>
<p>There are a few <a class="euiLink euiLink--primary" href="https://cloud.google.com/compute/docs/instances/creating-instance-with-custom-machine-type#specifications" rel="noreferrer">limitations<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> when it
comes to defining a custom machine type configuration. They are explained in more detail on the relevant Google Cloud docs page linked above.</p>
<p>In order to specify a custom machine type for use with <code class="euiCode" data-code-language="text">gobld</code>, the <code class="euiCode" data-code-language="text">machineType</code> config item should be formatted as follows:</p>
<div><div class="euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="text"><span class="euiCodeBlock__line">machineType: &#x27;custom-&lt;CPUS&gt;-&lt;MEMORY&gt;&#x27;
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<p>Where:</p>
<ul>
<li><code class="euiCode" data-code-language="text">&lt;CPUS&gt;</code> can either be 1; or a multiple of 2, upto the maximum permissible vCPU count</li>
<li><code class="euiCode" data-code-language="text">&lt;MEMORY&gt;</code> is the total memory for this instance, in multiples of 256MB and specified in MB units. E.g. <code class="euiCode" data-code-language="text">5 GB</code> of memory is <code class="euiCode" data-code-language="text">5120</code></li>
</ul>
<p>For example, to specify a worker configuration with <code class="euiCode" data-code-language="text">8</code> CPUs and <code class="euiCode" data-code-language="text">64GB</code> of RAM, the appropriate <code class="euiCode" data-code-language="text">machineType</code> value is:</p>
<div><div class="euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="text"><span class="euiCodeBlock__line">machineType: &#x27;custom-8-65536&#x27;
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h3 id="local-ssds--scratch-disks" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#local-ssds--scratch-disks" rel="noreferrer" aria-label="Local SSDs / Scratch Disks permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Local SSDs / Scratch Disks</h3>
<p><a class="euiLink euiLink--primary" href="https://cloud.google.com/compute/docs/disks/local-ssd" rel="noreferrer">Local SSDs<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> are high-performance SSD storage devices attached to the physical machine where your compute instance is running. Because they are attached to the physical host, all data will be lost when the instance shuts off. They are very well-suited for ephemeral workloads that require high I/O.</p>
<p>Each attached disk is 375GB in size and is cheaper per-GB than persistent disks.</p>
<p>When the instance comes online, the disks will be unformatted and unmounted (i.e. not usable) unless the instance image you select has support for automatically formatting and mounting attached disks. <a class="euiLink euiLink--primary" href="https://cloud.google.com/compute/docs/disks/local-ssd#formatindividual" rel="noreferrer">See here<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> for instructions on how to manually do this.</p>
<h3 id="shielded-vm-configuration--secure-boot" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#shielded-vm-configuration--secure-boot" rel="noreferrer" aria-label="Shielded VM Configuration / Secure Boot permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Shielded VM Configuration / Secure Boot</h3>
<p>GCP offers three <a class="euiLink euiLink--primary" href="https://cloud.google.com/security/shielded-cloud/shielded-vm" rel="noreferrer">Shielded VM<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> features:</p>
<ul>
<li>
<p>Secure Boot</p>
</li>
<li>
<p>vTPM (Virtual Trusted Platform Module)</p>
</li>
<li>
<p>Integrity Monitoring</p>
</li>
</ul>
<p>vTPM and Integrity Monitoring are enabled by default. <code class="euiCode" data-code-language="text">gobld</code> allows you to toggle Secure Boot on by setting the boolean <code class="euiCode" data-code-language="text">enableSecureBoot</code> config property.</p>
<p>Note that Shielded VM Config can only be set when using an image with a UEFI-compatible disk.</p>
<p>Also, Secure Boot does not play nicely with VirtualBox so avoid enabling Secure Boot on instances with VirtualBox installed.</p>
<h3 id="interface---scsi-vs-nvme" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#interface---scsi-vs-nvme" rel="noreferrer" aria-label="Interface - SCSI vs NVME permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Interface - SCSI vs NVME</h3>
<p><a class="euiLink euiLink--primary" href="https://cloud.google.com/compute/docs/disks/local-ssd#choose_an_interface" rel="noreferrer">GCP Documentation<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a></p>
<p>The default local SSD interface is NVME. The other option is SCSI.</p>
<p>NVME has the highest possible performance, but SCSI has maximum performance for more images (for example, all Windows images). SCSI also requires more configuration in some scenarios and anecdotally <a class="euiLink euiLink--primary" href="https://github.com/elastic/infra/issues/7594#issuecomment-529352396" rel="noreferrer">has more issues<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> <a class="euiLink euiLink--primary" href="https://github.com/elastic/dev/issues/1176#issuecomment-525373742" rel="noreferrer">compared to NVME<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</p>
<p>If you&#x27;re not sure which to use, use the default, and switch it if you run into issues.</p>
<h2 id="kubernetes-provider" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#kubernetes-provider" rel="noreferrer" aria-label="Kubernetes Provider permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Kubernetes Provider</h2>
<p>The Kubernetes provider enables launching Buildkite agents in a Kubernetes cluster.</p>
<p><strong>N.B</strong>: Currently our configured GKE node-pools utilise autoscaling with a minimum value of <code class="euiCode" data-code-language="text">0</code>.
Therefore there might be a short delay to worker startup if there are no available GKE nodes.</p>
<h2 id="provider-configuration-2" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#provider-configuration-2" rel="noreferrer" aria-label="Provider Configuration permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Provider Configuration</h2>
<p>The default provider configuration defines fields that can&#x27;t be changed on a per pod basis.</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token key atrule">providers</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token key atrule">k8s</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">config</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">agentTokenSecret</span><span class="token punctuation">:</span> <span class="token string">&#x27;buildkite-agent-token&#x27;</span> <span class="token comment"># The Kubernetes secret that contains the Buildkite agent token to map through to the pod env.</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span> <span class="token string">&#x27;elastic-prod-registry&#x27;</span> <span class="token comment"># The Kubernetes imagePullSecrets for the image</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> <span class="token string">&#x27;jenkins-agents&#x27;</span>               <span class="token comment"># The Kubernetes namespace to launch the workers in</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">nodePoolLabel</span><span class="token punctuation">:</span> <span class="token string">&#x27;jenkins-agents&#x27;</span>           <span class="token comment"># Kubernetes node pool selector label</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">podStartTimeout</span><span class="token punctuation">:</span> <span class="token number">300</span>                      <span class="token comment"># How long to wait for a pod to enter the `RUNNING` phase</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h3 id="agent-default-configuration-2" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#agent-default-configuration-2" rel="noreferrer" aria-label="Agent Default Configuration permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Agent Default Configuration</h3>
<p>The following configuration is used to specify the &quot;default&quot; K8s pod configuration.
All of these fields can be overridden using Agent tags from the Buildkite pipeline.</p>
<div><div class="language-yaml euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="yaml"><span class="euiCodeBlock__line"><span class="token key atrule">providers</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">  <span class="token key atrule">k8s</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">    <span class="token key atrule">defaults</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">agentImage</span><span class="token punctuation">:</span> <span class="token string">&#x27;&lt;buildkite-agent-sidecar docker image&gt;&#x27;</span> <span class="token comment"># The agent injector image to use as an init container.</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">&#x27;1000m&#x27;</span>                                         <span class="token comment"># The CPU resources for the container</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">ephemeralStorage</span><span class="token punctuation">:</span> <span class="token string">&#x27;10G&#x27;</span>                              <span class="token comment"># The ephemeral storage resources for the container</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">injectAgent</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>                                    <span class="token comment"># Should the Buildkite agent be injected into the Kubernetes pod</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">&#x27;1000Mi&#x27;</span>                                     <span class="token comment"># The Memory resources for the container</span>
</span><span class="euiCodeBlock__line">      <span class="token key atrule">podAnnotations</span><span class="token punctuation">:</span>                                      <span class="token comment"># Annotations to apply to the launched pod.</span>
</span><span class="euiCodeBlock__line">        <span class="token key atrule">key</span><span class="token punctuation">:</span> value
</span><span class="euiCodeBlock__line">      <span class="token key atrule">serviceAccount</span><span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span>                                   <span class="token comment"># Service account to assign to pod</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h3 id="supported-agent-configuration-tags-2" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#supported-agent-configuration-tags-2" rel="noreferrer" aria-label="Supported agent configuration tags permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Supported agent configuration tags</h3>
<p>The following agent configuration tags are supported by the Kubernetes provider:</p>
<table tabindex="-1" class="euiTable euiTable--responsive"><thead><tr class="euiTableRow"><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Tag</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Description</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Type</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Default</span></span></th></tr></thead><tbody><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">agentImage</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">The agent injector image to use as an init container, the contents of which will be copied to <code class="euiCode" data-code-language="text">/buildkite/</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">cpu</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Amount of CPU resources to allocate to agent container. Must be a valid Kubernetes resource format.</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">ephemeralStorage</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Amount of ephemeral storage to assign to the agent. The ephemeral storage is provisioned using Local SSDs mounted on the Kubernetes node.</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">image</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Container image to use.</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">None</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">imageUID</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Container UID</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Integer</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">None</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">injectAgent</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Should the Buildkite agent be injected into the container</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Bool</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">instanceMaxAge</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">How long can this agent live for in minutes</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Integer</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">memory</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Amount of Memory resources to allocate to the agent container. Must be a valid Kubenetes resource format.</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">serviceAccount</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Kubenetes Service account to mount to the container</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">String</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">useVault</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Should a Vault token be generated and injected for this agent?</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Bool</code></span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><code class="euiCode" data-code-language="text">Provider default</code></span></div></td></tr></tbody></table>
<h3 id="injecting-the-buildkite-agent" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#injecting-the-buildkite-agent" rel="noreferrer" aria-label="Injecting the Buildkite Agent permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Injecting the Buildkite Agent</h3>
<p>Running Buildkite Agent&#x27;s as Kubernetes pods enables us to leverage the capabilities offered to us by Kubernetes.
One of those capabilities is the option to inject an <code class="euiCode" data-code-language="text">initContainer</code> as part of the Kubernetes pod definition.</p>
<p>This <code class="euiCode" data-code-language="text">initContainer</code> runs before the &quot;main&quot; container, and is used to setup a shared Kubernetes volume which is used to hold
the contents of the <code class="euiCode" data-code-language="text">agentImage</code> filesystem.</p>
<p>The benefit of this is that the <code class="euiCode" data-code-language="text">agentImage</code> container can contain the bare-minimum of files required to support operating as a
Buildkite-agent, such as the <code class="euiCode" data-code-language="text">buildkite-agent</code> binary and config file, any additional binaries that would be useful like Vault,
plus any hooks or plugins that we wish to include by default.</p>
<p>The shared Kubernetes volume then gets mounted into the &quot;main&quot; container as <code class="euiCode" data-code-language="text">/buildkite-agent</code>, and the Builkite-agent process
is launched from this volume.</p>
<h3 id="controlling-the-process-uid" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#controlling-the-process-uid" rel="noreferrer" aria-label="Controlling the Process UID permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Controlling the Process UID</h3>
<p>By default, containers are executed as the <code class="euiCode" data-code-language="text">root</code> user with a UID of <code class="euiCode" data-code-language="text">0</code>.</p>
<p>This ensures the maximum compatability with upstream or Bring-Your-Own (BYO) images that are commonly found on the Docker Hub,
such as <code class="euiCode" data-code-language="text">golang</code>, <code class="euiCode" data-code-language="text">maven</code>, etc.</p>
<p>In some cases it&#x27;s necessary to ensure that processes are executed under a specific &quot;non-root&quot; UID. This could be due to
application requirements, security restrictions etc.<br/>
<!-- -->If this is the case, the <code class="euiCode" data-code-language="text">imageUID</code> agent tag can be specified. This value will then be used to apply a corresponding
SecurityContext to the generated pod, thereby ensuring that the process UID and GID are set to the specified value, and any
files are correctly permissioned into the specified UID.</p>
<p><strong>N.B</strong>: The specified UID needs to exist within the Docker image. Otherwise the Agent is likely to fail to launch.</p>
<p>If your <code class="euiCode" data-code-language="text">Dockerfile</code> defines a <code class="euiCode" data-code-language="text">USER &lt;user&gt;[:&lt;group&gt;]</code> instruction, then the <code class="euiCode" data-code-language="text">UID</code> of that user should match the <code class="euiCode" data-code-language="text">imageUID</code> defined in pipeline.</p>
<p>The easiest way to identify the correct <code class="euiCode" data-code-language="text">imageUID</code> value is to run the <code class="euiCode" data-code-language="text">id</code> command within the container image being used.<br/>
<!-- -->For example:</p>
<div><div class="language-shell euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="shell"><span class="euiCodeBlock__line">$ docker run --rm -it golang:1.18 <span class="token function">id</span>
</span><span class="euiCodeBlock__line"><span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h2 id="provider-interface" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#provider-interface" rel="noreferrer" aria-label="Provider interface permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Provider interface</h2>
<p>To be a provider in Gobld you will need to implement the <a class="euiLink euiLink--primary" href="https://github.com/elastic/gobld/tree/main/models/provider.go" rel="noreferrer"><code class="euiCode" data-code-language="text">models.Provider</code> interface<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a></p>
<h3 id="configuration-and-initialization" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#configuration-and-initialization" rel="noreferrer" aria-label="Configuration and initialization permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Configuration and initialization</h3>
<p>Each provider is responsible for parsing, validating and merging its own configuration. For both the provider configuration and the worker configuration it will be passed a <code class="euiCode" data-code-language="text">map[string]interface{}</code> that can be decoded into an internal configuration struct using <code class="euiCode" data-code-language="text">mapstructure.Decode</code>. For an example take a look at the <code class="euiCode" data-code-language="text">processConfig</code> function in the GCP provider.</p>
<p>On initialization (<code class="euiCode" data-code-language="text">func init()</code>) the provider should register itself with the <code class="euiCode" data-code-language="text">New()</code> function that will load and validate the provider and its configuration. This function will be called as part of the validation Gobld does on PR testing so should catch any configuration issues before they get deployed.</p>
<h3 id="connect" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#connect" rel="noreferrer" aria-label="Connect permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Connect</h3>
<p>This function will actually authenticate and connect the provider on startup. This is separated from <code class="euiCode" data-code-language="text">New()</code> so that we are able to validate configuration separately from actually connecting to the provider.</p>
<h3 id="create" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#create" rel="noreferrer" aria-label="Create permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Create</h3>
<p>When Gobld decides to create a worker this is how it asks the provider to create it:</p>
<div><div class="euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="text"><span class="euiCodeBlock__line">name string              # The name of the worker
</span><span class="euiCodeBlock__line">workerConfig string      # The worker configuration that Gobld wants the provider to launch
</span><span class="euiCodeBlock__line">seed int64               # A number based off the build ID and amount of retry attempts. This can be used by providers to round robin between different availability zones
</span><span class="euiCodeBlock__line">labels []string          # A list of extra labels which should be appended to the worker configuration
</span><span class="euiCodeBlock__line">config map[string]string # A list of dynamic configuration that has been set via Jenkins labels
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<p>In this function the provider will generally need to:</p>
<ul>
<li>Retrieve the actual configuration for the worker that has been requested</li>
<li>Append any extra labels</li>
<li>Update the configuration based on the dynamic configuration</li>
<li>Optionally calculate which zone to create the instance in based off the <code class="euiCode" data-code-language="text">seed</code></li>
<li>Supply the to be created instance with its Jenkins swarm configuration (using something like a metadata service, cloud config or similar service for the provider)</li>
<li>Create the instance</li>
</ul>
<h3 id="delete" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#delete" rel="noreferrer" aria-label="Delete permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Delete</h3>
<p>Once a worker is no longer needed Gobld will ask for it to be deleted from the provider:</p>
<div><div class="euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="text"><span class="euiCodeBlock__line">name string      # The name of the worker that should be deleted
</span><span class="euiCodeBlock__line">instanceMetadata # A mapping of instance metadata that is provided by List(). This can be used as an optimization for providers that need to know which zone and instance is in.
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h3 id="list" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#list" rel="noreferrer" aria-label="List permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>List</h3>
<p>Returns a list of all workers in the provider. It is important that this function returns all workers that haven&#x27;t completed their Gobld lifecycle. I.e. Do not just include a list of <code class="euiCode" data-code-language="text">running</code> workers. As this list will also be used by Gobld to properly cleanup workers that have failed to launch and get into a running state.</p>
<div><div class="euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="text"><span class="euiCodeBlock__line">workers []string                   # A list of workers that should match the names given to Create()
</span><span class="euiCodeBlock__line">instanceMetadata map[string]string # A map that can be used by providers to be able to optimize delete operations (e.g. keeping a mapping of each instance and which zone they are in)
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h2 id="managing-providers" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#managing-providers" rel="noreferrer" aria-label="Managing providers permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Managing providers</h2>
<h2 id="registering-your-provider" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#registering-your-provider" rel="noreferrer" aria-label="Registering your provider permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Registering your provider</h2>
<p>Include your provider in <a class="euiLink euiLink--primary" href="https://github.com/elastic/gobld/tree/main/providers/_all/all.go" rel="noreferrer">providers/_all/all.go<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a></p>
<h3 id="rate-limiting" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#rate-limiting" rel="noreferrer" aria-label="Rate limiting permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Rate limiting</h3>
<p>Providers are responsible for implementing their own rate limiting. Gobld prioritizes requesting new instances as fast as possible (by calling Create() async).</p></div><div class="euiSpacer euiSpacer--l css-jz428s-euiSpacer-l"></div><div class="euiText euiText--small"><div class="euiTextColor euiTextColor--subdued">Last updated: Mar 28th, 2022</div></div></div></div></div></div></div></div><footer class="docChromeFooter" data-elastic-exclude="true"><div class="euiFlexGroup euiFlexGroup--justifyContentSpaceAround euiFlexGroup--directionRow euiFlexGroup--responsive"><div class="euiFlexItem euiFlexItem--flexGrowZero docChromeFooter__container"><div class="euiFlexGroup euiFlexGroup--gutterExtraLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--directionRow euiFlexGroup--responsive"><div class="euiFlexItem"><div class="euiText euiText--small"><div class="euiTextColor euiTextColor--ghost"><p>Elasticsearch is a trademark of Elasticsearch B.V., registered in the U.S. and in other countries.</p><p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the Apache Software Foundation in the United States and/or other countries.</p><p> <a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/trademarks" rel="">Trademarks</a><span class="docChromeFooter__divide">|</span><a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/terms-of-use" rel="">Terms of Use</a><span class="docChromeFooter__divide">|</span><a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/privacy-statement" rel="">Privacy</a><span class="docChromeFooter__divide">|</span>© <!-- -->2022<!-- --> Elasticsearch B.V. All Rights Reserved</p></div></div></div><div class="euiFlexItem euiFlexItem--flexGrowZero"></div><div class="euiFlexItem euiFlexItem--flexGrowZero"><figure class="euiImage docChromeFooter__logo"><img style="max-width:xs;max-height:xs;width:auto" src="/assets/images/logo-elastic-vertical-reverse.svg" class="euiImage__img" alt="Elastic logo"/></figure></div></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"bundle":"!function(e,t){\"object\"==typeof exports\u0026\u0026\"object\"==typeof module?module.exports=t(require(\"mdxJsReact\"),require(\"React\")):\"function\"==typeof define\u0026\u0026define.amd?define([\"mdxJsReact\",\"React\"],t):\"object\"==typeof exports?exports.MDXContent=t(require(\"mdxJsReact\"),require(\"React\")):e.MDXContent=t(e.mdxJsReact,e.React)}(this,((e,t)=\u003e(()=\u003e{\"use strict\";var n={24:e=\u003e{e.exports=t},825:t=\u003e{t.exports=e}},l={};function a(e){var t=l[e];if(void 0!==t)return t.exports;var i=l[e]={exports:{}};return n[e](i,i.exports,a),i.exports}a.n=e=\u003e{var t=e\u0026\u0026e.__esModule?()=\u003ee.default:()=\u003ee;return a.d(t,{a:t}),t},a.d=(e,t)=\u003e{for(var n in t)a.o(t,n)\u0026\u0026!a.o(e,n)\u0026\u0026Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=\u003eObject.prototype.hasOwnProperty.call(e,t),a.r=e=\u003e{\"undefined\"!=typeof Symbol\u0026\u0026Symbol.toStringTag\u0026\u0026Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})};var i={};return(()=\u003e{a.r(i),a.d(i,{default:()=\u003el});var e=a(825),t=a(24),n=a.n(t);const l=function(){var t=arguments.length\u003e0\u0026\u0026void 0!==arguments[0]?arguments[0]:{},l=Object.assign({},(0,e.useMDXComponents)(),t.components),a=l.wrapper;return a?n().createElement(a,t,n().createElement(i)):i();function i(){var l=Object.assign({p:\"p\",h2:\"h2\",h3:\"h3\",pre:\"pre\",code:\"code\",table:\"table\",thead:\"thead\",tr:\"tr\",th:\"th\",tbody:\"tbody\",td:\"td\",a:\"a\",ul:\"ul\",li:\"li\",strong:\"strong\",br:\"br\"},(0,e.useMDXComponents)(),t.components);return n().createElement(n().Fragment,null,n().createElement(l.p,null,\"A provider enables Gobld to actually create CI workers somewhere. A provider is a generic way of abstracting the different provider specific configuration and actions needed to manage the machines.\"),\"\\n\",n().createElement(l.h2,{id:\"aws-provider\"},\"AWS Provider\"),\"\\n\",n().createElement(l.h3,{id:\"provider-configuration\"},\"Provider Configuration\"),\"\\n\",n().createElement(l.p,null,\"The default provider configuration defines fields that can't be changed on a per instance basis.\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},\"providers:\\n  aws:\\n    config:\\n      instanceStartTimeout: 300        # Duration to wait for instance to enter a running state, in seconds\\n      keyPair: 'elastic-user'          # Default keyPair to use for launched instances\\n      project: 'elastic-prod'          # Project that instances will be launched in\\n      region: 'us-west-2'              # Default region\\n      securityGroups:                  # Default security groups that will be added to launched instances\\n        - 'allow-ssh-from-bastion'\\n      subnetPrefix: 'buildkite-agents' # Subnet prefix to use for launched instances\\n      vpc: 'buildkite-agents-vpc'      # VPC to use for launched instances\\n\")),\"\\n\",n().createElement(l.h3,{id:\"agent-default-configuration\"},\"Agent Default Configuration\"),\"\\n\",n().createElement(l.p,null,'The following configuration is used to specify the \"default\" AWS instance configuration.\\nAll of these fields can be overridden using Agent tags from the Buildkite pipeline.'),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},\"providers:\\n  aws:\\n    defaults:\\n      diskName: '/dev/sda1'    # Default disk name for boot disk. Amazon Linux 2 expects '/dev/xvda'\\n      diskSizeGb: 30           # Default size in gigabytes of the disk\\n      diskType: 'gp3'          # Default disk type to launch instances with\\n      instanceType: 't2.micro' # Default instanceType for launched instances\\n      zones:                   # Default list of zones to deploy instances in. Can be overridden at the worker config level\\n        - 'us-west-2a'\\n        - 'us-west-2b'\\n        - 'us-west-2c'\\n\")),\"\\n\",n().createElement(l.h3,{id:\"supported-agent-configuration-tags\"},\"Supported agent configuration tags\"),\"\\n\",n().createElement(l.p,null,\"The following agent configuration tags are supported by the AWS provider:\"),\"\\n\",n().createElement(l.table,null,n().createElement(l.thead,null,n().createElement(l.tr,null,n().createElement(l.th,null,\"Tag\"),n().createElement(l.th,null,\"Description\"),n().createElement(l.th,null,\"Type\"),n().createElement(l.th,null,\"Default\"))),n().createElement(l.tbody,null,n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"diskName\")),n().createElement(l.td,null,\"The name of the boot disk for launched instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"diskSizeGb\")),n().createElement(l.td,null,\"The size of the Persistent Disk to allocate to this VM instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Integer\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"diskType\")),n().createElement(l.td,null,\"The type of Persistent Disk to allocate to this VM instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"image\")),n().createElement(l.td,null,\"AWS image to use for this instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"imagePrefix\")),n().createElement(l.td,null,\"AWS image prefix to search\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"instanceMaxAge\")),n().createElement(l.td,null,\"How long can this agent live for in minutes\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Integer\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"instanceType\")),n().createElement(l.td,null,\"AWS instance type to use for VM instance.\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"zones\")),n().createElement(l.td,null,\"List of AWS zones to consider when launching VM instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"List\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))))),\"\\n\",n().createElement(l.h3,{id:\"latest-amis---aka-image-families\"},\"Latest AMI's - aka Image Families\"),\"\\n\",n().createElement(l.p,null,'AWS doesn\\'t currently have the concept of Image Families in the same way that GCP does.\\nThat means in order to support the same workflow whereby instances automatically use the \"latest\" available AMI, we added the ',n().createElement(l.code,{display:\"inline\"},\"imagePrefix\"),\" field to the AWS worker config.\"),\"\\n\",n().createElement(l.p,null,\"If an \",n().createElement(l.code,{display:\"inline\"},\"imagePrefix\"),\" is supplied for a given worker configuration, \",n().createElement(l.code,{display:\"inline\"},\"gobld\"),\" will pull a list of AMI's that match the \",n().createElement(l.code,{display:\"inline\"},\"imagePrefix\"),\" value at the time of launching the instance, sort that list and use the most recently created AMI.\"),\"\\n\",n().createElement(l.p,null,\"If a specific AMI is required, use the \",n().createElement(l.code,{display:\"inline\"},\"image\"),\" config value.\"),\"\\n\",n().createElement(l.h2,{id:\"gcp-provider\"},\"GCP Provider\"),\"\\n\",n().createElement(l.h3,{id:\"provider-configuration-1\"},\"Provider Configuration\"),\"\\n\",n().createElement(l.p,null,\"The default provider configuration defines fields that can't be changed on a per instance basis.\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},\"providers:\\n  gcp:\\n    config:\\n      instanceStartTimeout: 300      # Duration to wait for instance to enter a running state, in seconds\\n      network: 'buildkite-agents'    # Network for launched instances\\n      project: 'elastic-ci-prod'     # Project that instances will be launched in\\n      rateLimit: 50                  # Amount of requests per second to send to GCP\\n      region: 'us-central1'          # Default region\\n      subNetwork: 'buildkite-agents' # Sub-network for launched instances\\n\")),\"\\n\",n().createElement(l.h3,{id:\"agent-default-configuration-1\"},\"Agent Default Configuration\"),\"\\n\",n().createElement(l.p,null,'The following configuration is used to specify the \"default\" GCP instance configuration.\\nAll of these fields can be overridden using Agent tags from the Buildkite pipeline.'),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},\"providers:\\n  gcp:\\n    defaults:\\n      assignExternalIP: true                    # Setting this to false will result in no external IP address being assigned to the launched instance, thereby using NAT instead\\n      diskSizeGb: 30                            # Default size in gigabytes of the disk\\n      diskType: 'pd-ssd'                        # Default disk type to launch instances with\\n      enableSecureBoot: false                   # Setting this to true will enable secure boot on the instance https://cloud.google.com/security/shielded-cloud/shielded-vm#secure-boot\\n      image: 'family/elastic-buildkite-agent-ubuntu-2004-lts'\\n      localSsds: 0                              # Default number of local SSDs / scratch disks https://cloud.google.com/compute/docs/disks/local-ssd\\n      localSsdInterface: 'NVME'                 # Default interface used for local SSDs, if any are specified. See below gotchas and more info\\n      machineType: 'n1-standard-4'              # Default machineType for launched instances\\n      minCpuPlatform: ''                        # Default minimum CPU platform for launched instances\\n      imageProject: 'elastic-images-prod'       # The default project where the instances images are located\\n      networkTags:                              # Default network tags that will be added to launched instances\\n        - 'buildkite-agent'\\n      preemptible: false                        # Setting this to true will launch a preemtible instance https://cloud.google.com/compute/docs/instances/preemptible\\n      schedulingNodeAffinity: {}                # Affinity labels for scheduling bring your own license workers on sole-tenant nodes\\n      serviceAccount: '\u003cservice account email\u003e' # Default service account to assign to launched instance.\\n      zones:                                    # Default list of zones to deploy instances in. Can be overridden at the worker config level\\n        - 'us-central1-a'\\n        - 'us-central1-b'\\n        - 'us-central1-c'\\n        - 'us-central1-f'\\n\")),\"\\n\",n().createElement(l.h3,{id:\"supported-agent-configuration-tags-1\"},\"Supported agent configuration tags\"),\"\\n\",n().createElement(l.p,null,\"The following agent configuration tags are supported by the GCP provider:\"),\"\\n\",n().createElement(l.table,null,n().createElement(l.thead,null,n().createElement(l.tr,null,n().createElement(l.th,null,\"Tag\"),n().createElement(l.th,null,\"Description\"),n().createElement(l.th,null,\"Type\"),n().createElement(l.th,null,\"Default\"))),n().createElement(l.tbody,null,n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"diskSizeGb\")),n().createElement(l.td,null,\"The size of the Persistent Disk to allocate to this VM instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Integer\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"diskType\")),n().createElement(l.td,null,\"The type of Persistent Disk to allocate to this VM instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"enableSecureBoot\")),n().createElement(l.td,null,\"Should Secure boot be enabled on this instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Bool\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"image\")),n().createElement(l.td,null,\"GCP image or image family to use for this instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"imageProject\")),n().createElement(l.td,null,\"GCP project to read \",n().createElement(l.code,{display:\"inline\"},\"image\"),\" from\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"instanceMaxAge\")),n().createElement(l.td,null,\"How long can this agent live for in minutes\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Integer\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"localSsds\")),n().createElement(l.td,null,\"Number of local SSDs to allocate to this VM instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Integrer\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"localSsdInterface\")),n().createElement(l.td,null,\"SSD Interface to use for local SSD resources\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"machineType\")),n().createElement(l.td,null,\"GCP machine type to use for VM instance. Can either be pre-defined or custom. See below.\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"minCpuPlatform\")),n().createElement(l.td,null,\"Minimum CPU platform to requst for VM instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"preemptible\")),n().createElement(l.td,null,\"Should the launched VM instance be preemptible?\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Bool\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"useVault\")),n().createElement(l.td,null,\"Should a Vault token be generated and injected for this agent?\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Bool\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"zones\")),n().createElement(l.td,null,\"List of GCP zones to consider when launching VM instance\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"List\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))))),\"\\n\",n().createElement(l.h3,{id:\"custom-machine-types\"},\"Custom machine types\"),\"\\n\",n().createElement(l.p,null,\"In addition to the \",n().createElement(l.a,{href:\"https://cloud.google.com/compute/docs/machine-types#predefined_machine_types\"},\"pre-defined machine types\"),\" offered by GCP,\\nit is also possible to specify a \",n().createElement(l.a,{href:\"https://cloud.google.com/compute/docs/machine-types#custom_machine_types\"},\"custom machine type\"),\".\"),\"\\n\",n().createElement(l.p,null,\"There are a few \",n().createElement(l.a,{href:\"https://cloud.google.com/compute/docs/instances/creating-instance-with-custom-machine-type#specifications\"},\"limitations\"),\" when it\\ncomes to defining a custom machine type configuration. They are explained in more detail on the relevant Google Cloud docs page linked above.\"),\"\\n\",n().createElement(l.p,null,\"In order to specify a custom machine type for use with \",n().createElement(l.code,{display:\"inline\"},\"gobld\"),\", the \",n().createElement(l.code,{display:\"inline\"},\"machineType\"),\" config item should be formatted as follows:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{display:\"block\"},\"machineType: 'custom-\u003cCPUS\u003e-\u003cMEMORY\u003e'\\n\")),\"\\n\",n().createElement(l.p,null,\"Where:\"),\"\\n\",n().createElement(l.ul,null,\"\\n\",n().createElement(l.li,null,n().createElement(l.code,{display:\"inline\"},\"\u003cCPUS\u003e\"),\" can either be 1; or a multiple of 2, upto the maximum permissible vCPU count\"),\"\\n\",n().createElement(l.li,null,n().createElement(l.code,{display:\"inline\"},\"\u003cMEMORY\u003e\"),\" is the total memory for this instance, in multiples of 256MB and specified in MB units. E.g. \",n().createElement(l.code,{display:\"inline\"},\"5 GB\"),\" of memory is \",n().createElement(l.code,{display:\"inline\"},\"5120\")),\"\\n\"),\"\\n\",n().createElement(l.p,null,\"For example, to specify a worker configuration with \",n().createElement(l.code,{display:\"inline\"},\"8\"),\" CPUs and \",n().createElement(l.code,{display:\"inline\"},\"64GB\"),\" of RAM, the appropriate \",n().createElement(l.code,{display:\"inline\"},\"machineType\"),\" value is:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{display:\"block\"},\"machineType: 'custom-8-65536'\\n\")),\"\\n\",n().createElement(l.h3,{id:\"local-ssds--scratch-disks\"},\"Local SSDs / Scratch Disks\"),\"\\n\",n().createElement(l.p,null,n().createElement(l.a,{href:\"https://cloud.google.com/compute/docs/disks/local-ssd\"},\"Local SSDs\"),\" are high-performance SSD storage devices attached to the physical machine where your compute instance is running. Because they are attached to the physical host, all data will be lost when the instance shuts off. They are very well-suited for ephemeral workloads that require high I/O.\"),\"\\n\",n().createElement(l.p,null,\"Each attached disk is 375GB in size and is cheaper per-GB than persistent disks.\"),\"\\n\",n().createElement(l.p,null,\"When the instance comes online, the disks will be unformatted and unmounted (i.e. not usable) unless the instance image you select has support for automatically formatting and mounting attached disks. \",n().createElement(l.a,{href:\"https://cloud.google.com/compute/docs/disks/local-ssd#formatindividual\"},\"See here\"),\" for instructions on how to manually do this.\"),\"\\n\",n().createElement(l.h3,{id:\"shielded-vm-configuration--secure-boot\"},\"Shielded VM Configuration / Secure Boot\"),\"\\n\",n().createElement(l.p,null,\"GCP offers three \",n().createElement(l.a,{href:\"https://cloud.google.com/security/shielded-cloud/shielded-vm\"},\"Shielded VM\"),\" features:\"),\"\\n\",n().createElement(l.ul,null,\"\\n\",n().createElement(l.li,null,\"\\n\",n().createElement(l.p,null,\"Secure Boot\"),\"\\n\"),\"\\n\",n().createElement(l.li,null,\"\\n\",n().createElement(l.p,null,\"vTPM (Virtual Trusted Platform Module)\"),\"\\n\"),\"\\n\",n().createElement(l.li,null,\"\\n\",n().createElement(l.p,null,\"Integrity Monitoring\"),\"\\n\"),\"\\n\"),\"\\n\",n().createElement(l.p,null,\"vTPM and Integrity Monitoring are enabled by default. \",n().createElement(l.code,{display:\"inline\"},\"gobld\"),\" allows you to toggle Secure Boot on by setting the boolean \",n().createElement(l.code,{display:\"inline\"},\"enableSecureBoot\"),\" config property.\"),\"\\n\",n().createElement(l.p,null,\"Note that Shielded VM Config can only be set when using an image with a UEFI-compatible disk.\"),\"\\n\",n().createElement(l.p,null,\"Also, Secure Boot does not play nicely with VirtualBox so avoid enabling Secure Boot on instances with VirtualBox installed.\"),\"\\n\",n().createElement(l.h3,{id:\"interface---scsi-vs-nvme\"},\"Interface - SCSI vs NVME\"),\"\\n\",n().createElement(l.p,null,n().createElement(l.a,{href:\"https://cloud.google.com/compute/docs/disks/local-ssd#choose_an_interface\"},\"GCP Documentation\")),\"\\n\",n().createElement(l.p,null,\"The default local SSD interface is NVME. The other option is SCSI.\"),\"\\n\",n().createElement(l.p,null,\"NVME has the highest possible performance, but SCSI has maximum performance for more images (for example, all Windows images). SCSI also requires more configuration in some scenarios and anecdotally \",n().createElement(l.a,{href:\"https://github.com/elastic/infra/issues/7594#issuecomment-529352396\"},\"has more issues\"),\" \",n().createElement(l.a,{href:\"https://github.com/elastic/dev/issues/1176#issuecomment-525373742\"},\"compared to NVME\"),\".\"),\"\\n\",n().createElement(l.p,null,\"If you're not sure which to use, use the default, and switch it if you run into issues.\"),\"\\n\",n().createElement(l.h2,{id:\"kubernetes-provider\"},\"Kubernetes Provider\"),\"\\n\",n().createElement(l.p,null,\"The Kubernetes provider enables launching Buildkite agents in a Kubernetes cluster.\"),\"\\n\",n().createElement(l.p,null,n().createElement(l.strong,null,\"N.B\"),\": Currently our configured GKE node-pools utilise autoscaling with a minimum value of \",n().createElement(l.code,{display:\"inline\"},\"0\"),\".\\nTherefore there might be a short delay to worker startup if there are no available GKE nodes.\"),\"\\n\",n().createElement(l.h2,{id:\"provider-configuration-2\"},\"Provider Configuration\"),\"\\n\",n().createElement(l.p,null,\"The default provider configuration defines fields that can't be changed on a per pod basis.\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},\"providers:\\n  k8s:\\n    config:\\n      agentTokenSecret: 'buildkite-agent-token' # The Kubernetes secret that contains the Buildkite agent token to map through to the pod env.\\n      imagePullSecrets: 'elastic-prod-registry' # The Kubernetes imagePullSecrets for the image\\n      namespace: 'jenkins-agents'               # The Kubernetes namespace to launch the workers in\\n      nodePoolLabel: 'jenkins-agents'           # Kubernetes node pool selector label\\n      podStartTimeout: 300                      # How long to wait for a pod to enter the `RUNNING` phase\\n\")),\"\\n\",n().createElement(l.h3,{id:\"agent-default-configuration-2\"},\"Agent Default Configuration\"),\"\\n\",n().createElement(l.p,null,'The following configuration is used to specify the \"default\" K8s pod configuration.\\nAll of these fields can be overridden using Agent tags from the Buildkite pipeline.'),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-yaml\",display:\"block\"},\"providers:\\n  k8s:\\n    defaults:\\n      agentImage: '\u003cbuildkite-agent-sidecar docker image\u003e' # The agent injector image to use as an init container.\\n      cpu: '1000m'                                         # The CPU resources for the container\\n      ephemeralStorage: '10G'                              # The ephemeral storage resources for the container\\n      injectAgent: true                                    # Should the Buildkite agent be injected into the Kubernetes pod\\n      memory: '1000Mi'                                     # The Memory resources for the container\\n      podAnnotations:                                      # Annotations to apply to the launched pod.\\n        key: value\\n      serviceAccount: ''                                   # Service account to assign to pod\\n\")),\"\\n\",n().createElement(l.h3,{id:\"supported-agent-configuration-tags-2\"},\"Supported agent configuration tags\"),\"\\n\",n().createElement(l.p,null,\"The following agent configuration tags are supported by the Kubernetes provider:\"),\"\\n\",n().createElement(l.table,null,n().createElement(l.thead,null,n().createElement(l.tr,null,n().createElement(l.th,null,\"Tag\"),n().createElement(l.th,null,\"Description\"),n().createElement(l.th,null,\"Type\"),n().createElement(l.th,null,\"Default\"))),n().createElement(l.tbody,null,n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"agentImage\")),n().createElement(l.td,null,\"The agent injector image to use as an init container, the contents of which will be copied to \",n().createElement(l.code,{display:\"inline\"},\"/buildkite/\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"cpu\")),n().createElement(l.td,null,\"Amount of CPU resources to allocate to agent container. Must be a valid Kubernetes resource format.\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"ephemeralStorage\")),n().createElement(l.td,null,\"Amount of ephemeral storage to assign to the agent. The ephemeral storage is provisioned using Local SSDs mounted on the Kubernetes node.\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"image\")),n().createElement(l.td,null,\"Container image to use.\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"None\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"imageUID\")),n().createElement(l.td,null,\"Container UID\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Integer\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"None\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"injectAgent\")),n().createElement(l.td,null,\"Should the Buildkite agent be injected into the container\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Bool\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"instanceMaxAge\")),n().createElement(l.td,null,\"How long can this agent live for in minutes\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Integer\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"memory\")),n().createElement(l.td,null,\"Amount of Memory resources to allocate to the agent container. Must be a valid Kubenetes resource format.\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"serviceAccount\")),n().createElement(l.td,null,\"Kubenetes Service account to mount to the container\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"String\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))),n().createElement(l.tr,null,n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"useVault\")),n().createElement(l.td,null,\"Should a Vault token be generated and injected for this agent?\"),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Bool\")),n().createElement(l.td,null,n().createElement(l.code,{display:\"inline\"},\"Provider default\"))))),\"\\n\",n().createElement(l.h3,{id:\"injecting-the-buildkite-agent\"},\"Injecting the Buildkite Agent\"),\"\\n\",n().createElement(l.p,null,\"Running Buildkite Agent's as Kubernetes pods enables us to leverage the capabilities offered to us by Kubernetes.\\nOne of those capabilities is the option to inject an \",n().createElement(l.code,{display:\"inline\"},\"initContainer\"),\" as part of the Kubernetes pod definition.\"),\"\\n\",n().createElement(l.p,null,\"This \",n().createElement(l.code,{display:\"inline\"},\"initContainer\"),' runs before the \"main\" container, and is used to setup a shared Kubernetes volume which is used to hold\\nthe contents of the ',n().createElement(l.code,{display:\"inline\"},\"agentImage\"),\" filesystem.\"),\"\\n\",n().createElement(l.p,null,\"The benefit of this is that the \",n().createElement(l.code,{display:\"inline\"},\"agentImage\"),\" container can contain the bare-minimum of files required to support operating as a\\nBuildkite-agent, such as the \",n().createElement(l.code,{display:\"inline\"},\"buildkite-agent\"),\" binary and config file, any additional binaries that would be useful like Vault,\\nplus any hooks or plugins that we wish to include by default.\"),\"\\n\",n().createElement(l.p,null,'The shared Kubernetes volume then gets mounted into the \"main\" container as ',n().createElement(l.code,{display:\"inline\"},\"/buildkite-agent\"),\", and the Builkite-agent process\\nis launched from this volume.\"),\"\\n\",n().createElement(l.h3,{id:\"controlling-the-process-uid\"},\"Controlling the Process UID\"),\"\\n\",n().createElement(l.p,null,\"By default, containers are executed as the \",n().createElement(l.code,{display:\"inline\"},\"root\"),\" user with a UID of \",n().createElement(l.code,{display:\"inline\"},\"0\"),\".\"),\"\\n\",n().createElement(l.p,null,\"This ensures the maximum compatability with upstream or Bring-Your-Own (BYO) images that are commonly found on the Docker Hub,\\nsuch as \",n().createElement(l.code,{display:\"inline\"},\"golang\"),\", \",n().createElement(l.code,{display:\"inline\"},\"maven\"),\", etc.\"),\"\\n\",n().createElement(l.p,null,'In some cases it\\'s necessary to ensure that processes are executed under a specific \"non-root\" UID. This could be due to\\napplication requirements, security restrictions etc.',n().createElement(l.br),\"\\n\",\"If this is the case, the \",n().createElement(l.code,{display:\"inline\"},\"imageUID\"),\" agent tag can be specified. This value will then be used to apply a corresponding\\nSecurityContext to the generated pod, thereby ensuring that the process UID and GID are set to the specified value, and any\\nfiles are correctly permissioned into the specified UID.\"),\"\\n\",n().createElement(l.p,null,n().createElement(l.strong,null,\"N.B\"),\": The specified UID needs to exist within the Docker image. Otherwise the Agent is likely to fail to launch.\"),\"\\n\",n().createElement(l.p,null,\"If your \",n().createElement(l.code,{display:\"inline\"},\"Dockerfile\"),\" defines a \",n().createElement(l.code,{display:\"inline\"},\"USER \u003cuser\u003e[:\u003cgroup\u003e]\"),\" instruction, then the \",n().createElement(l.code,{display:\"inline\"},\"UID\"),\" of that user should match the \",n().createElement(l.code,{display:\"inline\"},\"imageUID\"),\" defined in pipeline.\"),\"\\n\",n().createElement(l.p,null,\"The easiest way to identify the correct \",n().createElement(l.code,{display:\"inline\"},\"imageUID\"),\" value is to run the \",n().createElement(l.code,{display:\"inline\"},\"id\"),\" command within the container image being used.\",n().createElement(l.br),\"\\n\",\"For example:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-shell\",display:\"block\"},\"$ docker run --rm -it golang:1.18 id\\nuid=0(root) gid=0(root) groups=0(root)\\n\")),\"\\n\",n().createElement(l.h2,{id:\"provider-interface\"},\"Provider interface\"),\"\\n\",n().createElement(l.p,null,\"To be a provider in Gobld you will need to implement the \",n().createElement(l.a,{href:\"https://github.com/elastic/gobld/tree/main/models/provider.go\"},n().createElement(l.code,{display:\"inline\"},\"models.Provider\"),\" interface\")),\"\\n\",n().createElement(l.h3,{id:\"configuration-and-initialization\"},\"Configuration and initialization\"),\"\\n\",n().createElement(l.p,null,\"Each provider is responsible for parsing, validating and merging its own configuration. For both the provider configuration and the worker configuration it will be passed a \",n().createElement(l.code,{display:\"inline\"},\"map[string]interface{}\"),\" that can be decoded into an internal configuration struct using \",n().createElement(l.code,{display:\"inline\"},\"mapstructure.Decode\"),\". For an example take a look at the \",n().createElement(l.code,{display:\"inline\"},\"processConfig\"),\" function in the GCP provider.\"),\"\\n\",n().createElement(l.p,null,\"On initialization (\",n().createElement(l.code,{display:\"inline\"},\"func init()\"),\") the provider should register itself with the \",n().createElement(l.code,{display:\"inline\"},\"New()\"),\" function that will load and validate the provider and its configuration. This function will be called as part of the validation Gobld does on PR testing so should catch any configuration issues before they get deployed.\"),\"\\n\",n().createElement(l.h3,{id:\"connect\"},\"Connect\"),\"\\n\",n().createElement(l.p,null,\"This function will actually authenticate and connect the provider on startup. This is separated from \",n().createElement(l.code,{display:\"inline\"},\"New()\"),\" so that we are able to validate configuration separately from actually connecting to the provider.\"),\"\\n\",n().createElement(l.h3,{id:\"create\"},\"Create\"),\"\\n\",n().createElement(l.p,null,\"When Gobld decides to create a worker this is how it asks the provider to create it:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{display:\"block\"},\"name string              # The name of the worker\\nworkerConfig string      # The worker configuration that Gobld wants the provider to launch\\nseed int64               # A number based off the build ID and amount of retry attempts. This can be used by providers to round robin between different availability zones\\nlabels []string          # A list of extra labels which should be appended to the worker configuration\\nconfig map[string]string # A list of dynamic configuration that has been set via Jenkins labels\\n\")),\"\\n\",n().createElement(l.p,null,\"In this function the provider will generally need to:\"),\"\\n\",n().createElement(l.ul,null,\"\\n\",n().createElement(l.li,null,\"Retrieve the actual configuration for the worker that has been requested\"),\"\\n\",n().createElement(l.li,null,\"Append any extra labels\"),\"\\n\",n().createElement(l.li,null,\"Update the configuration based on the dynamic configuration\"),\"\\n\",n().createElement(l.li,null,\"Optionally calculate which zone to create the instance in based off the \",n().createElement(l.code,{display:\"inline\"},\"seed\")),\"\\n\",n().createElement(l.li,null,\"Supply the to be created instance with its Jenkins swarm configuration (using something like a metadata service, cloud config or similar service for the provider)\"),\"\\n\",n().createElement(l.li,null,\"Create the instance\"),\"\\n\"),\"\\n\",n().createElement(l.h3,{id:\"delete\"},\"Delete\"),\"\\n\",n().createElement(l.p,null,\"Once a worker is no longer needed Gobld will ask for it to be deleted from the provider:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{display:\"block\"},\"name string      # The name of the worker that should be deleted\\ninstanceMetadata # A mapping of instance metadata that is provided by List(). This can be used as an optimization for providers that need to know which zone and instance is in.\\n\")),\"\\n\",n().createElement(l.h3,{id:\"list\"},\"List\"),\"\\n\",n().createElement(l.p,null,\"Returns a list of all workers in the provider. It is important that this function returns all workers that haven't completed their Gobld lifecycle. I.e. Do not just include a list of \",n().createElement(l.code,{display:\"inline\"},\"running\"),\" workers. As this list will also be used by Gobld to properly cleanup workers that have failed to launch and get into a running state.\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{display:\"block\"},\"workers []string                   # A list of workers that should match the names given to Create()\\ninstanceMetadata map[string]string # A map that can be used by providers to be able to optimize delete operations (e.g. keeping a mapping of each instance and which zone they are in)\\n\")),\"\\n\",n().createElement(l.h2,{id:\"managing-providers\"},\"Managing providers\"),\"\\n\",n().createElement(l.h2,{id:\"registering-your-provider\"},\"Registering your provider\"),\"\\n\",n().createElement(l.p,null,\"Include your provider in \",n().createElement(l.a,{href:\"https://github.com/elastic/gobld/tree/main/providers/_all/all.go\"},\"providers/_all/all.go\")),\"\\n\",n().createElement(l.h3,{id:\"rate-limiting\"},\"Rate limiting\"),\"\\n\",n().createElement(l.p,null,\"Providers are responsible for implementing their own rate limiting. Gobld prioritizes requesting new instances as fast as possible (by calling Create() async).\"))}}})(),i})()));","frontmatter":{"id":"ciGobldProviders","slug":"/ci/gobld/providers/readme","title":"Providers","summary":"Gobld Providers","date":"2022-03-28T00:00:00.000Z","tags":["ci","ci/cd","developer tools","buildkite","gobld","engineering","platform"],"link":"https://github.com/elastic/ci/blob/main","linkPath":"docs/gobld/providers.mdx"},"missionId":"krVideos"},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["ci","gobld","providers","readme"]},"buildId":"AzE3g5BBfFWf9aUdpqGZ7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>