<!DOCTYPE html><html lang="en"><head><meta name="eui-styles"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-24"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'UA-12395217-24', {
                page_path: window.location.pathname,
              });
          </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try{var d=document.documentElement;var e=localStorage.getItem("elastic-docs-theme");if(e){d.setAttribute('data-theme', e)}else{d.setAttribute('data-theme', 'light');}}catch(t){}}();</script><title>Accessing Workday, GitHub, Slack data programmatically | Elastic Documentation</title><meta property="og:title" content="Accessing Workday, GitHub, Slack data programmatically | Elastic Documentation"/><meta class="elastic" name="title" content="Accessing Workday, GitHub, Slack data programmatically"/><meta class="elastic" name="date" content="2022-05-03T00:00:00.000Z"/><meta name="description" content="Need help? Here you&#x27;ll find complete coverage of Elasticsearch, Kibana and more."/><meta property="og:description" content="Need help? Here you&#x27;ll find complete coverage of Elasticsearch, Kibana and more."/><meta name="twitter:site" content="@elastic"/><meta property="og:url" content="http://localhost:3000/ci/whopper"/><link rel="stylesheet" type="text/css" href="/themes/eui_theme_undefined.min.css"/><link rel="stylesheet" type="text/css" href="/themes/theme_undefined.css"/><link rel="shortcut icon" href="/assets/images/favicon.ico"/><meta name="next-head-count" content="14"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-5b19eee634f155d9037d.js" defer=""></script><script src="/_next/static/chunks/framework-bf9b12c23e794b196495.js" defer=""></script><script src="/_next/static/chunks/main-710a14204f294c81ed08.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d9a28ac2b5165b299106.js" defer=""></script><script src="/_next/static/chunks/c78d26b1-ff6470003369f2a26fc7.js" defer=""></script><script src="/_next/static/chunks/103-fd3e1552f32e8c4a6b92.js" defer=""></script><script src="/_next/static/chunks/3674-41861bc71d856d154d9e.js" defer=""></script><script src="/_next/static/chunks/7815-952dc762df3d4a43befe.js" defer=""></script><script src="/_next/static/chunks/9237-e960f47bcd4625ef5949.js" defer=""></script><script src="/_next/static/chunks/4620-e195c3f5ae7ecefc57c7.js" defer=""></script><script src="/_next/static/chunks/8482-a7f4dd7850e2aa9b7794.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...slug%5D-ac753ff46f79468d535c.js" defer=""></script><script src="/_next/static/AzE3g5BBfFWf9aUdpqGZ7/_buildManifest.js" defer=""></script><script src="/_next/static/AzE3g5BBfFWf9aUdpqGZ7/_ssgManifest.js" defer=""></script></head><body class="guideBody"><div id="__next"><div class="docWrapper"><header data-elastic-exclude="true"><div class="euiHeader euiHeader--dark euiHeader--fixed"><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><a rel="noreferrer" class="euiHeaderLogo"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--large euiIcon-isLoading euiHeaderLogo__icon" focusable="false" role="img" aria-label="Elastic" aria-hidden="true"></svg><span class="euiHeaderLogo__text"><svg class="elasticMark" width="64" height="19" fill="white" xmlns="http://www.w3.org/2000/svg" aria-labelledby="elasticMark"><title id="elasticMark">Elastic</title><path d="M9.74 16.882l.711-.076.046 1.455c-1.879.257-3.485.393-4.818.393-1.773 0-3.03-.515-3.773-1.545C1.164 16.08.8 14.473.8 12.306c0-4.333 1.727-6.5 5.167-6.5 1.666 0 2.909.47 3.727 1.394.818.924 1.227 2.394 1.227 4.379l-.106 1.409H2.664c0 1.364.242 2.379.742 3.03.5.652 1.349.985 2.576.985 1.242.03 2.485-.015 3.757-.121zm-.667-5.349c0-1.515-.243-2.59-.728-3.212-.484-.621-1.272-.94-2.363-.94s-1.924.334-2.47.986c-.545.651-.833 1.712-.848 3.166h6.409zM13.497 18.427V.7h1.848v17.727h-1.848zM27.027 9.806v6.076c0 .621 1.53.742 1.53.742l-.09 1.637c-1.303 0-2.38.106-3.03-.515a10.861 10.861 0 01-4.44.924c-1.136 0-2-.319-2.59-.97-.592-.636-.895-1.56-.895-2.773 0-1.197.303-2.09.91-2.651.605-.56 1.56-.925 2.863-1.046l3.879-.363v-1.06c0-.834-.182-1.44-.546-1.804-.363-.364-.863-.545-1.485-.545H18.27V5.82h4.742c1.394 0 2.41.318 3.046.97.651.636.97 1.651.97 3.015zm-7.606 5.03c0 1.516.621 2.273 1.879 2.273a9.89 9.89 0 003.303-.56l.56-.197v-4.076l-3.65.348c-.743.06-1.274.273-1.607.637-.333.363-.485.894-.485 1.575zM34.255 7.473c-1.788 0-2.697.62-2.697 1.879 0 .575.212.984.62 1.227.41.242 1.35.485 2.819.742 1.47.258 2.5.606 3.106 1.076.606.454.91 1.318.91 2.59 0 1.274-.41 2.198-1.228 2.789-.818.59-2 .894-3.576.894-1.015 0-4.424-.38-4.424-.38l.106-1.605c1.954.182 3.379.333 4.333.333.955 0 1.682-.151 2.182-.454.5-.303.758-.819.758-1.53 0-.713-.212-1.198-.637-1.455-.424-.258-1.363-.5-2.818-.728-1.455-.227-2.485-.56-3.09-1.015-.607-.439-.91-1.272-.91-2.47 0-1.196.424-2.09 1.273-2.666.848-.576 1.909-.864 3.166-.864 1 0 4.485.258 4.485.258v1.621c-1.833-.106-3.333-.242-4.379-.242zM47.952 7.685h-3.925v5.909c0 1.409.106 2.348.303 2.788.212.44.697.666 1.47.666l2.197-.151.121 1.53c-1.106.182-1.94.273-2.515.273-1.288 0-2.167-.318-2.667-.94-.5-.62-.742-1.818-.742-3.575v-6.5h-1.758V6.079h1.758V2.29h1.833v3.773h3.925v1.62zM50.527 3.276V1.139h1.849v2.152l-1.849-.015zm0 15.151V6.08h1.849v12.348h-1.849zM60.406 5.821c.546 0 1.47.106 2.773.303l.59.076-.075 1.5c-1.318-.152-2.288-.227-2.91-.227-1.393 0-2.348.333-2.848 1-.5.666-.757 1.909-.757 3.712 0 1.803.227 3.06.697 3.773.47.712 1.44 1.06 2.924 1.06l2.91-.227.075 1.53c-1.53.227-2.682.349-3.44.349-1.924 0-3.257-.5-3.984-1.485-.728-.985-1.106-2.652-1.106-5 0-2.349.393-4 1.181-4.94.803-.939 2.122-1.424 3.97-1.424z"></path></svg></span></a></div></div><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><nav class="euiHeaderLinks" aria-label="App menu"><div class="euiHeaderLinks__list euiHeaderLinks__list--gutterS"><a class="euiButton euiButton--primary euiButton--small euiButton--fill" href="https://cloud.elastic.co/registration?source=docsHeader" rel=""><span class="euiButtonContent euiButton__content"><span class="euiButton__text">Try Free</span></span></a></div></nav></div></div></div></header><div class="euiPage euiPage--grow docArticle__template"><div class="euiPageSideBar euiPageSideBar--paddingLarge euiPageSideBar--sticky docChrome__sidebar"><div class="euiFlexItem" data-elastic-exclude="true"><div class="euiContextMenu docChrome__contextMenu"><div class="euiContextMenuPanel euiContextMenu__panel" tabindex="-1"><button class="euiContextMenuPanelTitle" type="button" data-test-subj="contextMenuPanelTitleButton"><span class="euiContextMenu__itemLayout"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading euiContextMenu__icon" focusable="false" role="img" aria-hidden="true"></svg><span class="euiContextMenu__text">Elastic 영상 모음</span></span></button><div><style data-emotion="css i2qclb-euiSpacer-s">.css-i2qclb-euiSpacer-s{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:8px;}</style><div class="euiSpacer euiSpacer--s css-i2qclb-euiSpacer-s"></div><nav class="euiSideNav" aria-label="Elastic 영상 모음"><div id="euiSideNav_b954e010-eaaa-11ec-8b08-e7ead32ed701_content" class="euiSideNav__content euiSideNav__contentMobile-xs euiSideNav__contentMobile-s"><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">Elastic 영상 모음</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/overview" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">페이지 소개</span></span></a></div></div></div><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">데이터 수집 및 시각화 데모</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-seoulMetro2019" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">(2019) 서울시 지하철 대시보드 만들기</span></span></a></div></div></div><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">(2021) 처음부터 시작하는 Elastic</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-0" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">0. 과정 소개 및 시스템 준비</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-1" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">1. Stack 설치 및 환경 설정</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-2" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">2. 데이터 활용 및 QueryDSL</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-3" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">3. 데이터 파이프라인 구성</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-4" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">4. Kibana 대시보드 만들기</span></span></a></div></div></div></div></nav></div></div></div></div></div><div class="euiPanel euiPanel--paddingLarge euiPanel--borderRadiusNone euiPanel--plain euiPanel--hasShadow euiPageBody euiPageBody--borderRadiusNone euiPageBody--paddingLarge"><div class="euiFlexGroup euiFlexGroup--gutterExtraLarge euiFlexGroup--directionRow euiFlexGroup--responsive docArticle__wrap"><div class="euiFlexItem docArticle__article"><header class="euiPageHeader euiPageHeader--bottomBorder euiPageHeader--responsive euiPageHeader--center"><div class="euiPageHeaderContent"><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--alignItemsFlexStart euiFlexGroup--directionRow euiFlexGroup--responsive euiPageHeaderContent__top"><div class="euiFlexItem"><h1 class="euiTitle euiTitle--large">Accessing Workday, GitHub, Slack data programmatically</h1><style data-emotion="css jz428s-euiSpacer-l">.css-jz428s-euiSpacer-l{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:24px;}</style><div class="euiSpacer euiSpacer--l css-jz428s-euiSpacer-l"></div><div class="euiText euiText--medium euiText--constrainedWidth"><p><span class="euiTextColor euiTextColor--subdued"></span></p></div></div></div></div></header><style data-emotion="css kiiy9t-euiSpacer-xl">.css-kiiy9t-euiSpacer-xl{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:32px;}</style><div class="euiSpacer euiSpacer--xl css-kiiy9t-euiSpacer-xl"></div><div class="euiPanel euiPanel--borderRadiusMedium euiPanel--plain euiPanel--noShadow euiPageContent" role="main"><div class="euiPageContentBody"><div class="euiText euiText--medium"><p>Whopper is an IT maintained database that maps out employee data between the different Elastic back-end systems (GitHub, Workday, Okta, Slack...). This document provides some background around this database and information on how to access it experimentally.</p>
<h2 id="context" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#context" rel="noreferrer" aria-label="Context permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Context</h2>
<h3 id="use-case" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#use-case" rel="noreferrer" aria-label="Use case permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Use case</h3>
<p>Elastic uses different backend systems to perform specfic operations, for example:</p>
<ul>
<li>Workday is used for everything HR related and contains the source of truth around organizational data</li>
<li>GitHub is the source of truth for source code management</li>
</ul>
<p>Elastic employees sign-up to GitHub using their personal GitHub account, and there are no conventions for mapping a GitHub user to the matching Workday profile. Similarly, there are no mappings available between Workday and Slack.</p>
<h3 id="whopper" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#whopper" rel="noreferrer" aria-label="Whopper permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Whopper</h3>
<p><a class="euiLink euiLink--primary" href="https://github.com/elastic/it-eng/blob/1477c913c35de6de5d30dc5633d25c49c04422ce/docs/whopper.md" rel="noreferrer">Whopper<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> is a backend systems owned by IT that focuses on the lifecycle of Elasticians. Most of Elastic applications are integrated with Okta but there are few services and applications still handled manually. This is where the Whopper shines. It has developed a bunch of serverless scripts that actively scans the list of users and groups on the applications in use and stores the data in a postgreSQL database.</p>
<h2 id="accessing-whopper-data" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#accessing-whopper-data" rel="noreferrer" aria-label="Accessing whopper data permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Accessing whopper data</h2>
<p>While whopper is used by the IT team in their day-to-day operations, the CI team occasionally needs to crunch data or correlate information between GitHub, Workday and slack. To that end, a <a class="euiLink euiLink--primary" href="https://github.com/elastic/it-eng/issues/950" rel="noreferrer">request<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> was made to IT to get access to a Whopper export.</p>
<h3 id="gcp-information-and-creds" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#gcp-information-and-creds" rel="noreferrer" aria-label="GCP information and creds permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>GCP information and creds</h3>
<p>At this time, the IT team is providing us a daily whopper export of all the employee data with the below informations for each employee:</p>
<div><div class="language-json euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="json"><span class="euiCodeBlock__line"> <span class="token punctuation">{</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;workday_employee_status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;On board&quot;</span><span class="token punctuation">,</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;workday_employee_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Regular&quot;</span><span class="token punctuation">,</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;firstname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Foo&quot;</span><span class="token punctuation">,</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;lastname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Bar&quot;</span><span class="token punctuation">,</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo.bar@elastic.co&quot;</span><span class="token punctuation">,</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;workday_cost_center&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Solutions - Team&quot;</span><span class="token punctuation">,</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;okta_manager&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bim.bam&quot;</span><span class="token punctuation">,</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;okta_supervisory_org&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Solutions - Team&quot;</span><span class="token punctuation">,</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;workday_supervisor_org&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Solutions - Team (Bim Bam (001234))&quot;</span><span class="token punctuation">,</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;slack_name&quot;</span><span class="token operator">:</span> foobar<span class="token punctuation">,</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;github&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foobar&quot;</span><span class="token punctuation">,</span>
</span><span class="euiCodeBlock__line">    <span class="token property">&quot;github_username&quot;</span><span class="token operator">:</span> foobar
</span><span class="euiCodeBlock__line">  <span class="token punctuation">}</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<p>In <a class="euiLink euiLink--primary" href="https://github.com/elastic/it-eng/issues/950" rel="noreferrer">elastic/it-eng#950<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>, the IT team helped setup a service account to retrieve the data. The important bits are as below:</p>
<ul>
<li>GCP project : &#x27;elastic-it-prod&#x27;</li>
<li>GCP bucket: &#x27;nassim-infra-elastic-it-prod&#x27;</li>
<li>GCP blob: &#x27;v_nassim_query.json&#x27;</li>
<li>Service account creds: currently stored in Vault at <code class="euiCode" data-code-language="text">secret/ci/elastic-ci/whopper_service_account</code></li>
</ul>
<p>Note: Assuming you have the proper access to trigger a re-sync of the data, you can run:</p>
<p><code class="euiCode" data-code-language="text">curl -I https://us-central1-elastic-it-prod.cloudfunctions.net/nassim-puller -H &quot;Authorization: bearer $(gcloud auth print-identity-token)&quot; | grep HTTP | cut -d&#x27; &#x27; -f2</code></p>
<h3 id="accessing-whopper-data-programmatically" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#accessing-whopper-data-programmatically" rel="noreferrer" aria-label="Accessing whopper data programmatically permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Accessing whopper data programmatically</h3>
<p>For your own data analysis needs, you may want to access Whopper data programmatically. You may accomplish this by running the below script:</p>
<ol>
<li>Install requirements</li>
</ol>
<p><code class="euiCode" data-code-language="text">pip install google-cloud-storage</code></p>
<ol start="2">
<li>Write your <code class="euiCode" data-code-language="text">whopper_data.py</code> script</li>
</ol>
<div><div class="language-python euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="python"><span class="euiCodeBlock__line"><span class="token comment">#!/usr/bin/env python3</span>
</span><span class="euiCodeBlock__line"><span class="token keyword">import</span> os
</span><span class="euiCodeBlock__line"><span class="token keyword">import</span> sys
</span><span class="euiCodeBlock__line"><span class="token keyword">import</span> json
</span><span class="euiCodeBlock__line"><span class="token keyword">from</span> google<span class="token punctuation">.</span>cloud <span class="token keyword">import</span> storage
</span><span class="euiCodeBlock__line"><span class="token keyword">from</span> google<span class="token punctuation">.</span>oauth2 <span class="token keyword">import</span> service_account
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">WHOPPER_DATA_GCP_PROJECT<span class="token operator">=</span><span class="token string">&#x27;elastic-it-prod&#x27;</span>
</span><span class="euiCodeBlock__line">WHOPPER_DATA_GCP_BUCKET<span class="token operator">=</span><span class="token string">&#x27;nassim-infra-elastic-it-prod&#x27;</span>
</span><span class="euiCodeBlock__line">WHOPPER_DATA_BLOB<span class="token operator">=</span><span class="token string">&#x27;v_nassim_query.json&#x27;</span>
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line"><span class="token keyword">def</span> <span class="token function">dump_whopper_data</span><span class="token punctuation">(</span>gcs_creds<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">        json_acct_info <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>gcs_creds<span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line">        gs_credentials <span class="token operator">=</span> service_account<span class="token punctuation">.</span>Credentials<span class="token punctuation">.</span>from_service_account_info<span class="token punctuation">(</span>json_acct_info<span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">        gs_client <span class="token operator">=</span> storage<span class="token punctuation">.</span>Client<span class="token punctuation">(</span>project<span class="token operator">=</span>WHOPPER_DATA_GCP_PROJECT<span class="token punctuation">,</span> credentials<span class="token operator">=</span>gs_credentials<span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line">        gs_bucket <span class="token operator">=</span> gs_client<span class="token punctuation">.</span>get_bucket<span class="token punctuation">(</span>WHOPPER_DATA_GCP_BUCKET<span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line">        gs_blob <span class="token operator">=</span> gs_bucket<span class="token punctuation">.</span>get_blob<span class="token punctuation">(</span>WHOPPER_DATA_BLOB<span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">        whopper_data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>gs_blob<span class="token punctuation">.</span>download_as_text<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line">        <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>whopper_data<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#x27;__main__&#x27;</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">    <span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">        gcs_creds <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">&quot;SERVICEACCOUNT_JSON_CREDS&quot;</span><span class="token punctuation">]</span>
</span><span class="euiCodeBlock__line">    <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
</span><span class="euiCodeBlock__line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Json credentials to the whopper account gcs bucket not found in $SERVICEACCOUNT_JSON_CREDS&quot;</span><span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Usage : SERVICEACCOUNT_JSON_CREDS=$(vault read -field=creds path/to/creds) python %s&quot;</span> <span class="token operator">%</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line">        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line">    dump_whopper_data<span class="token punctuation">(</span>gcs_creds<span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<ol start="3">
<li>Run it</li>
</ol>
<p><code class="euiCode" data-code-language="text">SERVICEACCOUNT_JSON_CREDS=$(vault read -field=creds secret/ci/elastic-ci/whopper_service_account) ptyhon whopper_data.py</code></p>
<h2 id="future-steps" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#future-steps" rel="noreferrer" aria-label="Future steps permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Future steps</h2>
<p>Making the above data available programmatically to all Elasticians would be great - an example use case could be around quickly looking up which team a GitHub user is from via a Slack command. And while all the data are available, the webservice with some sort of authentication behind it is yet to be written.</p>
<p>The question of how to implement authentication for such a service is a thorny one - implementing fully-fledged API key management for this system could be overkill, yet some level of authentication is necessary to operate this as a service. Using an Okta integration to authenticate with it may not be the right fit for an API intended to be consumed by human and machine users.</p>
<p>A possible approach would be to use a single, rotating API key stored in Vault and available to all current employees.</p></div><div class="euiSpacer euiSpacer--l css-jz428s-euiSpacer-l"></div><div class="euiText euiText--small"><div class="euiTextColor euiTextColor--subdued">Last updated: May 3rd, 2022</div></div></div></div></div></div></div></div><footer class="docChromeFooter" data-elastic-exclude="true"><div class="euiFlexGroup euiFlexGroup--justifyContentSpaceAround euiFlexGroup--directionRow euiFlexGroup--responsive"><div class="euiFlexItem euiFlexItem--flexGrowZero docChromeFooter__container"><div class="euiFlexGroup euiFlexGroup--gutterExtraLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--directionRow euiFlexGroup--responsive"><div class="euiFlexItem"><div class="euiText euiText--small"><div class="euiTextColor euiTextColor--ghost"><p>Elasticsearch is a trademark of Elasticsearch B.V., registered in the U.S. and in other countries.</p><p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the Apache Software Foundation in the United States and/or other countries.</p><p> <a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/trademarks" rel="">Trademarks</a><span class="docChromeFooter__divide">|</span><a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/terms-of-use" rel="">Terms of Use</a><span class="docChromeFooter__divide">|</span><a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/privacy-statement" rel="">Privacy</a><span class="docChromeFooter__divide">|</span>© <!-- -->2022<!-- --> Elasticsearch B.V. All Rights Reserved</p></div></div></div><div class="euiFlexItem euiFlexItem--flexGrowZero"></div><div class="euiFlexItem euiFlexItem--flexGrowZero"><figure class="euiImage docChromeFooter__logo"><img style="max-width:xs;max-height:xs;width:auto" src="/assets/images/logo-elastic-vertical-reverse.svg" class="euiImage__img" alt="Elastic logo"/></figure></div></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"bundle":"!function(e,t){\"object\"==typeof exports\u0026\u0026\"object\"==typeof module?module.exports=t(require(\"mdxJsReact\"),require(\"React\")):\"function\"==typeof define\u0026\u0026define.amd?define([\"mdxJsReact\",\"React\"],t):\"object\"==typeof exports?exports.MDXContent=t(require(\"mdxJsReact\"),require(\"React\")):e.MDXContent=t(e.mdxJsReact,e.React)}(this,((e,t)=\u003e(()=\u003e{\"use strict\";var n={24:e=\u003e{e.exports=t},825:t=\u003e{t.exports=e}},a={};function o(e){var t=a[e];if(void 0!==t)return t.exports;var r=a[e]={exports:{}};return n[e](r,r.exports,o),r.exports}o.n=e=\u003e{var t=e\u0026\u0026e.__esModule?()=\u003ee.default:()=\u003ee;return o.d(t,{a:t}),t},o.d=(e,t)=\u003e{for(var n in t)o.o(t,n)\u0026\u0026!o.o(e,n)\u0026\u0026Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=\u003eObject.prototype.hasOwnProperty.call(e,t),o.r=e=\u003e{\"undefined\"!=typeof Symbol\u0026\u0026Symbol.toStringTag\u0026\u0026Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})};var r={};return(()=\u003e{o.r(r),o.d(r,{default:()=\u003ea});var e=o(825),t=o(24),n=o.n(t);const a=function(){var t=arguments.length\u003e0\u0026\u0026void 0!==arguments[0]?arguments[0]:{},a=Object.assign({},(0,e.useMDXComponents)(),t.components),o=a.wrapper;return o?n().createElement(o,t,n().createElement(r)):r();function r(){var a=Object.assign({p:\"p\",h2:\"h2\",h3:\"h3\",ul:\"ul\",li:\"li\",a:\"a\",pre:\"pre\",code:\"code\",ol:\"ol\"},(0,e.useMDXComponents)(),t.components);return n().createElement(n().Fragment,null,n().createElement(a.p,null,\"Whopper is an IT maintained database that maps out employee data between the different Elastic back-end systems (GitHub, Workday, Okta, Slack...). This document provides some background around this database and information on how to access it experimentally.\"),\"\\n\",n().createElement(a.h2,{id:\"context\"},\"Context\"),\"\\n\",n().createElement(a.h3,{id:\"use-case\"},\"Use case\"),\"\\n\",n().createElement(a.p,null,\"Elastic uses different backend systems to perform specfic operations, for example:\"),\"\\n\",n().createElement(a.ul,null,\"\\n\",n().createElement(a.li,null,\"Workday is used for everything HR related and contains the source of truth around organizational data\"),\"\\n\",n().createElement(a.li,null,\"GitHub is the source of truth for source code management\"),\"\\n\"),\"\\n\",n().createElement(a.p,null,\"Elastic employees sign-up to GitHub using their personal GitHub account, and there are no conventions for mapping a GitHub user to the matching Workday profile. Similarly, there are no mappings available between Workday and Slack.\"),\"\\n\",n().createElement(a.h3,{id:\"whopper\"},\"Whopper\"),\"\\n\",n().createElement(a.p,null,n().createElement(a.a,{href:\"https://github.com/elastic/it-eng/blob/1477c913c35de6de5d30dc5633d25c49c04422ce/docs/whopper.md\"},\"Whopper\"),\" is a backend systems owned by IT that focuses on the lifecycle of Elasticians. Most of Elastic applications are integrated with Okta but there are few services and applications still handled manually. This is where the Whopper shines. It has developed a bunch of serverless scripts that actively scans the list of users and groups on the applications in use and stores the data in a postgreSQL database.\"),\"\\n\",n().createElement(a.h2,{id:\"accessing-whopper-data\"},\"Accessing whopper data\"),\"\\n\",n().createElement(a.p,null,\"While whopper is used by the IT team in their day-to-day operations, the CI team occasionally needs to crunch data or correlate information between GitHub, Workday and slack. To that end, a \",n().createElement(a.a,{href:\"https://github.com/elastic/it-eng/issues/950\"},\"request\"),\" was made to IT to get access to a Whopper export.\"),\"\\n\",n().createElement(a.h3,{id:\"gcp-information-and-creds\"},\"GCP information and creds\"),\"\\n\",n().createElement(a.p,null,\"At this time, the IT team is providing us a daily whopper export of all the employee data with the below informations for each employee:\"),\"\\n\",n().createElement(a.pre,null,n().createElement(a.code,{className:\"language-json\",display:\"block\"},' {\\n    \"workday_employee_status\": \"On board\",\\n    \"workday_employee_type\": \"Regular\",\\n    \"firstname\": \"Foo\",\\n    \"lastname\": \"Bar\",\\n    \"email\": \"foo.bar@elastic.co\",\\n    \"workday_cost_center\": \"Solutions - Team\",\\n    \"okta_manager\": \"bim.bam\",\\n    \"okta_supervisory_org\": \"Solutions - Team\",\\n    \"workday_supervisor_org\": \"Solutions - Team (Bim Bam (001234))\",\\n    \"slack_name\": foobar,\\n    \"github\": \"foobar\",\\n    \"github_username\": foobar\\n  }\\n')),\"\\n\",n().createElement(a.p,null,\"In \",n().createElement(a.a,{href:\"https://github.com/elastic/it-eng/issues/950\"},\"elastic/it-eng#950\"),\", the IT team helped setup a service account to retrieve the data. The important bits are as below:\"),\"\\n\",n().createElement(a.ul,null,\"\\n\",n().createElement(a.li,null,\"GCP project : 'elastic-it-prod'\"),\"\\n\",n().createElement(a.li,null,\"GCP bucket: 'nassim-infra-elastic-it-prod'\"),\"\\n\",n().createElement(a.li,null,\"GCP blob: 'v_nassim_query.json'\"),\"\\n\",n().createElement(a.li,null,\"Service account creds: currently stored in Vault at \",n().createElement(a.code,{display:\"inline\"},\"secret/ci/elastic-ci/whopper_service_account\")),\"\\n\"),\"\\n\",n().createElement(a.p,null,\"Note: Assuming you have the proper access to trigger a re-sync of the data, you can run:\"),\"\\n\",n().createElement(a.p,null,n().createElement(a.code,{display:\"inline\"},\"curl -I https://us-central1-elastic-it-prod.cloudfunctions.net/nassim-puller -H \\\"Authorization: bearer $(gcloud auth print-identity-token)\\\" | grep HTTP | cut -d' ' -f2\")),\"\\n\",n().createElement(a.h3,{id:\"accessing-whopper-data-programmatically\"},\"Accessing whopper data programmatically\"),\"\\n\",n().createElement(a.p,null,\"For your own data analysis needs, you may want to access Whopper data programmatically. You may accomplish this by running the below script:\"),\"\\n\",n().createElement(a.ol,null,\"\\n\",n().createElement(a.li,null,\"Install requirements\"),\"\\n\"),\"\\n\",n().createElement(a.p,null,n().createElement(a.code,{display:\"inline\"},\"pip install google-cloud-storage\")),\"\\n\",n().createElement(a.ol,{start:\"2\"},\"\\n\",n().createElement(a.li,null,\"Write your \",n().createElement(a.code,{display:\"inline\"},\"whopper_data.py\"),\" script\"),\"\\n\"),\"\\n\",n().createElement(a.pre,null,n().createElement(a.code,{className:\"language-python\",display:\"block\"},\"#!/usr/bin/env python3\\nimport os\\nimport sys\\nimport json\\nfrom google.cloud import storage\\nfrom google.oauth2 import service_account\\n\\nWHOPPER_DATA_GCP_PROJECT='elastic-it-prod'\\nWHOPPER_DATA_GCP_BUCKET='nassim-infra-elastic-it-prod'\\nWHOPPER_DATA_BLOB='v_nassim_query.json'\\n\\ndef dump_whopper_data(gcs_creds):\\n        json_acct_info = json.loads(gcs_creds)\\n        gs_credentials = service_account.Credentials.from_service_account_info(json_acct_info)\\n\\n        gs_client = storage.Client(project=WHOPPER_DATA_GCP_PROJECT, credentials=gs_credentials)\\n        gs_bucket = gs_client.get_bucket(WHOPPER_DATA_GCP_BUCKET)\\n        gs_blob = gs_bucket.get_blob(WHOPPER_DATA_BLOB)\\n\\n        whopper_data = json.loads(gs_blob.download_as_text(encoding=\\\"utf-8\\\"))\\n        print(json.dumps(whopper_data, indent=2))\\n\\nif __name__ == '__main__':\\n    try:\\n        gcs_creds = os.environ[\\\"SERVICEACCOUNT_JSON_CREDS\\\"]\\n    except KeyError:\\n        print(\\\"Json credentials to the whopper account gcs bucket not found in $SERVICEACCOUNT_JSON_CREDS\\\")\\n        print(\\\"Usage : SERVICEACCOUNT_JSON_CREDS=$(vault read -field=creds path/to/creds) python %s\\\" % sys.argv[0])\\n        sys.exit(1)\\n    dump_whopper_data(gcs_creds)\\n\")),\"\\n\",n().createElement(a.ol,{start:\"3\"},\"\\n\",n().createElement(a.li,null,\"Run it\"),\"\\n\"),\"\\n\",n().createElement(a.p,null,n().createElement(a.code,{display:\"inline\"},\"SERVICEACCOUNT_JSON_CREDS=$(vault read -field=creds secret/ci/elastic-ci/whopper_service_account) ptyhon whopper_data.py\")),\"\\n\",n().createElement(a.h2,{id:\"future-steps\"},\"Future steps\"),\"\\n\",n().createElement(a.p,null,\"Making the above data available programmatically to all Elasticians would be great - an example use case could be around quickly looking up which team a GitHub user is from via a Slack command. And while all the data are available, the webservice with some sort of authentication behind it is yet to be written.\"),\"\\n\",n().createElement(a.p,null,\"The question of how to implement authentication for such a service is a thorny one - implementing fully-fledged API key management for this system could be overkill, yet some level of authentication is necessary to operate this as a service. Using an Okta integration to authenticate with it may not be the right fit for an API intended to be consumed by human and machine users.\"),\"\\n\",n().createElement(a.p,null,\"A possible approach would be to use a single, rotating API key stored in Vault and available to all current employees.\"))}}})(),r})()));","frontmatter":{"id":"ciDocsWhopper","slug":"/ci/whopper","title":"Accessing Workday, GitHub, Slack data programmatically","summary":"Documentation on how to access Workday, GitHub, Slack employee data programmtically.","date":"2022-05-03T00:00:00.000Z","tags":["developer tools","whopper"],"link":"https://github.com/elastic/ci/blob/main","linkPath":"docs/whopper_data.mdx"},"missionId":"krVideos"},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["ci","whopper"]},"buildId":"AzE3g5BBfFWf9aUdpqGZ7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>