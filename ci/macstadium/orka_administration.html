<!DOCTYPE html><html lang="en"><head><meta name="eui-styles"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-24"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'UA-12395217-24', {
                page_path: window.location.pathname,
              });
          </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try{var d=document.documentElement;var e=localStorage.getItem("elastic-docs-theme");if(e){d.setAttribute('data-theme', e)}else{d.setAttribute('data-theme', 'light');}}catch(t){}}();</script><title>Orka Administration | Elastic Documentation</title><meta property="og:title" content="Orka Administration | Elastic Documentation"/><meta class="elastic" name="title" content="Orka Administration"/><meta class="elastic" name="date" content="2022-05-17T00:00:00.000Z"/><meta name="description" content="Need help? Here you&#x27;ll find complete coverage of Elasticsearch, Kibana and more."/><meta property="og:description" content="Need help? Here you&#x27;ll find complete coverage of Elasticsearch, Kibana and more."/><meta name="twitter:site" content="@elastic"/><meta property="og:url" content="http://localhost:3000/ci/macstadium/orka_administration"/><link rel="stylesheet" type="text/css" href="/themes/eui_theme_undefined.min.css"/><link rel="stylesheet" type="text/css" href="/themes/theme_undefined.css"/><link rel="shortcut icon" href="/assets/images/favicon.ico"/><meta name="next-head-count" content="14"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-5b19eee634f155d9037d.js" defer=""></script><script src="/_next/static/chunks/framework-bf9b12c23e794b196495.js" defer=""></script><script src="/_next/static/chunks/main-710a14204f294c81ed08.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d9a28ac2b5165b299106.js" defer=""></script><script src="/_next/static/chunks/c78d26b1-ff6470003369f2a26fc7.js" defer=""></script><script src="/_next/static/chunks/103-fd3e1552f32e8c4a6b92.js" defer=""></script><script src="/_next/static/chunks/3674-41861bc71d856d154d9e.js" defer=""></script><script src="/_next/static/chunks/7815-952dc762df3d4a43befe.js" defer=""></script><script src="/_next/static/chunks/9237-e960f47bcd4625ef5949.js" defer=""></script><script src="/_next/static/chunks/4620-e195c3f5ae7ecefc57c7.js" defer=""></script><script src="/_next/static/chunks/8482-a7f4dd7850e2aa9b7794.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...slug%5D-ac753ff46f79468d535c.js" defer=""></script><script src="/_next/static/AzE3g5BBfFWf9aUdpqGZ7/_buildManifest.js" defer=""></script><script src="/_next/static/AzE3g5BBfFWf9aUdpqGZ7/_ssgManifest.js" defer=""></script></head><body class="guideBody"><div id="__next"><div class="docWrapper"><header data-elastic-exclude="true"><div class="euiHeader euiHeader--dark euiHeader--fixed"><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><a rel="noreferrer" class="euiHeaderLogo"><svg data-type="logoElastic" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" viewBox="0 0 32 32" class="euiIcon euiIcon--large euiHeaderLogo__icon" focusable="false" role="img" aria-label="Elastic"><path class="outline" fill-rule="evenodd" clip-rule="evenodd" d="M30.86 13.129A6.333 6.333 0 0132 16.77a6.419 6.419 0 01-1.162 3.652 6.382 6.382 0 01-3.032 2.331 4.833 4.833 0 01-1.672 5.542 4.789 4.789 0 01-5.77-.074 9.016 9.016 0 01-4.5 3.322 8.982 8.982 0 01-5.587.023 9.014 9.014 0 01-4.526-3.287 9.067 9.067 0 01-1.727-5.333c0-.579.053-1.156.16-1.725A6.305 6.305 0 011.145 18.9 6.341 6.341 0 010 15.242a6.42 6.42 0 011.163-3.652 6.384 6.384 0 013.035-2.33 4.833 4.833 0 011.658-5.557 4.789 4.789 0 015.78.07 9.037 9.037 0 014.93-3.446 9.007 9.007 0 015.994.419 9.05 9.05 0 014.407 4.098 9.097 9.097 0 01.873 5.965 6.298 6.298 0 013.02 2.32zm-18.28.658l7.002 3.211 7.066-6.213a7.85 7.85 0 00.152-1.557c0-1.692-.539-3.34-1.54-4.704a7.897 7.897 0 00-4.02-2.869 7.87 7.87 0 00-4.932.086 7.9 7.9 0 00-3.92 3.007l-1.174 6.118 1.367 2.92-.001.001zm-7.247 7.441A7.964 7.964 0 006.72 27.53a7.918 7.918 0 004.04 2.874 7.89 7.89 0 004.95-.097 7.92 7.92 0 003.926-3.03l1.166-6.102-1.555-2.985-7.03-3.211-6.885 6.248.001.001zm4.755-11.024l-4.8-1.137.002-.002a3.82 3.82 0 011.312-4.358 3.785 3.785 0 014.538.023l-1.052 5.474zm-5.216.01a5.294 5.294 0 00-2.595 1.882 5.324 5.324 0 00-.142 6.124 5.287 5.287 0 002.505 2l6.733-6.101-1.235-2.65-5.266-1.255zm18.286 17.848a3.737 3.737 0 01-2.285-.785l1.037-5.454 4.8 1.125a3.812 3.812 0 01-1.801 4.68c-.54.283-1.14.432-1.751.434zm-1.31-7.499l5.28 1.238a5.34 5.34 0 002.622-1.938 5.37 5.37 0 001.013-3.106 5.311 5.311 0 00-.936-3.01 5.282 5.282 0 00-2.475-1.944l-6.904 6.07 1.4 2.69z" fill="#fff"></path><path d="M12.58 13.787l7.002 3.211 7.066-6.213a7.849 7.849 0 00.152-1.557c0-1.692-.539-3.34-1.54-4.704a7.897 7.897 0 00-4.02-2.869 7.87 7.87 0 00-4.932.086 7.9 7.9 0 00-3.92 3.007l-1.174 6.118 1.367 2.92-.001.001z" fill="#FEC514"></path><path d="M5.333 21.228A7.964 7.964 0 006.72 27.53a7.918 7.918 0 004.04 2.874 7.89 7.89 0 004.95-.097 7.92 7.92 0 003.926-3.03l1.166-6.102-1.555-2.985-7.03-3.211-6.885 6.248.001.001z" fill="#00BFB3"></path><path d="M5.288 9.067l4.8 1.137L11.14 4.73a3.785 3.785 0 00-5.914 1.94 3.82 3.82 0 00.064 2.395" fill="#F04E98"></path><path d="M4.872 10.214a5.294 5.294 0 00-2.595 1.882 5.324 5.324 0 00-.142 6.124 5.287 5.287 0 002.505 2l6.733-6.101-1.235-2.65-5.266-1.255z" fill="#1BA9F5"></path><path d="M20.873 27.277a3.736 3.736 0 002.285.785 3.783 3.783 0 003.101-1.63 3.812 3.812 0 00.451-3.484l-4.8-1.125-1.037 5.454z" fill="#93C90E"></path><path d="M21.848 20.563l5.28 1.238a5.34 5.34 0 002.622-1.938 5.37 5.37 0 001.013-3.106 5.312 5.312 0 00-.936-3.01 5.283 5.283 0 00-2.475-1.944l-6.904 6.07 1.4 2.69z" fill="#07C"></path></svg><span class="euiHeaderLogo__text"><svg class="elasticMark" width="64" height="19" fill="white" xmlns="http://www.w3.org/2000/svg" aria-labelledby="elasticMark"><title id="elasticMark">Elastic</title><path d="M9.74 16.882l.711-.076.046 1.455c-1.879.257-3.485.393-4.818.393-1.773 0-3.03-.515-3.773-1.545C1.164 16.08.8 14.473.8 12.306c0-4.333 1.727-6.5 5.167-6.5 1.666 0 2.909.47 3.727 1.394.818.924 1.227 2.394 1.227 4.379l-.106 1.409H2.664c0 1.364.242 2.379.742 3.03.5.652 1.349.985 2.576.985 1.242.03 2.485-.015 3.757-.121zm-.667-5.349c0-1.515-.243-2.59-.728-3.212-.484-.621-1.272-.94-2.363-.94s-1.924.334-2.47.986c-.545.651-.833 1.712-.848 3.166h6.409zM13.497 18.427V.7h1.848v17.727h-1.848zM27.027 9.806v6.076c0 .621 1.53.742 1.53.742l-.09 1.637c-1.303 0-2.38.106-3.03-.515a10.861 10.861 0 01-4.44.924c-1.136 0-2-.319-2.59-.97-.592-.636-.895-1.56-.895-2.773 0-1.197.303-2.09.91-2.651.605-.56 1.56-.925 2.863-1.046l3.879-.363v-1.06c0-.834-.182-1.44-.546-1.804-.363-.364-.863-.545-1.485-.545H18.27V5.82h4.742c1.394 0 2.41.318 3.046.97.651.636.97 1.651.97 3.015zm-7.606 5.03c0 1.516.621 2.273 1.879 2.273a9.89 9.89 0 003.303-.56l.56-.197v-4.076l-3.65.348c-.743.06-1.274.273-1.607.637-.333.363-.485.894-.485 1.575zM34.255 7.473c-1.788 0-2.697.62-2.697 1.879 0 .575.212.984.62 1.227.41.242 1.35.485 2.819.742 1.47.258 2.5.606 3.106 1.076.606.454.91 1.318.91 2.59 0 1.274-.41 2.198-1.228 2.789-.818.59-2 .894-3.576.894-1.015 0-4.424-.38-4.424-.38l.106-1.605c1.954.182 3.379.333 4.333.333.955 0 1.682-.151 2.182-.454.5-.303.758-.819.758-1.53 0-.713-.212-1.198-.637-1.455-.424-.258-1.363-.5-2.818-.728-1.455-.227-2.485-.56-3.09-1.015-.607-.439-.91-1.272-.91-2.47 0-1.196.424-2.09 1.273-2.666.848-.576 1.909-.864 3.166-.864 1 0 4.485.258 4.485.258v1.621c-1.833-.106-3.333-.242-4.379-.242zM47.952 7.685h-3.925v5.909c0 1.409.106 2.348.303 2.788.212.44.697.666 1.47.666l2.197-.151.121 1.53c-1.106.182-1.94.273-2.515.273-1.288 0-2.167-.318-2.667-.94-.5-.62-.742-1.818-.742-3.575v-6.5h-1.758V6.079h1.758V2.29h1.833v3.773h3.925v1.62zM50.527 3.276V1.139h1.849v2.152l-1.849-.015zm0 15.151V6.08h1.849v12.348h-1.849zM60.406 5.821c.546 0 1.47.106 2.773.303l.59.076-.075 1.5c-1.318-.152-2.288-.227-2.91-.227-1.393 0-2.348.333-2.848 1-.5.666-.757 1.909-.757 3.712 0 1.803.227 3.06.697 3.773.47.712 1.44 1.06 2.924 1.06l2.91-.227.075 1.53c-1.53.227-2.682.349-3.44.349-1.924 0-3.257-.5-3.984-1.485-.728-.985-1.106-2.652-1.106-5 0-2.349.393-4 1.181-4.94.803-.939 2.122-1.424 3.97-1.424z"></path></svg></span></a></div></div><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><nav class="euiHeaderLinks" aria-label="App menu"><div class="euiHeaderLinks__list euiHeaderLinks__list--gutterS"><a class="euiButton euiButton--primary euiButton--small euiButton--fill" href="https://cloud.elastic.co/registration?source=docsHeader" rel=""><span class="euiButtonContent euiButton__content"><span class="euiButton__text">Try Free</span></span></a></div></nav></div></div></div></header><div class="euiPage euiPage--grow docArticle__template"><div class="euiPageSideBar euiPageSideBar--paddingLarge euiPageSideBar--sticky docChrome__sidebar"><div class="euiFlexItem" data-elastic-exclude="true"><div class="euiContextMenu docChrome__contextMenu"><div class="euiContextMenuPanel euiContextMenu__panel" tabindex="-1"><button class="euiContextMenuPanelTitle" type="button" data-test-subj="contextMenuPanelTitleButton"><span class="euiContextMenu__itemLayout"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading euiContextMenu__icon" focusable="false" role="img" aria-hidden="true"></svg><span class="euiContextMenu__text">Elastic 영상 모음</span></span></button><div><style data-emotion="css i2qclb-euiSpacer-s">.css-i2qclb-euiSpacer-s{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:8px;}</style><div class="euiSpacer euiSpacer--s css-i2qclb-euiSpacer-s"></div><nav class="euiSideNav" aria-label="Elastic 영상 모음"><div id="euiSideNav_b9705750-eaaa-11ec-b972-7dd632392293_content" class="euiSideNav__content euiSideNav__contentMobile-xs euiSideNav__contentMobile-s"><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">Elastic 영상 모음</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/overview" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">페이지 소개</span></span></a></div></div></div><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">데이터 수집 및 시각화 데모</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-seoulMetro2019" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">(2019) 서울시 지하철 대시보드 만들기</span></span></a></div></div></div><div class="euiSideNavItem euiSideNavItem--root euiSideNavItem--hasChildItems"><div class="euiSideNavItemButton"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">(2021) 처음부터 시작하는 Elastic</span></span></div><div class="euiSideNavItem__items"><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-0" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">0. 과정 소개 및 시스템 준비</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-1" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">1. Stack 설치 및 환경 설정</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-2" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">2. 데이터 활용 및 QueryDSL</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-3" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">3. 데이터 파이프라인 구성</span></span></a></div><div class="euiSideNavItem euiSideNavItem--trunk"><a class="euiSideNavItemButton euiSideNavItemButton--isClickable" href="/krVideos/vid-esScratch2021-4" rel="noreferrer"><span class="euiSideNavItemButton__content"><span class="euiSideNavItemButton__label euiSideNavItemButton__label--truncated">4. Kibana 대시보드 만들기</span></span></a></div></div></div></div></nav></div></div></div></div></div><div class="euiPanel euiPanel--paddingLarge euiPanel--borderRadiusNone euiPanel--plain euiPanel--hasShadow euiPageBody euiPageBody--borderRadiusNone euiPageBody--paddingLarge"><div class="euiFlexGroup euiFlexGroup--gutterExtraLarge euiFlexGroup--directionRow euiFlexGroup--responsive docArticle__wrap"><div class="euiFlexItem docArticle__article"><header class="euiPageHeader euiPageHeader--bottomBorder euiPageHeader--responsive euiPageHeader--center"><div class="euiPageHeaderContent"><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--alignItemsFlexStart euiFlexGroup--directionRow euiFlexGroup--responsive euiPageHeaderContent__top"><div class="euiFlexItem"><h1 class="euiTitle euiTitle--large">Orka Administration</h1><div class="euiSpacer euiSpacer--l css-jz428s-euiSpacer-l"></div><div class="euiText euiText--medium euiText--constrainedWidth"><p><span class="euiTextColor euiTextColor--subdued"></span></p></div></div></div></div></header><style data-emotion="css kiiy9t-euiSpacer-xl">.css-kiiy9t-euiSpacer-xl{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:32px;}</style><div class="euiSpacer euiSpacer--xl css-kiiy9t-euiSpacer-xl"></div><div class="euiPanel euiPanel--borderRadiusMedium euiPanel--plain euiPanel--noShadow euiPageContent" role="main"><div class="euiPageContentBody"><div class="euiText euiText--medium"><p>The following information is intended for use by the CI Systems team.
Some of the documented commands or instructions may assume that you
have privileged access to Orka, Vault, etc.</p>
<h2 id="connecting-to-the-vpn" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#connecting-to-the-vpn" rel="noreferrer" aria-label="Connecting to the VPN permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Connecting to the VPN</h2>
<p>In order to use the Orka CLI, UI, or API, you must first use a VPN to
connect to the Orka network.  (The CI agent networks are already
connected.)</p>
<p>First, follow the <a class="euiLink euiLink--primary" href="https://orkadocs.macstadium.com/docs/vpn-connect" rel="noreferrer">instructions to download and install the VPN
client<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</p>
<p>The connection details are stored in <a class="euiLink euiLink--primary" href="secret/macstadium/orka/ORKV10000025" rel="noreferrer">this Vault
key<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</p>
<p>If you are on Linux or Mac then you can use the following to easily
connect:</p>
<div><div class="language-shell euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="shell"><span class="euiCodeBlock__line"><span class="token assign-left variable">SECRET</span><span class="token operator">=</span>/secret/macstadium/orka/ORKV10000025
</span><span class="euiCodeBlock__line">vault <span class="token builtin class-name">read</span> -field password <span class="token variable">$SECRET</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
</span><span class="euiCodeBlock__line">  <span class="token function">sudo</span> openconnect <span class="token punctuation">\</span>
</span><span class="euiCodeBlock__line">    --user<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>vault <span class="token builtin class-name">read</span> -field username $SECRET<span class="token variable">)</span></span> <span class="token punctuation">\</span>
</span><span class="euiCodeBlock__line">    --passwd-on-stdin <span class="token punctuation">\</span>
</span><span class="euiCodeBlock__line">    --servercert  <span class="token variable"><span class="token variable">$(</span>vault <span class="token builtin class-name">read</span> -field servercert $SECRET<span class="token variable">)</span></span> <span class="token punctuation">\</span>
</span><span class="euiCodeBlock__line">    <span class="token variable"><span class="token variable">$(</span>vault <span class="token builtin class-name">read</span> -field server_address $SECRET<span class="token variable">)</span></span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<p>If you are not on Linux or Mac, or would rather use a different
interface for connecting, there are instructions available in the
MacStadium documentation, above.</p>
<h2 id="adding-orka-to-a-jenkins-controller" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#adding-orka-to-a-jenkins-controller" rel="noreferrer" aria-label="Adding Orka to a Jenkins controller permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Adding Orka to a Jenkins controller</h2>
<p>The high level process describe below is as follows:</p>
<ul>
<li>Create new user and allocate nodes</li>
<li>Manually set up Jenkins and test connection</li>
<li>Update Vault and commit config changes to Git so they&#x27;re available
during updates.</li>
</ul>
<h3 id="create-an-orka-user" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#create-an-orka-user" rel="noreferrer" aria-label="Create an Orka User permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Create an Orka User</h3>
<ol>
<li>
<p>Connect to the Orka VPN and log into Orka</p>
</li>
<li>
<p>Use <code class="euiCode" data-code-language="text">orka user create</code> to create a new user for the cluster.</p>
<div><div class="language-shell euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="shell"><span class="euiCodeBlock__line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">JENKINS_NAME</span><span class="token operator">=</span>foo-ci
</span><span class="euiCodeBlock__line">orka user create -e infra-root+orka-<span class="token variable">${JENKINS_NAME}</span>@elastic.co
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
</li>
<li>
<p>Fill in a secure password (don&#x27;t lose it, we&#x27;ll add it to Vault soon)</p>
</li>
<li>
<p>Assign the new user to a group with <code class="euiCode" data-code-language="text">orka user group</code></p>
<div><div class="language-shell euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="shell"><span class="euiCodeBlock__line">orka user group -e infra-root+orka-<span class="token variable">${JENKINS_NAME}</span>@elastic.co -g <span class="token variable">${JENKINS_NAME}</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
</li>
</ol>
<h4 id="assign-orka-nodes" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#assign-orka-nodes" rel="noreferrer" aria-label="Assign Orka Nodes permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Assign Orka Nodes</h4>
<p>We divide the total number of Okra nodes across the teams that have
access to Orka.  This allows us to manage a single Orka cluster but
provide separate pools of workers for our customers.  Putting it a
different way, we allocate and dedicate resources to different teams
so they always have the capacity they expect.</p>
<ol>
<li>
<p>Get the list of nodes intended for the new team (this was likely
provided in an earlier request for more capacity)</p>
</li>
<li>
<p>Use <code class="euiCode" data-code-language="text">orka node group</code> to assign a node to a group.  The group
should be the same one as used above when calling <code class="euiCode" data-code-language="text">orka user group</code>.  Use <code class="euiCode" data-code-language="text">orka node list</code> to check the node names to use.</p>
<div><div class="language-shell euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="shell"><span class="euiCodeBlock__line">orka node group -g <span class="token variable">${JENKINS_NAME}</span> -n <span class="token operator">&lt;</span>Node Name Here<span class="token operator">&gt;</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
</li>
</ol>
<h3 id="set-up-jenkins" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#set-up-jenkins" rel="noreferrer" aria-label="Set Up Jenkins permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Set Up Jenkins</h3>
<h4 id="add-jenkins-credentials" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#add-jenkins-credentials" rel="noreferrer" aria-label="Add Jenkins credentials permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Add Jenkins credentials</h4>
<p>To add a new credential, go to the Jenkins controller and click
<code class="euiCode" data-code-language="text">Manage Jenkins</code> &gt; <code class="euiCode" data-code-language="text">Manage Credentials</code> &gt; <code class="euiCode" data-code-language="text">(global)</code> &gt; <code class="euiCode" data-code-language="text">Add Credentials</code></p>
<p>The URL will look like this page for
<a class="euiLink euiLink--primary" href="https://plumbers-ci.elastic.co/credentials/store/system/domain/_/newCredentials" rel="">plumbers-ci<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</p>
<p><strong>Plugin credentials</strong></p>
<p>This credential is for connecting to the Orka cluster itself (i.e. for
orchestration).</p>
<table tabindex="-1" class="euiTable euiTable--responsive"><thead><tr class="euiTableRow"><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Field</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Value</span></span></th></tr></thead><tbody><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Kind</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Username with password</span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Username</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">(the email address of the newly created user, above)</span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Treat username as secret</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">checked</span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Password</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">(the password for the newly created user, above)</span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">ID</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">orka-plugin-creds</span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Description</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Creds for the Orka plugin</span></div></td></tr></tbody></table>
<p><strong>Agent SSH credentials</strong></p>
<p>This credential is to inform the plugin how to SSH to the ephemeral
VM.</p>
<p>Look up the value for the username and password from vault via:</p>
<div><div class="language-shell euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="shell"><span class="euiCodeBlock__line">vault <span class="token builtin class-name">read</span> secret/ci-systems/orka/default-ssh-credentials 
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<table tabindex="-1" class="euiTable euiTable--responsive"><thead><tr class="euiTableRow"><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Field</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Value</span></span></th></tr></thead><tbody><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Kind</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Username with password</span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Username</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">admin</span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Treat username as secret</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">checked</span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Password</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">(see above)</span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">ID</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">orka-vm-ssh-creds</span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Description</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Orka agent ssh credentials</span></div></td></tr></tbody></table>
<h4 id="jenkins-plugin-setup" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#jenkins-plugin-setup" rel="noreferrer" aria-label="Jenkins plugin setup permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Jenkins plugin setup</h4>
<p>Ensure the plugin is installed by searching for &quot;Orka&quot; in the Plugin
Manager.  Got to <code class="euiCode" data-code-language="text">Manage Jenkins</code> &gt; <code class="euiCode" data-code-language="text">Manage Plugins</code> &gt; <code class="euiCode" data-code-language="text">Installed</code> and
search the page for &quot;Orka&quot;.</p>
<p>Assuming the plugin is installed, there will be a new option on
the Configure Clouds screen at <code class="euiCode" data-code-language="text">Manage Jenkins</code> &gt; <code class="euiCode" data-code-language="text">Manage Nodes and Clouds</code> &gt; <code class="euiCode" data-code-language="text">Configure Clouds</code>.</p>
<p>Click <code class="euiCode" data-code-language="text">Add a new cloud</code> and select <code class="euiCode" data-code-language="text">Orka Cloud</code>.</p>
<table tabindex="-1" class="euiTable euiTable--responsive"><thead><tr class="euiTableRow"><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Field</span></span></th><th class="euiTableHeaderCell" scope="col" role="columnheader"><span class="euiTableCellContent"><span class="euiTableCellContent__text">Value</span></span></th></tr></thead><tbody><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Name of this Cloud</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">MacStadium Orka</span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Orka Credentials</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">(select <code class="euiCode" data-code-language="text">Creds for the Orka plugin</code></span></div></td></tr><tr class="euiTableRow"><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text">Orka Endpoint</span></div></td><td class="euiTableRowCell euiTableRowCell--middle"><div class="euiTableCellContent"><span class="euiTableCellContent__text"><a class="euiLink euiLink--primary" href="http://10.221.188.100" rel="noreferrer">http://10.221.188.100<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a></span></div></td></tr></tbody></table>
<p>Hit <code class="euiCode" data-code-language="text">Test Connection</code> to see if the credential works.  If it doesn&#x27;t,
try logging into Orka with the email and password generated above and
double checking that those fields were copied and pasted correctly
into the Jenkins UI.</p>
<h4 id="add-a-new-jenkins-administrator" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#add-a-new-jenkins-administrator" rel="noreferrer" aria-label="Add a new Jenkins administrator permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Add a new Jenkins administrator</h4>
<p>There should have been a GitHub issue requesting access to Orka that
preceded this work and, as part of that, a member of the client team
should have been identified as the person responsible for
administering the Orka images.  Go to <code class="euiCode" data-code-language="text">Manage Jenkins</code> &gt; <code class="euiCode" data-code-language="text">Configure Global Security</code> and add that user to the list of users under the
<code class="euiCode" data-code-language="text">Authorization</code> header.  Select <code class="euiCode" data-code-language="text">Administer</code> under permissions.  Click
<code class="euiCode" data-code-language="text">Save</code>.</p>
<h3 id="reflect-changes-in-ansible" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#reflect-changes-in-ansible" rel="noreferrer" aria-label="Reflect Changes in Ansible permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Reflect Changes in Ansible</h3>
<p>Double and triple check these values as you won&#x27;t know you&#x27;ve gotten
it wrong until during a Jenkins party.</p>
<h4 id="write-secrets-to-vault" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#write-secrets-to-vault" rel="noreferrer" aria-label="Write Secrets to Vault permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Write Secrets to Vault</h4>
<p>First we need to encrypt the passwords used in the credentials above.
Log into a Jenkins controller and go to <code class="euiCode" data-code-language="text">Manage Jenkins</code> &gt; <code class="euiCode" data-code-language="text">Script Console</code> and copy the following into the text area.  Replace
<code class="euiCode" data-code-language="text">&lt;secret&gt;</code> with each value and hit <code class="euiCode" data-code-language="text">Run</code>.  Note the encrypted values.</p>
<div><div class="language-groovy euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="groovy"><span class="euiCodeBlock__line"><span class="token keyword">import</span> hudson<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Secret<span class="token punctuation">;</span>
</span><span class="euiCodeBlock__line">String toEncrypt <span class="token operator">=</span> <span class="token string gstring">&quot;&lt;secret&gt;&quot;</span>
</span><span class="euiCodeBlock__line">Secret secret <span class="token operator">=</span> Secret<span class="token punctuation">.</span><span class="token function">fromString</span><span class="token punctuation">(</span>toEncrypt<span class="token punctuation">)</span>
</span><span class="euiCodeBlock__line">print secret<span class="token punctuation">.</span><span class="token function">getEncryptedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<p>Fill in the values for the plain text and encrypted values below and run:</p>
<div><div class="language-shell euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="shell"><span class="euiCodeBlock__line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">JENKINS_NAME</span><span class="token operator">=</span>foo-ci
</span><span class="euiCodeBlock__line">vault <span class="token function">write</span> secret/ansible/dev/<span class="token variable">${JENKINS_NAME}</span>/jenkins_orka_plugin_user <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">&quot;infra-root+orka-<span class="token variable">${JENKINS_NAME}</span>@elastic.co&quot;</span>
</span><span class="euiCodeBlock__line">vault <span class="token function">write</span> /secret/ansible/dev/jenkins_encrypted/<span class="token variable">${JENKINS_NAME}</span>/jenkins_orka_plugin_password <span class="token assign-left variable">plaintext</span><span class="token operator">=</span><span class="token string">&quot;...&quot;</span> <span class="token assign-left variable">encrypted</span><span class="token operator">=</span><span class="token string">&quot;...&quot;</span>
</span><span class="euiCodeBlock__line">vault <span class="token function">write</span> secret/ansible/prod/<span class="token variable">${JENKINS_NAME}</span>/jenkins_orka_plugin_user <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">&quot;infra-root+orka-<span class="token variable">${JENKINS_NAME}</span>@elastic.co&quot;</span>
</span><span class="euiCodeBlock__line">vault <span class="token function">write</span> /secret/ansible/prod/jenkins_encrypted/<span class="token variable">${JENKINS_NAME}</span>/jenkins_orka_plugin_password <span class="token assign-left variable">plaintext</span><span class="token operator">=</span><span class="token string">&quot;...&quot;</span> <span class="token assign-left variable">encrypted</span><span class="token operator">=</span><span class="token string">&quot;...&quot;</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<div><div class="language-shell euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingSmall"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePre" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="shell"><span class="euiCodeBlock__line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">JENKINS_NAME</span><span class="token operator">=</span>foo-ci
</span><span class="euiCodeBlock__line">vault <span class="token function">write</span> secret/ansible/dev/jenkins_encrypted/beats-ci/jenkins_orka_vm_ssh_password <span class="token assign-left variable">plaintext</span><span class="token operator">=</span><span class="token string">&quot;...&quot;</span> <span class="token assign-left variable">encrypted</span><span class="token operator">=</span><span class="token string">&quot;...&quot;</span>
</span><span class="euiCodeBlock__line">vault <span class="token function">write</span> secret/ansible/prod/jenkins_encrypted/beats-ci/jenkins_orka_vm_ssh_password <span class="token assign-left variable">plaintext</span><span class="token operator">=</span><span class="token string">&quot;...&quot;</span> <span class="token assign-left variable">encrypted</span><span class="token operator">=</span><span class="token string">&quot;...&quot;</span>
</span><span class="euiCodeBlock__line"></span></code></pre></div></div>
<h4 id="ansible-changes" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#ansible-changes" rel="noreferrer" aria-label="Ansible changes permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Ansible changes</h4>
<p>There are several changes needed to make this permanent.  Here is a
list along with links to examples in a GitHub Pull Request:</p>
<ul>
<li><a class="euiLink euiLink--primary" href="https://github.com/elastic/infra/pull/36011/files#diff-b748831ba3d496fd280ecbafb7c191a546086168839fe185a0f57966a5759123R7-R10" rel="noreferrer">Add the new Jenkins admin<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a></li>
<li><a class="euiLink euiLink--primary" href="https://github.com/elastic/infra/pull/36011/files#diff-b748831ba3d496fd280ecbafb7c191a546086168839fe185a0f57966a5759123R94-R95" rel="noreferrer">Ansible group_vars for the controller<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a></li>
<li>Ansible host_vars, <a class="euiLink euiLink--primary" href="https://github.com/elastic/infra/pull/36011/files#diff-d7eebe3442953412db0506918d59f7f807ea68ee873eb0067674211c552626c5R9-R10" rel="noreferrer">blue<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a> and <a class="euiLink euiLink--primary" href="https://github.com/elastic/infra/pull/36011/files#diff-2f81777976c559fc912eaad79322e7dfbba8d3f67ec3eb423c1427090a72f291R9-R10" rel="noreferrer">green<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a></li>
<li>Jenkins config.xml in Ansible - For this one, SSH into the controller and look at <code class="euiCode" data-code-language="text">/var/lib/jenkins/config.xml</code> to get the real value.  Look for the section for <code class="euiCode" data-code-language="text">io.jenkins.plugins.orka.OrkaCloud</code> and insert it into the template <a class="euiLink euiLink--primary" href="https://github.com/elastic/infra/blob/e52eb809e59f21701834116982856add962b0bde/ansible/roles/jenkins/templates/config.xml.j2#L2018-L2111" rel="noreferrer">similer to this<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a>.</li>
<li><a class="euiLink euiLink--primary" href="https://github.com/elastic/infra/pull/36011/files#diff-8b3914a6593682de1192f503b35d9607c3263f9af022fbaf7ff02da43cc0ab33R83-R98" rel="noreferrer">Jenkins credentials<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--small euiIcon-isLoading euiLink__externalIcon" focusable="false" role="img" aria-label="External link" aria-hidden="true"></svg></a></li>
</ul>
<h3 id="testing" style="position:relative"><a class="euiLink euiLink--primary docArticle__headerLink" href="#testing" rel="noreferrer" aria-label="Testing permalink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiIcon--medium euiIcon-isLoading" focusable="false" role="img" aria-hidden="true"></svg></a>Testing</h3>
<p>Aside from <code class="euiCode" data-code-language="text">Test Connection</code> there isn&#x27;t much we do.  Work with the
Orka user on the customer team to ensure they have what they need to
create a node and be available to help them debug should something go
wrong.</p></div><div class="euiSpacer euiSpacer--l css-jz428s-euiSpacer-l"></div><div class="euiText euiText--small"><div class="euiTextColor euiTextColor--subdued">Last updated: May 17th, 2022</div></div></div></div></div></div></div></div><footer class="docChromeFooter" data-elastic-exclude="true"><div class="euiFlexGroup euiFlexGroup--justifyContentSpaceAround euiFlexGroup--directionRow euiFlexGroup--responsive"><div class="euiFlexItem euiFlexItem--flexGrowZero docChromeFooter__container"><div class="euiFlexGroup euiFlexGroup--gutterExtraLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--directionRow euiFlexGroup--responsive"><div class="euiFlexItem"><div class="euiText euiText--small"><div class="euiTextColor euiTextColor--ghost"><p>Elasticsearch is a trademark of Elasticsearch B.V., registered in the U.S. and in other countries.</p><p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the Apache Software Foundation in the United States and/or other countries.</p><p> <a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/trademarks" rel="">Trademarks</a><span class="docChromeFooter__divide">|</span><a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/terms-of-use" rel="">Terms of Use</a><span class="docChromeFooter__divide">|</span><a class="euiLink euiLink--ghost" href="https://www.elastic.co/legal/privacy-statement" rel="">Privacy</a><span class="docChromeFooter__divide">|</span>© <!-- -->2022<!-- --> Elasticsearch B.V. All Rights Reserved</p></div></div></div><div class="euiFlexItem euiFlexItem--flexGrowZero"></div><div class="euiFlexItem euiFlexItem--flexGrowZero"><figure class="euiImage docChromeFooter__logo"><img style="max-width:xs;max-height:xs;width:auto" src="/assets/images/logo-elastic-vertical-reverse.svg" class="euiImage__img" alt="Elastic logo"/></figure></div></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"bundle":"!function(e,t){\"object\"==typeof exports\u0026\u0026\"object\"==typeof module?module.exports=t(require(\"mdxJsReact\"),require(\"React\")):\"function\"==typeof define\u0026\u0026define.amd?define([\"mdxJsReact\",\"React\"],t):\"object\"==typeof exports?exports.MDXContent=t(require(\"mdxJsReact\"),require(\"React\")):e.MDXContent=t(e.mdxJsReact,e.React)}(this,((e,t)=\u003e(()=\u003e{\"use strict\";var n={24:e=\u003e{e.exports=t},825:t=\u003e{t.exports=e}},l={};function a(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={exports:{}};return n[e](r,r.exports,a),r.exports}a.n=e=\u003e{var t=e\u0026\u0026e.__esModule?()=\u003ee.default:()=\u003ee;return a.d(t,{a:t}),t},a.d=(e,t)=\u003e{for(var n in t)a.o(t,n)\u0026\u0026!a.o(e,n)\u0026\u0026Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=\u003eObject.prototype.hasOwnProperty.call(e,t),a.r=e=\u003e{\"undefined\"!=typeof Symbol\u0026\u0026Symbol.toStringTag\u0026\u0026Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})};var r={};return(()=\u003e{a.r(r),a.d(r,{default:()=\u003el});var e=a(825),t=a(24),n=a.n(t);const l=function(){var t=arguments.length\u003e0\u0026\u0026void 0!==arguments[0]?arguments[0]:{},l=Object.assign({},(0,e.useMDXComponents)(),t.components),a=l.wrapper;return a?n().createElement(a,t,n().createElement(r)):r();function r(){var l=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",pre:\"pre\",code:\"code\",ul:\"ul\",li:\"li\",h3:\"h3\",ol:\"ol\",h4:\"h4\",strong:\"strong\",table:\"table\",thead:\"thead\",tr:\"tr\",th:\"th\",tbody:\"tbody\",td:\"td\"},(0,e.useMDXComponents)(),t.components);return n().createElement(n().Fragment,null,n().createElement(l.p,null,\"The following information is intended for use by the CI Systems team.\\nSome of the documented commands or instructions may assume that you\\nhave privileged access to Orka, Vault, etc.\"),\"\\n\",n().createElement(l.h2,{id:\"connecting-to-the-vpn\"},\"Connecting to the VPN\"),\"\\n\",n().createElement(l.p,null,\"In order to use the Orka CLI, UI, or API, you must first use a VPN to\\nconnect to the Orka network.  (The CI agent networks are already\\nconnected.)\"),\"\\n\",n().createElement(l.p,null,\"First, follow the \",n().createElement(l.a,{href:\"https://orkadocs.macstadium.com/docs/vpn-connect\"},\"instructions to download and install the VPN\\nclient\"),\".\"),\"\\n\",n().createElement(l.p,null,\"The connection details are stored in \",n().createElement(l.a,{href:\"secret/macstadium/orka/ORKV10000025\"},\"this Vault\\nkey\"),\".\"),\"\\n\",n().createElement(l.p,null,\"If you are on Linux or Mac then you can use the following to easily\\nconnect:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-shell\",display:\"block\"},\"SECRET=/secret/macstadium/orka/ORKV10000025\\nvault read -field password $SECRET | \\\\\\n  sudo openconnect \\\\\\n    --user=$(vault read -field username $SECRET) \\\\\\n    --passwd-on-stdin \\\\\\n    --servercert  $(vault read -field servercert $SECRET) \\\\\\n    $(vault read -field server_address $SECRET)\\n\")),\"\\n\",n().createElement(l.p,null,\"If you are not on Linux or Mac, or would rather use a different\\ninterface for connecting, there are instructions available in the\\nMacStadium documentation, above.\"),\"\\n\",n().createElement(l.h2,{id:\"adding-orka-to-a-jenkins-controller\"},\"Adding Orka to a Jenkins controller\"),\"\\n\",n().createElement(l.p,null,\"The high level process describe below is as follows:\"),\"\\n\",n().createElement(l.ul,null,\"\\n\",n().createElement(l.li,null,\"Create new user and allocate nodes\"),\"\\n\",n().createElement(l.li,null,\"Manually set up Jenkins and test connection\"),\"\\n\",n().createElement(l.li,null,\"Update Vault and commit config changes to Git so they're available\\nduring updates.\"),\"\\n\"),\"\\n\",n().createElement(l.h3,{id:\"create-an-orka-user\"},\"Create an Orka User\"),\"\\n\",n().createElement(l.ol,null,\"\\n\",n().createElement(l.li,null,\"\\n\",n().createElement(l.p,null,\"Connect to the Orka VPN and log into Orka\"),\"\\n\"),\"\\n\",n().createElement(l.li,null,\"\\n\",n().createElement(l.p,null,\"Use \",n().createElement(l.code,{display:\"inline\"},\"orka user create\"),\" to create a new user for the cluster.\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-shell\",display:\"block\"},\"export JENKINS_NAME=foo-ci\\norka user create -e infra-root+orka-${JENKINS_NAME}@elastic.co\\n\")),\"\\n\"),\"\\n\",n().createElement(l.li,null,\"\\n\",n().createElement(l.p,null,\"Fill in a secure password (don't lose it, we'll add it to Vault soon)\"),\"\\n\"),\"\\n\",n().createElement(l.li,null,\"\\n\",n().createElement(l.p,null,\"Assign the new user to a group with \",n().createElement(l.code,{display:\"inline\"},\"orka user group\")),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-shell\",display:\"block\"},\"orka user group -e infra-root+orka-${JENKINS_NAME}@elastic.co -g ${JENKINS_NAME}\\n\")),\"\\n\"),\"\\n\"),\"\\n\",n().createElement(l.h4,{id:\"assign-orka-nodes\"},\"Assign Orka Nodes\"),\"\\n\",n().createElement(l.p,null,\"We divide the total number of Okra nodes across the teams that have\\naccess to Orka.  This allows us to manage a single Orka cluster but\\nprovide separate pools of workers for our customers.  Putting it a\\ndifferent way, we allocate and dedicate resources to different teams\\nso they always have the capacity they expect.\"),\"\\n\",n().createElement(l.ol,null,\"\\n\",n().createElement(l.li,null,\"\\n\",n().createElement(l.p,null,\"Get the list of nodes intended for the new team (this was likely\\nprovided in an earlier request for more capacity)\"),\"\\n\"),\"\\n\",n().createElement(l.li,null,\"\\n\",n().createElement(l.p,null,\"Use \",n().createElement(l.code,{display:\"inline\"},\"orka node group\"),\" to assign a node to a group.  The group\\nshould be the same one as used above when calling \",n().createElement(l.code,{display:\"inline\"},\"orka user group\"),\".  Use \",n().createElement(l.code,{display:\"inline\"},\"orka node list\"),\" to check the node names to use.\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-shell\",display:\"block\"},\"orka node group -g ${JENKINS_NAME} -n \u003cNode Name Here\u003e\\n\")),\"\\n\"),\"\\n\"),\"\\n\",n().createElement(l.h3,{id:\"set-up-jenkins\"},\"Set Up Jenkins\"),\"\\n\",n().createElement(l.h4,{id:\"add-jenkins-credentials\"},\"Add Jenkins credentials\"),\"\\n\",n().createElement(l.p,null,\"To add a new credential, go to the Jenkins controller and click\\n\",n().createElement(l.code,{display:\"inline\"},\"Manage Jenkins\"),\" \u003e \",n().createElement(l.code,{display:\"inline\"},\"Manage Credentials\"),\" \u003e \",n().createElement(l.code,{display:\"inline\"},\"(global)\"),\" \u003e \",n().createElement(l.code,{display:\"inline\"},\"Add Credentials\")),\"\\n\",n().createElement(l.p,null,\"The URL will look like this page for\\n\",n().createElement(l.a,{href:\"https://plumbers-ci.elastic.co/credentials/store/system/domain/_/newCredentials\"},\"plumbers-ci\"),\".\"),\"\\n\",n().createElement(l.p,null,n().createElement(l.strong,null,\"Plugin credentials\")),\"\\n\",n().createElement(l.p,null,\"This credential is for connecting to the Orka cluster itself (i.e. for\\norchestration).\"),\"\\n\",n().createElement(l.table,null,n().createElement(l.thead,null,n().createElement(l.tr,null,n().createElement(l.th,null,\"Field\"),n().createElement(l.th,null,\"Value\"))),n().createElement(l.tbody,null,n().createElement(l.tr,null,n().createElement(l.td,null,\"Kind\"),n().createElement(l.td,null,\"Username with password\")),n().createElement(l.tr,null,n().createElement(l.td,null,\"Username\"),n().createElement(l.td,null,\"(the email address of the newly created user, above)\")),n().createElement(l.tr,null,n().createElement(l.td,null,\"Treat username as secret\"),n().createElement(l.td,null,\"checked\")),n().createElement(l.tr,null,n().createElement(l.td,null,\"Password\"),n().createElement(l.td,null,\"(the password for the newly created user, above)\")),n().createElement(l.tr,null,n().createElement(l.td,null,\"ID\"),n().createElement(l.td,null,\"orka-plugin-creds\")),n().createElement(l.tr,null,n().createElement(l.td,null,\"Description\"),n().createElement(l.td,null,\"Creds for the Orka plugin\")))),\"\\n\",n().createElement(l.p,null,n().createElement(l.strong,null,\"Agent SSH credentials\")),\"\\n\",n().createElement(l.p,null,\"This credential is to inform the plugin how to SSH to the ephemeral\\nVM.\"),\"\\n\",n().createElement(l.p,null,\"Look up the value for the username and password from vault via:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-shell\",display:\"block\"},\"vault read secret/ci-systems/orka/default-ssh-credentials \\n\")),\"\\n\",n().createElement(l.table,null,n().createElement(l.thead,null,n().createElement(l.tr,null,n().createElement(l.th,null,\"Field\"),n().createElement(l.th,null,\"Value\"))),n().createElement(l.tbody,null,n().createElement(l.tr,null,n().createElement(l.td,null,\"Kind\"),n().createElement(l.td,null,\"Username with password\")),n().createElement(l.tr,null,n().createElement(l.td,null,\"Username\"),n().createElement(l.td,null,\"admin\")),n().createElement(l.tr,null,n().createElement(l.td,null,\"Treat username as secret\"),n().createElement(l.td,null,\"checked\")),n().createElement(l.tr,null,n().createElement(l.td,null,\"Password\"),n().createElement(l.td,null,\"(see above)\")),n().createElement(l.tr,null,n().createElement(l.td,null,\"ID\"),n().createElement(l.td,null,\"orka-vm-ssh-creds\")),n().createElement(l.tr,null,n().createElement(l.td,null,\"Description\"),n().createElement(l.td,null,\"Orka agent ssh credentials\")))),\"\\n\",n().createElement(l.h4,{id:\"jenkins-plugin-setup\"},\"Jenkins plugin setup\"),\"\\n\",n().createElement(l.p,null,'Ensure the plugin is installed by searching for \"Orka\" in the Plugin\\nManager.  Got to ',n().createElement(l.code,{display:\"inline\"},\"Manage Jenkins\"),\" \u003e \",n().createElement(l.code,{display:\"inline\"},\"Manage Plugins\"),\" \u003e \",n().createElement(l.code,{display:\"inline\"},\"Installed\"),' and\\nsearch the page for \"Orka\".'),\"\\n\",n().createElement(l.p,null,\"Assuming the plugin is installed, there will be a new option on\\nthe Configure Clouds screen at \",n().createElement(l.code,{display:\"inline\"},\"Manage Jenkins\"),\" \u003e \",n().createElement(l.code,{display:\"inline\"},\"Manage Nodes and Clouds\"),\" \u003e \",n().createElement(l.code,{display:\"inline\"},\"Configure Clouds\"),\".\"),\"\\n\",n().createElement(l.p,null,\"Click \",n().createElement(l.code,{display:\"inline\"},\"Add a new cloud\"),\" and select \",n().createElement(l.code,{display:\"inline\"},\"Orka Cloud\"),\".\"),\"\\n\",n().createElement(l.table,null,n().createElement(l.thead,null,n().createElement(l.tr,null,n().createElement(l.th,null,\"Field\"),n().createElement(l.th,null,\"Value\"))),n().createElement(l.tbody,null,n().createElement(l.tr,null,n().createElement(l.td,null,\"Name of this Cloud\"),n().createElement(l.td,null,\"MacStadium Orka\")),n().createElement(l.tr,null,n().createElement(l.td,null,\"Orka Credentials\"),n().createElement(l.td,null,\"(select \",n().createElement(l.code,{display:\"inline\"},\"Creds for the Orka plugin\"))),n().createElement(l.tr,null,n().createElement(l.td,null,\"Orka Endpoint\"),n().createElement(l.td,null,n().createElement(l.a,{href:\"http://10.221.188.100\"},\"http://10.221.188.100\"))))),\"\\n\",n().createElement(l.p,null,\"Hit \",n().createElement(l.code,{display:\"inline\"},\"Test Connection\"),\" to see if the credential works.  If it doesn't,\\ntry logging into Orka with the email and password generated above and\\ndouble checking that those fields were copied and pasted correctly\\ninto the Jenkins UI.\"),\"\\n\",n().createElement(l.h4,{id:\"add-a-new-jenkins-administrator\"},\"Add a new Jenkins administrator\"),\"\\n\",n().createElement(l.p,null,\"There should have been a GitHub issue requesting access to Orka that\\npreceded this work and, as part of that, a member of the client team\\nshould have been identified as the person responsible for\\nadministering the Orka images.  Go to \",n().createElement(l.code,{display:\"inline\"},\"Manage Jenkins\"),\" \u003e \",n().createElement(l.code,{display:\"inline\"},\"Configure Global Security\"),\" and add that user to the list of users under the\\n\",n().createElement(l.code,{display:\"inline\"},\"Authorization\"),\" header.  Select \",n().createElement(l.code,{display:\"inline\"},\"Administer\"),\" under permissions.  Click\\n\",n().createElement(l.code,{display:\"inline\"},\"Save\"),\".\"),\"\\n\",n().createElement(l.h3,{id:\"reflect-changes-in-ansible\"},\"Reflect Changes in Ansible\"),\"\\n\",n().createElement(l.p,null,\"Double and triple check these values as you won't know you've gotten\\nit wrong until during a Jenkins party.\"),\"\\n\",n().createElement(l.h4,{id:\"write-secrets-to-vault\"},\"Write Secrets to Vault\"),\"\\n\",n().createElement(l.p,null,\"First we need to encrypt the passwords used in the credentials above.\\nLog into a Jenkins controller and go to \",n().createElement(l.code,{display:\"inline\"},\"Manage Jenkins\"),\" \u003e \",n().createElement(l.code,{display:\"inline\"},\"Script Console\"),\" and copy the following into the text area.  Replace\\n\",n().createElement(l.code,{display:\"inline\"},\"\u003csecret\u003e\"),\" with each value and hit \",n().createElement(l.code,{display:\"inline\"},\"Run\"),\".  Note the encrypted values.\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-groovy\",display:\"block\"},'import hudson.util.Secret;\\nString toEncrypt = \"\u003csecret\u003e\"\\nSecret secret = Secret.fromString(toEncrypt)\\nprint secret.getEncryptedValue();\\n')),\"\\n\",n().createElement(l.p,null,\"Fill in the values for the plain text and encrypted values below and run:\"),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-shell\",display:\"block\"},'export JENKINS_NAME=foo-ci\\nvault write secret/ansible/dev/${JENKINS_NAME}/jenkins_orka_plugin_user value=\"infra-root+orka-${JENKINS_NAME}@elastic.co\"\\nvault write /secret/ansible/dev/jenkins_encrypted/${JENKINS_NAME}/jenkins_orka_plugin_password plaintext=\"...\" encrypted=\"...\"\\nvault write secret/ansible/prod/${JENKINS_NAME}/jenkins_orka_plugin_user value=\"infra-root+orka-${JENKINS_NAME}@elastic.co\"\\nvault write /secret/ansible/prod/jenkins_encrypted/${JENKINS_NAME}/jenkins_orka_plugin_password plaintext=\"...\" encrypted=\"...\"\\n')),\"\\n\",n().createElement(l.pre,null,n().createElement(l.code,{className:\"language-shell\",display:\"block\"},'export JENKINS_NAME=foo-ci\\nvault write secret/ansible/dev/jenkins_encrypted/beats-ci/jenkins_orka_vm_ssh_password plaintext=\"...\" encrypted=\"...\"\\nvault write secret/ansible/prod/jenkins_encrypted/beats-ci/jenkins_orka_vm_ssh_password plaintext=\"...\" encrypted=\"...\"\\n')),\"\\n\",n().createElement(l.h4,{id:\"ansible-changes\"},\"Ansible changes\"),\"\\n\",n().createElement(l.p,null,\"There are several changes needed to make this permanent.  Here is a\\nlist along with links to examples in a GitHub Pull Request:\"),\"\\n\",n().createElement(l.ul,null,\"\\n\",n().createElement(l.li,null,n().createElement(l.a,{href:\"https://github.com/elastic/infra/pull/36011/files#diff-b748831ba3d496fd280ecbafb7c191a546086168839fe185a0f57966a5759123R7-R10\"},\"Add the new Jenkins admin\")),\"\\n\",n().createElement(l.li,null,n().createElement(l.a,{href:\"https://github.com/elastic/infra/pull/36011/files#diff-b748831ba3d496fd280ecbafb7c191a546086168839fe185a0f57966a5759123R94-R95\"},\"Ansible group_vars for the controller\")),\"\\n\",n().createElement(l.li,null,\"Ansible host_vars, \",n().createElement(l.a,{href:\"https://github.com/elastic/infra/pull/36011/files#diff-d7eebe3442953412db0506918d59f7f807ea68ee873eb0067674211c552626c5R9-R10\"},\"blue\"),\" and \",n().createElement(l.a,{href:\"https://github.com/elastic/infra/pull/36011/files#diff-2f81777976c559fc912eaad79322e7dfbba8d3f67ec3eb423c1427090a72f291R9-R10\"},\"green\")),\"\\n\",n().createElement(l.li,null,\"Jenkins config.xml in Ansible - For this one, SSH into the controller and look at \",n().createElement(l.code,{display:\"inline\"},\"/var/lib/jenkins/config.xml\"),\" to get the real value.  Look for the section for \",n().createElement(l.code,{display:\"inline\"},\"io.jenkins.plugins.orka.OrkaCloud\"),\" and insert it into the template \",n().createElement(l.a,{href:\"https://github.com/elastic/infra/blob/e52eb809e59f21701834116982856add962b0bde/ansible/roles/jenkins/templates/config.xml.j2#L2018-L2111\"},\"similer to this\"),\".\"),\"\\n\",n().createElement(l.li,null,n().createElement(l.a,{href:\"https://github.com/elastic/infra/pull/36011/files#diff-8b3914a6593682de1192f503b35d9607c3263f9af022fbaf7ff02da43cc0ab33R83-R98\"},\"Jenkins credentials\")),\"\\n\"),\"\\n\",n().createElement(l.h3,{id:\"testing\"},\"Testing\"),\"\\n\",n().createElement(l.p,null,\"Aside from \",n().createElement(l.code,{display:\"inline\"},\"Test Connection\"),\" there isn't much we do.  Work with the\\nOrka user on the customer team to ensure they have what they need to\\ncreate a node and be available to help them debug should something go\\nwrong.\"))}}})(),r})()));","frontmatter":{"id":"macstadiumOrkaAdministration","slug":"/ci/macstadium/orka_administration","title":"Orka Administration","summary":"Admin guide for CI Systems engineers","date":"2022-05-17T00:00:00.000Z","tags":["ci","ci/cd","macos","orka","developer tools","engineering","platform"],"link":"https://github.com/elastic/ci/blob/main","linkPath":"docs/macstadium/orka_administration.mdx"},"missionId":"krVideos"},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["ci","macstadium","orka_administration"]},"buildId":"AzE3g5BBfFWf9aUdpqGZ7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>