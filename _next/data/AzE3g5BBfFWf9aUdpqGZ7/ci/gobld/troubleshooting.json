{"pageProps":{"bundle":"!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t(require(\"mdxJsReact\"),require(\"React\")):\"function\"==typeof define&&define.amd?define([\"mdxJsReact\",\"React\"],t):\"object\"==typeof exports?exports.MDXContent=t(require(\"mdxJsReact\"),require(\"React\")):e.MDXContent=t(e.mdxJsReact,e.React)}(this,((e,t)=>(()=>{\"use strict\";var n={24:e=>{e.exports=t},825:t=>{t.exports=e}},a={};function l(e){var t=a[e];if(void 0!==t)return t.exports;var o=a[e]={exports:{}};return n[e](o,o.exports,l),o.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})};var o={};return(()=>{l.r(o),l.d(o,{default:()=>a});var e=l(825),t=l(24),n=l.n(t);const a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign({},(0,e.useMDXComponents)(),t.components),l=a.wrapper;return l?n().createElement(l,t,n().createElement(o)):o();function o(){var a=Object.assign({h2:\"h2\",ul:\"ul\",li:\"li\",a:\"a\",br:\"br\",code:\"code\",pre:\"pre\",p:\"p\",h3:\"h3\"},(0,e.useMDXComponents)(),t.components);return n().createElement(n().Fragment,null,n().createElement(a.h2,{id:\"useful-information\"},\"Useful information\"),\"\\n\",n().createElement(a.ul,null,\"\\n\",n().createElement(a.li,null,\"Take a look at the \",n().createElement(a.a,{href:\"https://ci-stats.elastic.co/s/jenkins/app/dashboards#/view/edb93e20-001b-11ec-9ff8-057e2acfff2f?_g=(filters%3A!()%2CrefreshInterval%3A(pause%3A!t%2Cvalue%3A0)%2Ctime%3A(from%3Anow-4h%2Cto%3Anow))\"},\"Gobld Service Dashboard\")),\"\\n\",n().createElement(a.li,null,\"Gobld runs in our \",n().createElement(a.a,{href:\"../kubernetes.md\"},\"ci-systems-prod\"),\" platform.\",n().createElement(a.br),\"\\n\",\"Configure your \",n().createElement(a.code,{display:\"inline\"},\"kubectl\"),\" by running\",\"\\n\",n().createElement(a.pre,null,n().createElement(a.code,{display:\"block\"},\"cd terraform/providers/gcp/env/ci-systems-prod\\nmake kube-config\\n\")),\"\\n\"),\"\\n\",n().createElement(a.li,null,\"Gobld logs are sent to \",n().createElement(a.a,{href:\"https://ci-stats.elastic.co/goto/3254eeabab40a1c3ae17cb977b419ea0\"},\"ci-stats.elastic.co\")),\"\\n\",n().createElement(a.li,null,\"You can also view the logs in realtime by running:\",\"\\n\",n().createElement(a.pre,null,n().createElement(a.code,{display:\"block\"},\"kubectl logs --namespace=gobld -f deployments/gobld-buildkite-elastic -c gobld\\n\")),\"\\n\"),\"\\n\",n().createElement(a.li,null,\"Gobld is stateless and can be safely restarted. In Kubernetes land you do this by deleting the pod.\",\"\\n\",n().createElement(a.pre,null,n().createElement(a.code,{display:\"block\"},\"kubectl delete pod -l app=gobld-buildkite-elastic\\n\")),\"\\n\"),\"\\n\",n().createElement(a.li,null,\"Agents are launched in the \",n().createElement(a.a,{href:\"https://console.cloud.google.com/compute/instances?folder=&organizationId=992493199029&project=elastic-ci-prod&filter=%255B%257B_22k_22_3A_22_22_2C_22t_22_3A10_2C_22v_22_3A_22_5C_22immutable_5C_22_22%257D%255D\"},\"elastic-ci-prod\"),\" project.\"),\"\\n\"),\"\\n\",n().createElement(a.h2,{id:\"potential-problems-preventing-gobld-from-launching-instances\"},\"Potential problems preventing Gobld from launching instances\"),\"\\n\",n().createElement(a.p,null,\"An important thing to find out is whether or not all instances are failing to launch, or only a specific agent configuration.\",n().createElement(a.br),\"\\n\",\"If only CentOS 7 workers are failing to launch then this is most likely an issue with the built images rather than with Buildkite or the cloud provider.\",n().createElement(a.br),\"\\n\",\"There's a heatmap on the \",n().createElement(a.a,{href:\"https://ci-stats.elastic.co/s/jenkins/app/dashboards#/view/edb93e20-001b-11ec-9ff8-057e2acfff2f?_g=(filters%3A!()%2CrefreshInterval%3A(pause%3A!t%2Cvalue%3A0)%2Ctime%3A(from%3Anow-4h%2Cto%3Anow))\"},\"service dashboard\"),\" that can reveal this quickly.\"),\"\\n\",n().createElement(a.h3,{id:\"gcp-having-problems-with-creating-new-instances\"},\"GCP having problems with creating new instances\"),\"\\n\",n().createElement(a.p,null,\"If all instances are failing to be created and are stuck in the queue then the first thing to do is test if you can manually launch an instance.\"),\"\\n\",n().createElement(a.pre,null,n().createElement(a.code,{display:\"block\"},\"gcloud compute --project=elastic-ci-prod instances create gobld-test --machine-type=custom-16-32768 --subnet=jenkins --image=family/elastic-devops-ci-ubuntu-1604-lts --image-project=elastic-images-prod --boot-disk-size=512GB --boot-disk-type=pd-ssd  --zone=us-central1-a\\n\")),\"\\n\",n().createElement(a.p,null,\"If Gobld is only having problems launching a single instance type, you can try changing the \",n().createElement(a.code,{display:\"inline\"},\"--image\"),\" to the one being used in the \",n().createElement(a.a,{href:\"/terraform/providers/gcp/env/elastic-apps-ci-prod/helm/values/gobld\"},\"worker configuration\"),\". If it turns out that the latest image is causing problems you can roll it back by running the \",n().createElement(a.code,{display:\"inline\"},\"deprecate\"),\" command from the \",n().createElement(a.a,{href:\"/packer2.0/scripts/README.md#packer-image-managerpy\"},\"packer-image-manager.py\"),\" script.\"),\"\\n\",n().createElement(a.h3,{id:\"gcp-resource-quotas\"},\"GCP resource quotas\"),\"\\n\",n().createElement(a.p,null,\"Check whether or not we have run out of any particular resources in the \",n().createElement(a.a,{href:\"https://console.cloud.google.com/iam-admin/quotas?project=elastic-ci-prod\"},\"elastic-ci-prod\"),' project. You can click on \"Current Usage\" to sort by what percent each resource is being used.'),\"\\n\",n().createElement(a.h2,{id:\"zonal-outages\"},\"Zonal outages\"),\"\\n\",n().createElement(a.p,null,\"When launching a worker Gobld will choose a starting zone at random based on the build ID. After each failed launch attempt it will cycle to the next zone. So for short zonal outages, or quota shortages there should be no need to remove a zone from the configuration. If there are known long running issues with a zone it is also possible to remove it from the \",n().createElement(a.code,{display:\"inline\"},\"zones\"),\" configuration to prevent Gobld from attempting to launch workers there.\"),\"\\n\",n().createElement(a.h2,{id:\"llama-riemann-expiry-alerts\"},\"Llama Riemann Expiry alerts\"),\"\\n\",n().createElement(a.p,null,'Llama will send an alert with the message \"No Gobld data has flowed into\\nLlama Riemann for 15 minutes\" if any Gobld process stops logging for any reason.\\nThis was added due to issues where Filebeat would be correctly logging for only\\nsome containers on a Kubernetes node. However it could also potentially be a\\nsign of a Gobld issue.'),\"\\n\",n().createElement(a.ul,null,\"\\n\",n().createElement(a.li,null,\"\\n\",n().createElement(a.p,null,\"Look at the logs for the Filebeat container that this pod is using:\"),\"\\n\",n().createElement(a.pre,null,n().createElement(a.code,{className:\"language-bash\",display:\"block\"},\"kubectl --namespace=core-services logs -f $(kubectl --namespace=core-services get pod -l app=filebeat-filebeat --field-selector spec.nodeName=$(kubectl --namespace=gobld get pod -l app=gobld-buildkite-elastic -o jsonpath='{.items[].spec.nodeName}') -o name)\\n\")),\"\\n\"),\"\\n\",n().createElement(a.li,null,\"\\n\",n().createElement(a.p,null,\"Attempt to restart the pod for the missing controller by deleting it:\"),\"\\n\",n().createElement(a.pre,null,n().createElement(a.code,{className:\"language-bash\",display:\"block\"},\"kubectl --namespace=gobld delete pod -l app=devops-ci\\n\")),\"\\n\"),\"\\n\",n().createElement(a.li,null,\"\\n\",n().createElement(a.p,null,\"Try restarting the Filebeat container that this pod is using:\"),\"\\n\",n().createElement(a.pre,null,n().createElement(a.code,{className:\"language-bash\",display:\"block\"},\"kubectl --namespace=jenkins-support delete pod -l app=filebeat-filebeat --field-selector spec.nodeName=$(kubectl --namespace=gobld get pod -l app=devops-ci -o jsonpath='{.items[].spec.nodeName}')\\n\")),\"\\n\"),\"\\n\"))}}})(),o})()));","frontmatter":{"id":"ciGobldTroubleshooting","slug":"/ci/gobld/troubleshooting","title":"Troubleshooting","summary":"Gobld Troubleshooting guide plus some tips and tricks","date":"2022-03-28T00:00:00.000Z","tags":["ci","ci/cd","developer tools","buildkite","gobld","engineering","platform"],"link":"https://github.com/elastic/ci/blob/main","linkPath":"docs/gobld/troubleshooting.mdx"},"missionId":"krVideos"},"__N_SSG":true}